var gu=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},wu={exports:{}};(function(J,$e){(function(_e,Te){J.exports=Te()})(gu,function(){var _e=function(i){return i instanceof Uint8Array||i instanceof Uint16Array||i instanceof Uint32Array||i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array||i instanceof Float32Array||i instanceof Float64Array||i instanceof Uint8ClampedArray},Te=function(i,o){for(var h=Object.keys(o),T=0;T<h.length;++T)i[h[T]]=o[h[T]];return i},Ge=`
`;function ot(i){return typeof atob!="undefined"?atob(i):"base64:"+i}function He(i){var o=new Error("(regl) "+i);throw console.error(o),o}function Pe(i,o){i||He(o)}function lt(i){return i?": "+i:""}function Ke(i,o,h){i in o||He("unknown parameter ("+i+")"+lt(h)+". possible values: "+Object.keys(o).join())}function De(i,o){_e(i)||He("invalid parameter type"+lt(o)+". must be a typed array")}function Ot(i,o){switch(o){case"number":return typeof i=="number";case"object":return typeof i=="object";case"string":return typeof i=="string";case"boolean":return typeof i=="boolean";case"function":return typeof i=="function";case"undefined":return typeof i=="undefined";case"symbol":return typeof i=="symbol"}}function Bt(i,o,h){Ot(i,o)||He("invalid parameter type"+lt(h)+". expected "+o+", got "+typeof i)}function Ce(i,o){i>=0&&(i|0)===i||He("invalid parameter type, ("+i+")"+lt(o)+". must be a nonnegative integer")}function Dt(i,o,h){o.indexOf(i)<0&&He("invalid value"+lt(h)+". must be one of: "+o)}var qt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ze(i){Object.keys(i).forEach(function(o){qt.indexOf(o)<0&&He('invalid regl constructor argument "'+o+'". must be one of '+qt)})}function Wt(i,o){for(i=i+"";i.length<o;)i=" "+i;return i}function Ve(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function un(i,o){this.number=i,this.line=o,this.errors=[]}function cn(i,o,h){this.file=i,this.line=o,this.message=h}function _t(){var i=new Error,o=(i.stack||i).toString(),h=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(o);if(h)return h[1];var T=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(o);return T?T[1]:"unknown"}function ft(){var i=new Error,o=(i.stack||i).toString(),h=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(o);if(h)return h[1];var T=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(o);return T?T[1]:"unknown"}function vi(i,o){var h=i.split(`
`),T=1,N=0,S={unknown:new Ve,0:new Ve};S.unknown.name=S[0].name=o||_t(),S.unknown.lines.push(new un(0,""));for(var R=0;R<h.length;++R){var U=h[R],G=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(U);if(G)switch(G[1]){case"line":var K=/(\d+)(\s+\d+)?/.exec(G[2]);K&&(T=K[1]|0,K[2]&&(N=K[2]|0,N in S||(S[N]=new Ve)));break;case"define":var q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(G[2]);q&&(S[N].name=q[1]?ot(q[2]):q[2]);break}S[N].lines.push(new un(T++,U))}return Object.keys(S).forEach(function(X){var Y=S[X];Y.lines.forEach(function(j){Y.index[j.number]=j})}),S}function Fr(i){var o=[];return i.split(`
`).forEach(function(h){if(!(h.length<5)){var T=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(h);T?o.push(new cn(T[1]|0,T[2]|0,T[3].trim())):h.length>0&&o.push(new cn("unknown",0,h))}}),o}function mi(i,o){o.forEach(function(h){var T=i[h.file];if(T){var N=T.index[h.line];if(N){N.errors.push(h),T.hasErrors=!0;return}}i.unknown.hasErrors=!0,i.unknown.lines[0].errors.push(h)})}function bi(i,o,h,T,N){if(!i.getShaderParameter(o,i.COMPILE_STATUS)){var S=i.getShaderInfoLog(o),R=T===i.FRAGMENT_SHADER?"fragment":"vertex";wa(h,"string",R+" shader source must be a string",N);var U=vi(h,N),G=Fr(S);mi(U,G),Object.keys(U).forEach(function(K){var q=U[K];if(!q.hasErrors)return;var X=[""],Y=[""];function j(z,y){X.push(z),Y.push(y||"")}j("file number "+K+": "+q.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),q.lines.forEach(function(z){if(z.errors.length>0){j(Wt(z.number,4)+"|  ","background-color:yellow; font-weight:bold"),j(z.line+Ge,"color:red; background-color:yellow; font-weight:bold");var y=0;z.errors.forEach(function(L){var H=L.message,se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(H);if(se){var I=se[1];switch(H=se[2],I){case"assign":I="=";break}y=Math.max(z.line.indexOf(I,y),0)}else y=0;j(Wt("| ",6)),j(Wt("^^^",y+3)+Ge,"font-weight:bold"),j(Wt("| ",6)),j(H+Ge,"font-weight:bold")}),j(Wt("| ",6)+Ge)}else j(Wt(z.number,4)+"|  "),j(z.line+Ge,"color:red")}),typeof document!="undefined"&&!window.chrome?(Y[0]=X.join("%c"),console.log.apply(console,Y)):console.log(X.join(""))}),Pe.raise("Error compiling "+R+" shader, "+U[0].name)}}function yo(i,o,h,T,N){if(!i.getProgramParameter(o,i.LINK_STATUS)){var S=i.getProgramInfoLog(o),R=vi(h,N),U=vi(T,N),G='Error linking program with vertex shader, "'+U[0].name+'", and fragment shader "'+R[0].name+'"';typeof document!="undefined"?console.log("%c"+G+Ge+"%c"+S,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(G+Ge+S),Pe.raise(G)}}function _i(i){i._commandRef=_t()}function xo(i,o,h,T){_i(i);function N(G){return G?T.id(G):0}i._fragId=N(i.static.frag),i._vertId=N(i.static.vert);function S(G,K){Object.keys(K).forEach(function(q){G[T.id(q)]=!0})}var R=i._uniformSet={};S(R,o.static),S(R,o.dynamic);var U=i._attributeSet={};S(U,h.static),S(U,h.dynamic),i._hasCount="count"in i.static||"count"in i.dynamic||"elements"in i.static||"elements"in i.dynamic}function Bn(i,o){var h=ft();He(i+" in command "+(o||_t())+(h==="unknown"?"":" called from "+h))}function wt(i,o,h){i||Bn(o,h||_t())}function Me(i,o,h,T){i in o||Bn("unknown parameter ("+i+")"+lt(h)+". possible values: "+Object.keys(o).join(),T||_t())}function wa(i,o,h,T){Ot(i,o)||Bn("invalid parameter type"+lt(h)+". expected "+o+", got "+typeof i,T||_t())}function Eo(i){i()}function Co(i,o,h){i.texture?Dt(i.texture._texture.internalformat,o,"unsupported texture format for attachment"):Dt(i.renderbuffer._renderbuffer.format,h,"unsupported renderbuffer format for attachment")}var Vt=33071,gi=9728,We=9984,ct=9985,Ao=9986,So=9987,ya=5120,xa=5121,dn=5122,zt=5123,In=5124,To=5125,Gn=5126,wi=32819,Ea=32820,Ca=33635,Aa=34042,Po=36193,pt={};pt[ya]=pt[xa]=1,pt[dn]=pt[zt]=pt[Po]=pt[Ca]=pt[wi]=pt[Ea]=2,pt[In]=pt[To]=pt[Gn]=pt[Aa]=4;function yi(i,o){return i===Ea||i===wi||i===Ca?2:i===Aa?4:pt[i]*o}function fn(i){return!(i&i-1)&&!!i}function Sa(i,o,h){var T,N=o.width,S=o.height,R=o.channels;Pe(N>0&&N<=h.maxTextureSize&&S>0&&S<=h.maxTextureSize,"invalid texture shape"),(i.wrapS!==Vt||i.wrapT!==Vt)&&Pe(fn(N)&&fn(S),"incompatible wrap mode for texture, both width and height must be power of 2"),o.mipmask===1?N!==1&&S!==1&&Pe(i.minFilter!==We&&i.minFilter!==Ao&&i.minFilter!==ct&&i.minFilter!==So,"min filter requires mipmap"):(Pe(fn(N)&&fn(S),"texture must be a square power of 2 to support mipmapping"),Pe(o.mipmask===(N<<1)-1,"missing or incomplete mipmap data")),o.type===Gn&&(h.extensions.indexOf("oes_texture_float_linear")<0&&Pe(i.minFilter===gi&&i.magFilter===gi,"filter not supported, must enable oes_texture_float_linear"),Pe(!i.genMipmaps,"mipmap generation not supported with float textures"));var U=o.images;for(T=0;T<16;++T)if(U[T]){var G=N>>T,K=S>>T;Pe(o.mipmask&1<<T,"missing mipmap data");var q=U[T];if(Pe(q.width===G&&q.height===K,"invalid shape for mip images"),Pe(q.format===o.format&&q.internalformat===o.internalformat&&q.type===o.type,"incompatible type for mip image"),!q.compressed)if(q.data){var X=Math.ceil(yi(q.type,R)*G/q.unpackAlignment)*q.unpackAlignment;Pe(q.data.byteLength===X*K,"invalid data for image, buffer size is inconsistent with image format")}else q.element||q.copy}else i.genMipmaps||Pe((o.mipmask&1<<T)==0,"extra mipmap data");o.compressed&&Pe(!i.genMipmaps,"mipmap generation for compressed images not supported")}function ko(i,o,h,T){var N=i.width,S=i.height,R=i.channels;Pe(N>0&&N<=T.maxTextureSize&&S>0&&S<=T.maxTextureSize,"invalid texture shape"),Pe(N===S,"cube map must be square"),Pe(o.wrapS===Vt&&o.wrapT===Vt,"wrap mode not supported by cube map");for(var U=0;U<h.length;++U){var G=h[U];Pe(G.width===N&&G.height===S,"inconsistent cube map face shape"),o.genMipmaps&&(Pe(!G.compressed,"can not generate mipmap for compressed textures"),Pe(G.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var K=G.images,q=0;q<16;++q){var X=K[q];if(X){var Y=N>>q,j=S>>q;Pe(G.mipmask&1<<q,"missing mipmap data"),Pe(X.width===Y&&X.height===j,"invalid shape for mip images"),Pe(X.format===i.format&&X.internalformat===i.internalformat&&X.type===i.type,"incompatible type for mip image"),X.compressed||(X.data?Pe(X.data.byteLength===Y*j*Math.max(yi(X.type,R),X.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):X.element||X.copy)}}}}var l=Te(Pe,{optional:Eo,raise:He,commandRaise:Bn,command:wt,parameter:Ke,commandParameter:Me,constructor:ze,type:Bt,commandType:wa,isTypedArray:De,nni:Ce,oneOf:Dt,shaderError:bi,linkError:yo,callSite:ft,saveCommandRef:_i,saveDrawInfo:xo,framebufferFormat:Co,guessCommand:_t,texture2D:Sa,textureCube:ko}),pn=0,Lo=0,Ta=5,Un=6;function Cr(i,o){this.id=pn++,this.type=i,this.data=o}function Ar(i){return i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Yt(i){if(i.length===0)return[];var o=i.charAt(0),h=i.charAt(i.length-1);if(i.length>1&&o===h&&(o==='"'||o==="'"))return['"'+Ar(i.substr(1,i.length-2))+'"'];var T=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(i);if(T)return Yt(i.substr(0,T.index)).concat(Yt(T[1])).concat(Yt(i.substr(T.index+T[0].length)));var N=i.split(".");if(N.length===1)return['"'+Ar(i)+'"'];for(var S=[],R=0;R<N.length;++R)S=S.concat(Yt(N[R]));return S}function Br(i){return"["+Yt(i).join("][")+"]"}function Ro(i,o){return new Cr(i,Br(o+""))}function Pa(i){return typeof i=="function"&&!i._reglType||i instanceof Cr}function jn(i,o){if(typeof i=="function")return new Cr(Lo,i);if(typeof i=="number"||typeof i=="boolean")return new Cr(Ta,i);if(Array.isArray(i))return new Cr(Un,i.map(function(h,T){return jn(h,o+"["+T+"]")}));if(i instanceof Cr)return i;l(!1,"invalid option type in uniform "+o)}var gt={DynamicVariable:Cr,define:Ro,isDynamic:Pa,unbox:jn,accessor:Br},xi={next:typeof requestAnimationFrame=="function"?function(i){return requestAnimationFrame(i)}:function(i){return setTimeout(i,16)},cancel:typeof cancelAnimationFrame=="function"?function(i){return cancelAnimationFrame(i)}:clearTimeout},ka=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Oo(){var i={"":0},o=[""];return{id:function(h){var T=i[h];return T||(T=i[h]=o.length,o.push(h),T)},str:function(h){return o[h]}}}function Do(i,o,h){var T=document.createElement("canvas");Te(T.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),i.appendChild(T),i===document.body&&(T.style.position="absolute",Te(i.style,{margin:0,padding:0}));function N(){var U=window.innerWidth,G=window.innerHeight;if(i!==document.body){var K=T.getBoundingClientRect();U=K.right-K.left,G=K.bottom-K.top}T.width=h*U,T.height=h*G}var S;i!==document.body&&typeof ResizeObserver=="function"?(S=new ResizeObserver(function(){setTimeout(N)}),S.observe(i)):window.addEventListener("resize",N,!1);function R(){S?S.disconnect():window.removeEventListener("resize",N),i.removeChild(T)}return N(),{canvas:T,onDestroy:R}}function Ei(i,o){function h(T){try{return i.getContext(T,o)}catch{return null}}return h("webgl")||h("experimental-webgl")||h("webgl-experimental")}function Ci(i){return typeof i.nodeName=="string"&&typeof i.appendChild=="function"&&typeof i.getBoundingClientRect=="function"}function Kt(i){return typeof i.drawArrays=="function"||typeof i.drawElements=="function"}function $n(i){return typeof i=="string"?i.split():(l(Array.isArray(i),"invalid extension array"),i)}function Qt(i){return typeof i=="string"?(l(typeof document!="undefined","not supported outside of DOM"),document.querySelector(i)):i}function Vo(i){var o=i||{},h,T,N,S,R={},U=[],G=[],K=typeof window=="undefined"?1:window.devicePixelRatio,q=!1,X=function(z){z&&l.raise(z)},Y=function(){};if(typeof o=="string"?(l(typeof document!="undefined","selector queries only supported in DOM enviroments"),h=document.querySelector(o),l(h,"invalid query string for element")):typeof o=="object"?Ci(o)?h=o:Kt(o)?(S=o,N=S.canvas):(l.constructor(o),"gl"in o?S=o.gl:"canvas"in o?N=Qt(o.canvas):"container"in o&&(T=Qt(o.container)),"attributes"in o&&(R=o.attributes,l.type(R,"object","invalid context attributes")),"extensions"in o&&(U=$n(o.extensions)),"optionalExtensions"in o&&(G=$n(o.optionalExtensions)),"onDone"in o&&(l.type(o.onDone,"function","invalid or missing onDone callback"),X=o.onDone),"profile"in o&&(q=!!o.profile),"pixelRatio"in o&&(K=+o.pixelRatio,l(K>0,"invalid pixel ratio"))):l.raise("invalid arguments to regl"),h&&(h.nodeName.toLowerCase()==="canvas"?N=h:T=h),!S){if(!N){l(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var j=Do(T||document.body,X,K);if(!j)return null;N=j.canvas,Y=j.onDestroy}R.premultipliedAlpha===void 0&&(R.premultipliedAlpha=!0),S=Ei(N,R)}return S?{gl:S,canvas:N,container:T,extensions:U,optionalExtensions:G,pixelRatio:K,profile:q,onDone:X,onDestroy:Y}:(Y(),X("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function hn(i,o){var h={};function T(R){l.type(R,"string","extension name must be string");var U=R.toLowerCase(),G;try{G=h[U]=i.getExtension(U)}catch{}return!!G}for(var N=0;N<o.extensions.length;++N){var S=o.extensions[N];if(!T(S))return o.onDestroy(),o.onDone('"'+S+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return o.optionalExtensions.forEach(T),{extensions:h,restore:function(){Object.keys(h).forEach(function(R){if(h[R]&&!T(R))throw new Error("(regl): error restoring extension "+R)})}}}function yt(i,o){for(var h=Array(i),T=0;T<i;++T)h[T]=o(T);return h}var Hn=5120,Ai=5121,Si=5122,No=5123,Mo=5124,Fo=5125,Bo=5126;function Ti(i){for(var o=16;o<=1<<28;o*=16)if(i<=o)return o;return 0}function La(i){var o,h;return o=(i>65535)<<4,i>>>=o,h=(i>255)<<3,i>>>=h,o|=h,h=(i>15)<<2,i>>>=h,o|=h,h=(i>3)<<1,i>>>=h,o|=h,o|i>>1}function Ra(){var i=yt(8,function(){return[]});function o(S){var R=Ti(S),U=i[La(R)>>2];return U.length>0?U.pop():new ArrayBuffer(R)}function h(S){i[La(S.byteLength)>>2].push(S)}function T(S,R){var U=null;switch(S){case Hn:U=new Int8Array(o(R),0,R);break;case Ai:U=new Uint8Array(o(R),0,R);break;case Si:U=new Int16Array(o(2*R),0,R);break;case No:U=new Uint16Array(o(2*R),0,R);break;case Mo:U=new Int32Array(o(4*R),0,R);break;case Fo:U=new Uint32Array(o(4*R),0,R);break;case Bo:U=new Float32Array(o(4*R),0,R);break;default:return null}return U.length!==R?U.subarray(0,R):U}function N(S){h(S.buffer)}return{alloc:o,free:h,allocType:T,freeType:N}}var Xe=Ra();Xe.zero=Ra();var Oa=3408,Io=3410,Pi=3411,Go=3412,Ir=3413,Da=3414,Va=3415,Uo=33901,Na=33902,jo=3379,$o=3386,Ma=34921,ar=36347,vn=36348,Ho=35661,zo=35660,Fa=34930,Ba=36349,Ia=34076,zn=34024,Ko=7936,Ga=7937,Ua=7938,Xo=35724,qo=34047,Wo=36063,Sr=34852,Tt=3553,Gr=34067,Pt=34069,Tr=33984,Pr=6408,ki=5126,Ur=5121,Kn=36160,Yo=36053,ja=36064,$a=16384,Qo=function(i,o){var h=1;o.ext_texture_filter_anisotropic&&(h=i.getParameter(qo));var T=1,N=1;o.webgl_draw_buffers&&(T=i.getParameter(Sr),N=i.getParameter(Wo));var S=!!o.oes_texture_float;if(S){var R=i.createTexture();i.bindTexture(Tt,R),i.texImage2D(Tt,0,Pr,1,1,0,Pr,ki,null);var U=i.createFramebuffer();if(i.bindFramebuffer(Kn,U),i.framebufferTexture2D(Kn,ja,Tt,R,0),i.bindTexture(Tt,null),i.checkFramebufferStatus(Kn)!==Yo)S=!1;else{i.viewport(0,0,1,1),i.clearColor(1,0,0,1),i.clear($a);var G=Xe.allocType(ki,4);i.readPixels(0,0,1,1,Pr,ki,G),i.getError()?S=!1:(i.deleteFramebuffer(U),i.deleteTexture(R),S=G[0]===1),Xe.freeType(G)}}var K=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),q=!0;if(!K){var X=i.createTexture(),Y=Xe.allocType(Ur,36);i.activeTexture(Tr),i.bindTexture(Gr,X),i.texImage2D(Pt,0,Pr,3,3,0,Pr,Ur,Y),Xe.freeType(Y),i.bindTexture(Gr,null),i.deleteTexture(X),q=!i.getError()}return{colorBits:[i.getParameter(Io),i.getParameter(Pi),i.getParameter(Go),i.getParameter(Ir)],depthBits:i.getParameter(Da),stencilBits:i.getParameter(Va),subpixelBits:i.getParameter(Oa),extensions:Object.keys(o).filter(function(j){return!!o[j]}),maxAnisotropic:h,maxDrawbuffers:T,maxColorAttachments:N,pointSizeDims:i.getParameter(Uo),lineWidthDims:i.getParameter(Na),maxViewportDims:i.getParameter($o),maxCombinedTextureUnits:i.getParameter(Ho),maxCubeMapSize:i.getParameter(Ia),maxRenderbufferSize:i.getParameter(zn),maxTextureUnits:i.getParameter(Fa),maxTextureSize:i.getParameter(jo),maxAttributes:i.getParameter(Ma),maxVertexUniforms:i.getParameter(ar),maxVertexTextureUnits:i.getParameter(zo),maxVaryingVectors:i.getParameter(vn),maxFragmentUniforms:i.getParameter(Ba),glsl:i.getParameter(Xo),renderer:i.getParameter(Ga),vendor:i.getParameter(Ko),version:i.getParameter(Ua),readFloat:S,npotTextureCube:q}};function xt(i){return!!i&&typeof i=="object"&&Array.isArray(i.shape)&&Array.isArray(i.stride)&&typeof i.offset=="number"&&i.shape.length===i.stride.length&&(Array.isArray(i.data)||_e(i.data))}var kt=function(i){return Object.keys(i).map(function(o){return i[o]})},mn={shape:el,flatten:Jo};function Ha(i,o,h){for(var T=0;T<o;++T)h[T]=i[T]}function Zo(i,o,h,T){for(var N=0,S=0;S<o;++S)for(var R=i[S],U=0;U<h;++U)T[N++]=R[U]}function za(i,o,h,T,N,S){for(var R=S,U=0;U<o;++U)for(var G=i[U],K=0;K<h;++K)for(var q=G[K],X=0;X<T;++X)N[R++]=q[X]}function Ka(i,o,h,T,N){for(var S=1,R=h+1;R<o.length;++R)S*=o[R];var U=o[h];if(o.length-h==4){var G=o[h+1],K=o[h+2],q=o[h+3];for(R=0;R<U;++R)za(i[R],G,K,q,T,N),N+=S}else for(R=0;R<U;++R)Ka(i[R],o,h+1,T,N),N+=S}function Jo(i,o,h,T){var N=1;if(o.length)for(var S=0;S<o.length;++S)N*=o[S];else N=0;var R=T||Xe.allocType(h,N);switch(o.length){case 0:break;case 1:Ha(i,o[0],R);break;case 2:Zo(i,o[0],o[1],R);break;case 3:za(i,o[0],o[1],o[2],R,0);break;default:Ka(i,o,0,R,0)}return R}function el(i){for(var o=[],h=i;h.length;h=h[0])o.push(h.length);return o}var bn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},_n=5120,tl=5122,gn=5124,rl=5121,Li=5123,Xa=5125,nl=5126,il=5126,kr={int8:_n,int16:tl,int32:gn,uint8:rl,uint16:Li,uint32:Xa,float:nl,float32:il},al=35048,sl=35040,Xn={dynamic:al,stream:sl,static:35044},Ri=mn.flatten,qa=mn.shape,Wa=35044,ol=35040,Oi=5121,Di=5126,sr=[];sr[5120]=1,sr[5122]=2,sr[5124]=4,sr[5121]=1,sr[5123]=2,sr[5125]=4,sr[5126]=4;function qn(i){return bn[Object.prototype.toString.call(i)]|0}function Ya(i,o){for(var h=0;h<o.length;++h)i[h]=o[h]}function Vi(i,o,h,T,N,S,R){for(var U=0,G=0;G<h;++G)for(var K=0;K<T;++K)i[U++]=o[N*G+S*K+R]}function ll(i,o,h,T){var N=0,S={};function R(y){this.id=N++,this.buffer=i.createBuffer(),this.type=y,this.usage=Wa,this.byteLength=0,this.dimension=1,this.dtype=Oi,this.persistentData=null,h.profile&&(this.stats={size:0})}R.prototype.bind=function(){i.bindBuffer(this.type,this.buffer)},R.prototype.destroy=function(){Y(this)};var U=[];function G(y,L){var H=U.pop();return H||(H=new R(y)),H.bind(),X(H,L,ol,0,1,!1),H}function K(y){U.push(y)}function q(y,L,H){y.byteLength=L.byteLength,i.bufferData(y.type,L,H)}function X(y,L,H,se,I,ie){var re;if(y.usage=H,Array.isArray(L)){if(y.dtype=se||Di,L.length>0){var pe;if(Array.isArray(L[0])){re=qa(L);for(var M=1,V=1;V<re.length;++V)M*=re[V];y.dimension=M,pe=Ri(L,re,y.dtype),q(y,pe,H),ie?y.persistentData=pe:Xe.freeType(pe)}else if(typeof L[0]=="number"){y.dimension=I;var ue=Xe.allocType(y.dtype,L.length);Ya(ue,L),q(y,ue,H),ie?y.persistentData=ue:Xe.freeType(ue)}else _e(L[0])?(y.dimension=L[0].length,y.dtype=se||qn(L[0])||Di,pe=Ri(L,[L.length,L[0].length],y.dtype),q(y,pe,H),ie?y.persistentData=pe:Xe.freeType(pe)):l.raise("invalid buffer data")}}else if(_e(L))y.dtype=se||qn(L),y.dimension=I,q(y,L,H),ie&&(y.persistentData=new Uint8Array(new Uint8Array(L.buffer)));else if(xt(L)){re=L.shape;var Q=L.stride,$=L.offset,Z=0,ee=0,ye=0,ge=0;re.length===1?(Z=re[0],ee=1,ye=Q[0],ge=0):re.length===2?(Z=re[0],ee=re[1],ye=Q[0],ge=Q[1]):l.raise("invalid shape"),y.dtype=se||qn(L.data)||Di,y.dimension=ee;var ne=Xe.allocType(y.dtype,Z*ee);Vi(ne,L.data,Z,ee,ye,ge,$),q(y,ne,H),ie?y.persistentData=ne:Xe.freeType(ne)}else L instanceof ArrayBuffer?(y.dtype=Oi,y.dimension=I,q(y,L,H),ie&&(y.persistentData=new Uint8Array(new Uint8Array(L)))):l.raise("invalid buffer data")}function Y(y){o.bufferCount--,T(y);var L=y.buffer;l(L,"buffer must not be deleted already"),i.deleteBuffer(L),y.buffer=null,delete S[y.id]}function j(y,L,H,se){o.bufferCount++;var I=new R(L);S[I.id]=I;function ie(M){var V=Wa,ue=null,Q=0,$=0,Z=1;return Array.isArray(M)||_e(M)||xt(M)||M instanceof ArrayBuffer?ue=M:typeof M=="number"?Q=M|0:M&&(l.type(M,"object","buffer arguments must be an object, a number or an array"),"data"in M&&(l(ue===null||Array.isArray(ue)||_e(ue)||xt(ue),"invalid data for buffer"),ue=M.data),"usage"in M&&(l.parameter(M.usage,Xn,"invalid buffer usage"),V=Xn[M.usage]),"type"in M&&(l.parameter(M.type,kr,"invalid buffer type"),$=kr[M.type]),"dimension"in M&&(l.type(M.dimension,"number","invalid dimension"),Z=M.dimension|0),"length"in M&&(l.nni(Q,"buffer length must be a nonnegative integer"),Q=M.length|0)),I.bind(),ue?X(I,ue,V,$,Z,se):(Q&&i.bufferData(I.type,Q,V),I.dtype=$||Oi,I.usage=V,I.dimension=Z,I.byteLength=Q),h.profile&&(I.stats.size=I.byteLength*sr[I.dtype]),ie}function re(M,V){l(V+M.byteLength<=I.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+M.byteLength+" starting from offset "+V+" to a buffer of size "+I.byteLength),i.bufferSubData(I.type,V,M)}function pe(M,V){var ue=(V||0)|0,Q;if(I.bind(),_e(M)||M instanceof ArrayBuffer)re(M,ue);else if(Array.isArray(M)){if(M.length>0)if(typeof M[0]=="number"){var $=Xe.allocType(I.dtype,M.length);Ya($,M),re($,ue),Xe.freeType($)}else if(Array.isArray(M[0])||_e(M[0])){Q=qa(M);var Z=Ri(M,Q,I.dtype);re(Z,ue),Xe.freeType(Z)}else l.raise("invalid buffer data")}else if(xt(M)){Q=M.shape;var ee=M.stride,ye=0,ge=0,ne=0,ae=0;Q.length===1?(ye=Q[0],ge=1,ne=ee[0],ae=0):Q.length===2?(ye=Q[0],ge=Q[1],ne=ee[0],ae=ee[1]):l.raise("invalid shape");var ve=Array.isArray(M.data)?I.dtype:qn(M.data),xe=Xe.allocType(ve,ye*ge);Vi(xe,M.data,ye,ge,ne,ae,M.offset),re(xe,ue),Xe.freeType(xe)}else l.raise("invalid data for buffer subdata");return ie}return H||ie(y),ie._reglType="buffer",ie._buffer=I,ie.subdata=pe,h.profile&&(ie.stats=I.stats),ie.destroy=function(){Y(I)},ie}function z(){kt(S).forEach(function(y){y.buffer=i.createBuffer(),i.bindBuffer(y.type,y.buffer),i.bufferData(y.type,y.persistentData||y.byteLength,y.usage)})}return h.profile&&(o.getTotalBufferSize=function(){var y=0;return Object.keys(S).forEach(function(L){y+=S[L].stats.size}),y}),{create:j,createStream:G,destroyStream:K,clear:function(){kt(S).forEach(Y),U.forEach(Y)},getBuffer:function(y){return y&&y._buffer instanceof R?y._buffer:null},restore:z,_initBuffer:X}}var ul=0,cl=0,Qa=1,dl=1,Zt=4,Za=4,or={points:ul,point:cl,lines:Qa,line:dl,triangles:Zt,triangle:Za,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Et=0,fl=1,lr=4,Ja=5120,ur=5121,Ni=5122,jr=5123,es=5124,Lr=5125,Rr=34963,Ct=35040,wn=35044;function Jt(i,o,h,T){var N={},S=0,R={uint8:ur,uint16:jr};o.oes_element_index_uint&&(R.uint32=Lr);function U(z){this.id=S++,N[this.id]=this,this.buffer=z,this.primType=lr,this.vertCount=0,this.type=0}U.prototype.bind=function(){this.buffer.bind()};var G=[];function K(z){var y=G.pop();return y||(y=new U(h.create(null,Rr,!0,!1)._buffer)),X(y,z,Ct,-1,-1,0,0),y}function q(z){G.push(z)}function X(z,y,L,H,se,I,ie){z.buffer.bind();var re;if(y){var pe=ie;!ie&&(!_e(y)||xt(y)&&!_e(y.data))&&(pe=o.oes_element_index_uint?Lr:jr),h._initBuffer(z.buffer,y,L,pe,3)}else i.bufferData(Rr,I,L),z.buffer.dtype=re||ur,z.buffer.usage=L,z.buffer.dimension=3,z.buffer.byteLength=I;if(re=ie,!ie){switch(z.buffer.dtype){case ur:case Ja:re=ur;break;case jr:case Ni:re=jr;break;case Lr:case es:re=Lr;break;default:l.raise("unsupported type for element array")}z.buffer.dtype=re}z.type=re,l(re!==Lr||!!o.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var M=se;M<0&&(M=z.buffer.byteLength,re===jr?M>>=1:re===Lr&&(M>>=2)),z.vertCount=M;var V=H;if(H<0){V=lr;var ue=z.buffer.dimension;ue===1&&(V=Et),ue===2&&(V=fl),ue===3&&(V=lr)}z.primType=V}function Y(z){T.elementsCount--,l(z.buffer!==null,"must not double destroy elements"),delete N[z.id],z.buffer.destroy(),z.buffer=null}function j(z,y){var L=h.create(null,Rr,!0),H=new U(L._buffer);T.elementsCount++;function se(I){if(!I)L(),H.primType=lr,H.vertCount=0,H.type=ur;else if(typeof I=="number")L(I),H.primType=lr,H.vertCount=I|0,H.type=ur;else{var ie=null,re=wn,pe=-1,M=-1,V=0,ue=0;Array.isArray(I)||_e(I)||xt(I)?ie=I:(l.type(I,"object","invalid arguments for elements"),"data"in I&&(ie=I.data,l(Array.isArray(ie)||_e(ie)||xt(ie),"invalid data for element buffer")),"usage"in I&&(l.parameter(I.usage,Xn,"invalid element buffer usage"),re=Xn[I.usage]),"primitive"in I&&(l.parameter(I.primitive,or,"invalid element buffer primitive"),pe=or[I.primitive]),"count"in I&&(l(typeof I.count=="number"&&I.count>=0,"invalid vertex count for elements"),M=I.count|0),"type"in I&&(l.parameter(I.type,R,"invalid buffer type"),ue=R[I.type]),"length"in I?V=I.length|0:(V=M,ue===jr||ue===Ni?V*=2:(ue===Lr||ue===es)&&(V*=4))),X(H,ie,re,pe,M,V,ue)}return se}return se(z),se._reglType="elements",se._elements=H,se.subdata=function(I,ie){return L.subdata(I,ie),se},se.destroy=function(){Y(H)},se}return{create:j,createStream:K,destroyStream:q,getElements:function(z){return typeof z=="function"&&z._elements instanceof U?z._elements:null},clear:function(){kt(N).forEach(Y)}}}var ts=new Float32Array(1),rs=new Uint32Array(ts.buffer),Mi=5123;function cr(i){for(var o=Xe.allocType(Mi,i.length),h=0;h<i.length;++h)if(isNaN(i[h]))o[h]=65535;else if(i[h]===1/0)o[h]=31744;else if(i[h]===-1/0)o[h]=64512;else{ts[0]=i[h];var T=rs[0],N=T>>>31<<15,S=(T<<1>>>24)-127,R=T>>13&(1<<10)-1;if(S<-24)o[h]=N;else if(S<-14){var U=-14-S;o[h]=N+(R+(1<<10)>>U)}else S>15?o[h]=N+31744:o[h]=N+(S+15<<10)+R}return o}function Ae(i){return Array.isArray(i)||_e(i)}var Fi=function(i){return!(i&i-1)&&!!i},Ye=34467,Nt=3553,At=34067,Wn=34069,It=6408,yn=6406,Yn=6407,xn=6409,$r=6410,ns=32854,En=32855,Hr=36194,Qn=32819,is=32820,dr=33635,as=34042,Cn=6402,zr=34041,Bi=35904,Kr=35906,Gt=36193,fr=33776,Xr=33777,Ii=33778,Gi=33779,ss=35986,os=35987,pr=34798,ls=35840,us=35841,cs=35842,ds=35843,Ui=36196,qr=5121,ji=5123,hr=5125,Wr=5126,pl=10242,hl=10243,vl=10497,Yr=33071,Fe=33648,vr=10240,ml=10241,An=9728,Or=9729,St=9984,fs=9985,$i=9986,Sn=9987,Zn=33170,Dr=4352,bl=4353,_l=4354,ps=34046,Hi=3317,Jn=37440,hs=37441,ei=37443,vs=37444,Tn=33984,gl=[St,$i,fs,Sn],Pn=[0,xn,$r,Yn,It],ht={};ht[xn]=ht[yn]=ht[Cn]=1,ht[zr]=ht[$r]=2,ht[Yn]=ht[Bi]=3,ht[It]=ht[Kr]=4;function Qr(i){return"[object "+i+"]"}var ms=Qr("HTMLCanvasElement"),Vr=Qr("OffscreenCanvas"),bs=Qr("CanvasRenderingContext2D"),_s=Qr("ImageBitmap"),gs=Qr("HTMLImageElement"),ws=Qr("HTMLVideoElement"),zi=Object.keys(bn).concat([ms,Vr,bs,_s,gs,ws]),Zr=[];Zr[qr]=1,Zr[Wr]=4,Zr[Gt]=2,Zr[ji]=2,Zr[hr]=4;var tt=[];tt[ns]=2,tt[En]=2,tt[Hr]=2,tt[zr]=4,tt[fr]=.5,tt[Xr]=.5,tt[Ii]=1,tt[Gi]=1,tt[ss]=.5,tt[os]=1,tt[pr]=1,tt[ls]=.5,tt[us]=.25,tt[cs]=.5,tt[ds]=.25,tt[Ui]=.5;function ys(i){return Array.isArray(i)&&(i.length===0||typeof i[0]=="number")}function xs(i){if(!Array.isArray(i))return!1;var o=i.length;return!(o===0||!Ae(i[0]))}function er(i){return Object.prototype.toString.call(i)}function Ki(i){return er(i)===ms}function Es(i){return er(i)===Vr}function wl(i){return er(i)===bs}function yl(i){return er(i)===_s}function Xi(i){return er(i)===gs}function xl(i){return er(i)===ws}function qi(i){if(!i)return!1;var o=er(i);return zi.indexOf(o)>=0?!0:ys(i)||xs(i)||xt(i)}function ti(i){return bn[Object.prototype.toString.call(i)]|0}function El(i,o){var h=o.length;switch(i.type){case qr:case ji:case hr:case Wr:var T=Xe.allocType(i.type,h);T.set(o),i.data=T;break;case Gt:i.data=cr(o);break;default:l.raise("unsupported texture type, must specify a typed array")}}function Cs(i,o){return Xe.allocType(i.type===Gt?Wr:i.type,o)}function As(i,o){i.type===Gt?(i.data=cr(o),Xe.freeType(o)):i.data=o}function Cl(i,o,h,T,N,S){for(var R=i.width,U=i.height,G=i.channels,K=R*U*G,q=Cs(i,K),X=0,Y=0;Y<U;++Y)for(var j=0;j<R;++j)for(var z=0;z<G;++z)q[X++]=o[h*j+T*Y+N*z+S];As(i,q)}function ri(i,o,h,T,N,S){var R;if(typeof tt[i]!="undefined"?R=tt[i]:R=ht[i]*Zr[o],S&&(R*=6),N){for(var U=0,G=h;G>=1;)U+=R*G*G,G/=2;return U}else return R*h*T}function Al(i,o,h,T,N,S,R){var U={"don't care":Dr,"dont care":Dr,nice:_l,fast:bl},G={repeat:vl,clamp:Yr,mirror:Fe},K={nearest:An,linear:Or},q=Te({mipmap:Sn,"nearest mipmap nearest":St,"linear mipmap nearest":fs,"nearest mipmap linear":$i,"linear mipmap linear":Sn},K),X={none:0,browser:vs},Y={uint8:qr,rgba4:Qn,rgb565:dr,"rgb5 a1":is},j={alpha:yn,luminance:xn,"luminance alpha":$r,rgb:Yn,rgba:It,rgba4:ns,"rgb5 a1":En,rgb565:Hr},z={};o.ext_srgb&&(j.srgb=Bi,j.srgba=Kr),o.oes_texture_float&&(Y.float32=Y.float=Wr),o.oes_texture_half_float&&(Y.float16=Y["half float"]=Gt),o.webgl_depth_texture&&(Te(j,{depth:Cn,"depth stencil":zr}),Te(Y,{uint16:ji,uint32:hr,"depth stencil":as})),o.webgl_compressed_texture_s3tc&&Te(z,{"rgb s3tc dxt1":fr,"rgba s3tc dxt1":Xr,"rgba s3tc dxt3":Ii,"rgba s3tc dxt5":Gi}),o.webgl_compressed_texture_atc&&Te(z,{"rgb atc":ss,"rgba atc explicit alpha":os,"rgba atc interpolated alpha":pr}),o.webgl_compressed_texture_pvrtc&&Te(z,{"rgb pvrtc 4bppv1":ls,"rgb pvrtc 2bppv1":us,"rgba pvrtc 4bppv1":cs,"rgba pvrtc 2bppv1":ds}),o.webgl_compressed_texture_etc1&&(z["rgb etc1"]=Ui);var y=Array.prototype.slice.call(i.getParameter(Ye));Object.keys(z).forEach(function(f){var P=z[f];y.indexOf(P)>=0&&(j[f]=P)});var L=Object.keys(j);h.textureFormats=L;var H=[];Object.keys(j).forEach(function(f){var P=j[f];H[P]=f});var se=[];Object.keys(Y).forEach(function(f){var P=Y[f];se[P]=f});var I=[];Object.keys(K).forEach(function(f){var P=K[f];I[P]=f});var ie=[];Object.keys(q).forEach(function(f){var P=q[f];ie[P]=f});var re=[];Object.keys(G).forEach(function(f){var P=G[f];re[P]=f});var pe=L.reduce(function(f,P){var A=j[P];return A===xn||A===yn||A===xn||A===$r||A===Cn||A===zr||o.ext_srgb&&(A===Bi||A===Kr)?f[A]=A:A===En||P.indexOf("rgba")>=0?f[A]=It:f[A]=Yn,f},{});function M(){this.internalformat=It,this.format=It,this.type=qr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=vs,this.width=0,this.height=0,this.channels=0}function V(f,P){f.internalformat=P.internalformat,f.format=P.format,f.type=P.type,f.compressed=P.compressed,f.premultiplyAlpha=P.premultiplyAlpha,f.flipY=P.flipY,f.unpackAlignment=P.unpackAlignment,f.colorSpace=P.colorSpace,f.width=P.width,f.height=P.height,f.channels=P.channels}function ue(f,P){if(!(typeof P!="object"||!P)){if("premultiplyAlpha"in P&&(l.type(P.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),f.premultiplyAlpha=P.premultiplyAlpha),"flipY"in P&&(l.type(P.flipY,"boolean","invalid texture flip"),f.flipY=P.flipY),"alignment"in P&&(l.oneOf(P.alignment,[1,2,4,8],"invalid texture unpack alignment"),f.unpackAlignment=P.alignment),"colorSpace"in P&&(l.parameter(P.colorSpace,X,"invalid colorSpace"),f.colorSpace=X[P.colorSpace]),"type"in P){var A=P.type;l(o.oes_texture_float||!(A==="float"||A==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),l(o.oes_texture_half_float||!(A==="half float"||A==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),l(o.webgl_depth_texture||!(A==="uint16"||A==="uint32"||A==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(A,Y,"invalid texture type"),f.type=Y[A]}var le=f.width,ke=f.height,u=f.channels,s=!1;"shape"in P?(l(Array.isArray(P.shape)&&P.shape.length>=2,"shape must be an array"),le=P.shape[0],ke=P.shape[1],P.shape.length===3&&(u=P.shape[2],l(u>0&&u<=4,"invalid number of channels"),s=!0),l(le>=0&&le<=h.maxTextureSize,"invalid width"),l(ke>=0&&ke<=h.maxTextureSize,"invalid height")):("radius"in P&&(le=ke=P.radius,l(le>=0&&le<=h.maxTextureSize,"invalid radius")),"width"in P&&(le=P.width,l(le>=0&&le<=h.maxTextureSize,"invalid width")),"height"in P&&(ke=P.height,l(ke>=0&&ke<=h.maxTextureSize,"invalid height")),"channels"in P&&(u=P.channels,l(u>0&&u<=4,"invalid number of channels"),s=!0)),f.width=le|0,f.height=ke|0,f.channels=u|0;var v=!1;if("format"in P){var w=P.format;l(o.webgl_depth_texture||!(w==="depth"||w==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(w,j,"invalid texture format");var x=f.internalformat=j[w];f.format=pe[x],w in Y&&("type"in P||(f.type=Y[w])),w in z&&(f.compressed=!0),v=!0}!s&&v?f.channels=ht[f.format]:s&&!v?f.channels!==Pn[f.format]&&(f.format=f.internalformat=Pn[f.channels]):v&&s&&l(f.channels===ht[f.format],"number of channels inconsistent with specified format")}}function Q(f){i.pixelStorei(Jn,f.flipY),i.pixelStorei(hs,f.premultiplyAlpha),i.pixelStorei(ei,f.colorSpace),i.pixelStorei(Hi,f.unpackAlignment)}function $(){M.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Z(f,P){var A=null;if(qi(P)?A=P:P&&(l.type(P,"object","invalid pixel data type"),ue(f,P),"x"in P&&(f.xOffset=P.x|0),"y"in P&&(f.yOffset=P.y|0),qi(P.data)&&(A=P.data)),l(!f.compressed||A instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),P.copy){l(!A,"can not specify copy and data field for the same texture");var le=N.viewportWidth,ke=N.viewportHeight;f.width=f.width||le-f.xOffset,f.height=f.height||ke-f.yOffset,f.needsCopy=!0,l(f.xOffset>=0&&f.xOffset<le&&f.yOffset>=0&&f.yOffset<ke&&f.width>0&&f.width<=le&&f.height>0&&f.height<=ke,"copy texture read out of bounds")}else if(!A)f.width=f.width||1,f.height=f.height||1,f.channels=f.channels||4;else if(_e(A))f.channels=f.channels||4,f.data=A,!("type"in P)&&f.type===qr&&(f.type=ti(A));else if(ys(A))f.channels=f.channels||4,El(f,A),f.alignment=1,f.needsFree=!0;else if(xt(A)){var u=A.data;!Array.isArray(u)&&f.type===qr&&(f.type=ti(u));var s=A.shape,v=A.stride,w,x,b,m,g,c;s.length===3?(b=s[2],c=v[2]):(l(s.length===2,"invalid ndarray pixel data, must be 2 or 3D"),b=1,c=1),w=s[0],x=s[1],m=v[0],g=v[1],f.alignment=1,f.width=w,f.height=x,f.channels=b,f.format=f.internalformat=Pn[b],f.needsFree=!0,Cl(f,u,m,g,c,A.offset)}else if(Ki(A)||Es(A)||wl(A))Ki(A)||Es(A)?f.element=A:f.element=A.canvas,f.width=f.element.width,f.height=f.element.height,f.channels=4;else if(yl(A))f.element=A,f.width=A.width,f.height=A.height,f.channels=4;else if(Xi(A))f.element=A,f.width=A.naturalWidth,f.height=A.naturalHeight,f.channels=4;else if(xl(A))f.element=A,f.width=A.videoWidth,f.height=A.videoHeight,f.channels=4;else if(xs(A)){var p=f.width||A[0].length,d=f.height||A.length,C=f.channels;Ae(A[0][0])?C=C||A[0][0].length:C=C||1;for(var E=mn.shape(A),D=1,F=0;F<E.length;++F)D*=E[F];var W=Cs(f,D);mn.flatten(A,E,"",W),As(f,W),f.alignment=1,f.width=p,f.height=d,f.channels=C,f.format=f.internalformat=Pn[C],f.needsFree=!0}f.type===Wr?l(h.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):f.type===Gt&&l(h.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ee(f,P,A){var le=f.element,ke=f.data,u=f.internalformat,s=f.format,v=f.type,w=f.width,x=f.height;Q(f),le?i.texImage2D(P,A,s,s,v,le):f.compressed?i.compressedTexImage2D(P,A,u,w,x,0,ke):f.needsCopy?(T(),i.copyTexImage2D(P,A,s,f.xOffset,f.yOffset,w,x,0)):i.texImage2D(P,A,s,w,x,0,s,v,ke||null)}function ye(f,P,A,le,ke){var u=f.element,s=f.data,v=f.internalformat,w=f.format,x=f.type,b=f.width,m=f.height;Q(f),u?i.texSubImage2D(P,ke,A,le,w,x,u):f.compressed?i.compressedTexSubImage2D(P,ke,A,le,v,b,m,s):f.needsCopy?(T(),i.copyTexSubImage2D(P,ke,A,le,f.xOffset,f.yOffset,b,m)):i.texSubImage2D(P,ke,A,le,b,m,w,x,s)}var ge=[];function ne(){return ge.pop()||new $}function ae(f){f.needsFree&&Xe.freeType(f.data),$.call(f),ge.push(f)}function ve(){M.call(this),this.genMipmaps=!1,this.mipmapHint=Dr,this.mipmask=0,this.images=Array(16)}function xe(f,P,A){var le=f.images[0]=ne();f.mipmask=1,le.width=f.width=P,le.height=f.height=A,le.channels=f.channels=4}function Le(f,P){var A=null;if(qi(P))A=f.images[0]=ne(),V(A,f),Z(A,P),f.mipmask=1;else if(ue(f,P),Array.isArray(P.mipmap))for(var le=P.mipmap,ke=0;ke<le.length;++ke)A=f.images[ke]=ne(),V(A,f),A.width>>=ke,A.height>>=ke,Z(A,le[ke]),f.mipmask|=1<<ke;else A=f.images[0]=ne(),V(A,f),Z(A,P),f.mipmask=1;V(f,f.images[0]),f.compressed&&(f.internalformat===fr||f.internalformat===Xr||f.internalformat===Ii||f.internalformat===Gi)&&l(f.width%4==0&&f.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Qe(f,P){for(var A=f.images,le=0;le<A.length;++le){if(!A[le])return;ee(A[le],P,le)}}var Ze=[];function Oe(){var f=Ze.pop()||new ve;M.call(f),f.mipmask=0;for(var P=0;P<16;++P)f.images[P]=null;return f}function it(f){for(var P=f.images,A=0;A<P.length;++A)P[A]&&ae(P[A]),P[A]=null;Ze.push(f)}function qe(){this.minFilter=An,this.magFilter=An,this.wrapS=Yr,this.wrapT=Yr,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Dr}function nt(f,P){if("min"in P){var A=P.min;l.parameter(A,q),f.minFilter=q[A],gl.indexOf(f.minFilter)>=0&&!("faces"in P)&&(f.genMipmaps=!0)}if("mag"in P){var le=P.mag;l.parameter(le,K),f.magFilter=K[le]}var ke=f.wrapS,u=f.wrapT;if("wrap"in P){var s=P.wrap;typeof s=="string"?(l.parameter(s,G),ke=u=G[s]):Array.isArray(s)&&(l.parameter(s[0],G),l.parameter(s[1],G),ke=G[s[0]],u=G[s[1]])}else{if("wrapS"in P){var v=P.wrapS;l.parameter(v,G),ke=G[v]}if("wrapT"in P){var w=P.wrapT;l.parameter(w,G),u=G[w]}}if(f.wrapS=ke,f.wrapT=u,"anisotropic"in P){var x=P.anisotropic;l(typeof x=="number"&&x>=1&&x<=h.maxAnisotropic,"aniso samples must be between 1 and "),f.anisotropic=P.anisotropic}if("mipmap"in P){var b=!1;switch(typeof P.mipmap){case"string":l.parameter(P.mipmap,U,"invalid mipmap hint"),f.mipmapHint=U[P.mipmap],f.genMipmaps=!0,b=!0;break;case"boolean":b=f.genMipmaps=P.mipmap;break;case"object":l(Array.isArray(P.mipmap),"invalid mipmap type"),f.genMipmaps=!1,b=!0;break;default:l.raise("invalid mipmap type")}b&&!("min"in P)&&(f.minFilter=St)}}function at(f,P){i.texParameteri(P,ml,f.minFilter),i.texParameteri(P,vr,f.magFilter),i.texParameteri(P,pl,f.wrapS),i.texParameteri(P,hl,f.wrapT),o.ext_texture_filter_anisotropic&&i.texParameteri(P,ps,f.anisotropic),f.genMipmaps&&(i.hint(Zn,f.mipmapHint),i.generateMipmap(P))}var st=0,dt={},vt=h.maxTextureUnits,Je=Array(vt).map(function(){return null});function Se(f){M.call(this),this.mipmask=0,this.internalformat=It,this.id=st++,this.refCount=1,this.target=f,this.texture=i.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new qe,R.profile&&(this.stats={size:0})}function mt(f){i.activeTexture(Tn),i.bindTexture(f.target,f.texture)}function Ue(){var f=Je[0];f?i.bindTexture(f.target,f.texture):i.bindTexture(Nt,null)}function he(f){var P=f.texture;l(P,"must not double destroy texture");var A=f.unit,le=f.target;A>=0&&(i.activeTexture(Tn+A),i.bindTexture(le,null),Je[A]=null),i.deleteTexture(P),f.texture=null,f.params=null,f.pixels=null,f.refCount=0,delete dt[f.id],S.textureCount--}Te(Se.prototype,{bind:function(){var f=this;f.bindCount+=1;var P=f.unit;if(P<0){for(var A=0;A<vt;++A){var le=Je[A];if(le){if(le.bindCount>0)continue;le.unit=-1}Je[A]=f,P=A;break}P>=vt&&l.raise("insufficient number of texture units"),R.profile&&S.maxTextureUnits<P+1&&(S.maxTextureUnits=P+1),f.unit=P,i.activeTexture(Tn+P),i.bindTexture(f.target,f.texture)}return P},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&he(this)}});function Re(f,P){var A=new Se(Nt);dt[A.id]=A,S.textureCount++;function le(s,v){var w=A.texInfo;qe.call(w);var x=Oe();return typeof s=="number"?typeof v=="number"?xe(x,s|0,v|0):xe(x,s|0,s|0):s?(l.type(s,"object","invalid arguments to regl.texture"),nt(w,s),Le(x,s)):xe(x,1,1),w.genMipmaps&&(x.mipmask=(x.width<<1)-1),A.mipmask=x.mipmask,V(A,x),l.texture2D(w,x,h),A.internalformat=x.internalformat,le.width=x.width,le.height=x.height,mt(A),Qe(x,Nt),at(w,Nt),Ue(),it(x),R.profile&&(A.stats.size=ri(A.internalformat,A.type,x.width,x.height,w.genMipmaps,!1)),le.format=H[A.internalformat],le.type=se[A.type],le.mag=I[w.magFilter],le.min=ie[w.minFilter],le.wrapS=re[w.wrapS],le.wrapT=re[w.wrapT],le}function ke(s,v,w,x){l(!!s,"must specify image data");var b=v|0,m=w|0,g=x|0,c=ne();return V(c,A),c.width=0,c.height=0,Z(c,s),c.width=c.width||(A.width>>g)-b,c.height=c.height||(A.height>>g)-m,l(A.type===c.type&&A.format===c.format&&A.internalformat===c.internalformat,"incompatible format for texture.subimage"),l(b>=0&&m>=0&&b+c.width<=A.width&&m+c.height<=A.height,"texture.subimage write out of bounds"),l(A.mipmask&1<<g,"missing mipmap data"),l(c.data||c.element||c.needsCopy,"missing image data"),mt(A),ye(c,Nt,b,m,g),Ue(),ae(c),le}function u(s,v){var w=s|0,x=v|0||w;if(w===A.width&&x===A.height)return le;le.width=A.width=w,le.height=A.height=x,mt(A);for(var b=0;A.mipmask>>b;++b){var m=w>>b,g=x>>b;if(!m||!g)break;i.texImage2D(Nt,b,A.format,m,g,0,A.format,A.type,null)}return Ue(),R.profile&&(A.stats.size=ri(A.internalformat,A.type,w,x,!1,!1)),le}return le(f,P),le.subimage=ke,le.resize=u,le._reglType="texture2d",le._texture=A,R.profile&&(le.stats=A.stats),le.destroy=function(){A.decRef()},le}function Ne(f,P,A,le,ke,u){var s=new Se(At);dt[s.id]=s,S.cubeCount++;var v=new Array(6);function w(m,g,c,p,d,C){var E,D=s.texInfo;for(qe.call(D),E=0;E<6;++E)v[E]=Oe();if(typeof m=="number"||!m){var F=m|0||1;for(E=0;E<6;++E)xe(v[E],F,F)}else if(typeof m=="object")if(g)Le(v[0],m),Le(v[1],g),Le(v[2],c),Le(v[3],p),Le(v[4],d),Le(v[5],C);else if(nt(D,m),ue(s,m),"faces"in m){var W=m.faces;for(l(Array.isArray(W)&&W.length===6,"cube faces must be a length 6 array"),E=0;E<6;++E)l(typeof W[E]=="object"&&!!W[E],"invalid input for cube map face"),V(v[E],s),Le(v[E],W[E])}else for(E=0;E<6;++E)Le(v[E],m);else l.raise("invalid arguments to cube map");for(V(s,v[0]),l.optional(function(){h.npotTextureCube||l(Fi(s.width)&&Fi(s.height),"your browser does not support non power or two texture dimensions")}),D.genMipmaps?s.mipmask=(v[0].width<<1)-1:s.mipmask=v[0].mipmask,l.textureCube(s,D,v,h),s.internalformat=v[0].internalformat,w.width=v[0].width,w.height=v[0].height,mt(s),E=0;E<6;++E)Qe(v[E],Wn+E);for(at(D,At),Ue(),R.profile&&(s.stats.size=ri(s.internalformat,s.type,w.width,w.height,D.genMipmaps,!0)),w.format=H[s.internalformat],w.type=se[s.type],w.mag=I[D.magFilter],w.min=ie[D.minFilter],w.wrapS=re[D.wrapS],w.wrapT=re[D.wrapT],E=0;E<6;++E)it(v[E]);return w}function x(m,g,c,p,d){l(!!g,"must specify image data"),l(typeof m=="number"&&m===(m|0)&&m>=0&&m<6,"invalid face");var C=c|0,E=p|0,D=d|0,F=ne();return V(F,s),F.width=0,F.height=0,Z(F,g),F.width=F.width||(s.width>>D)-C,F.height=F.height||(s.height>>D)-E,l(s.type===F.type&&s.format===F.format&&s.internalformat===F.internalformat,"incompatible format for texture.subimage"),l(C>=0&&E>=0&&C+F.width<=s.width&&E+F.height<=s.height,"texture.subimage write out of bounds"),l(s.mipmask&1<<D,"missing mipmap data"),l(F.data||F.element||F.needsCopy,"missing image data"),mt(s),ye(F,Wn+m,C,E,D),Ue(),ae(F),w}function b(m){var g=m|0;if(g!==s.width){w.width=s.width=g,w.height=s.height=g,mt(s);for(var c=0;c<6;++c)for(var p=0;s.mipmask>>p;++p)i.texImage2D(Wn+c,p,s.format,g>>p,g>>p,0,s.format,s.type,null);return Ue(),R.profile&&(s.stats.size=ri(s.internalformat,s.type,w.width,w.height,!1,!0)),w}}return w(f,P,A,le,ke,u),w.subimage=x,w.resize=b,w._reglType="textureCube",w._texture=s,R.profile&&(w.stats=s.stats),w.destroy=function(){s.decRef()},w}function et(){for(var f=0;f<vt;++f)i.activeTexture(Tn+f),i.bindTexture(Nt,null),Je[f]=null;kt(dt).forEach(he),S.cubeCount=0,S.textureCount=0}R.profile&&(S.getTotalTextureSize=function(){var f=0;return Object.keys(dt).forEach(function(P){f+=dt[P].stats.size}),f});function xr(){for(var f=0;f<vt;++f){var P=Je[f];P&&(P.bindCount=0,P.unit=-1,Je[f]=null)}kt(dt).forEach(function(A){A.texture=i.createTexture(),i.bindTexture(A.target,A.texture);for(var le=0;le<32;++le)if((A.mipmask&1<<le)!=0)if(A.target===Nt)i.texImage2D(Nt,le,A.internalformat,A.width>>le,A.height>>le,0,A.internalformat,A.type,null);else for(var ke=0;ke<6;++ke)i.texImage2D(Wn+ke,le,A.internalformat,A.width>>le,A.height>>le,0,A.internalformat,A.type,null);at(A.texInfo,A.target)})}function Vn(){for(var f=0;f<vt;++f){var P=Je[f];P&&(P.bindCount=0,P.unit=-1,Je[f]=null),i.activeTexture(Tn+f),i.bindTexture(Nt,null),i.bindTexture(At,null)}}return{create2D:Re,createCube:Ne,clear:et,getTexture:function(f){return null},restore:xr,refresh:Vn}}var mr=36161,ni=32854,Ss=32855,Ts=36194,Ps=33189,ks=36168,ii=34041,Ls=35907,Rs=34836,Os=34842,Ds=34843,Ut=[];Ut[ni]=2,Ut[Ss]=2,Ut[Ts]=2,Ut[Ps]=2,Ut[ks]=1,Ut[ii]=4,Ut[Ls]=4,Ut[Rs]=16,Ut[Os]=8,Ut[Ds]=6;function tr(i,o,h){return Ut[i]*o*h}var Vs=function(i,o,h,T,N){var S={rgba4:ni,rgb565:Ts,"rgb5 a1":Ss,depth:Ps,stencil:ks,"depth stencil":ii};o.ext_srgb&&(S.srgba=Ls),o.ext_color_buffer_half_float&&(S.rgba16f=Os,S.rgb16f=Ds),o.webgl_color_buffer_float&&(S.rgba32f=Rs);var R=[];Object.keys(S).forEach(function(j){var z=S[j];R[z]=j});var U=0,G={};function K(j){this.id=U++,this.refCount=1,this.renderbuffer=j,this.format=ni,this.width=0,this.height=0,N.profile&&(this.stats={size:0})}K.prototype.decRef=function(){--this.refCount<=0&&q(this)};function q(j){var z=j.renderbuffer;l(z,"must not double destroy renderbuffer"),i.bindRenderbuffer(mr,null),i.deleteRenderbuffer(z),j.renderbuffer=null,j.refCount=0,delete G[j.id],T.renderbufferCount--}function X(j,z){var y=new K(i.createRenderbuffer());G[y.id]=y,T.renderbufferCount++;function L(se,I){var ie=0,re=0,pe=ni;if(typeof se=="object"&&se){var M=se;if("shape"in M){var V=M.shape;l(Array.isArray(V)&&V.length>=2,"invalid renderbuffer shape"),ie=V[0]|0,re=V[1]|0}else"radius"in M&&(ie=re=M.radius|0),"width"in M&&(ie=M.width|0),"height"in M&&(re=M.height|0);"format"in M&&(l.parameter(M.format,S,"invalid renderbuffer format"),pe=S[M.format])}else typeof se=="number"?(ie=se|0,typeof I=="number"?re=I|0:re=ie):se?l.raise("invalid arguments to renderbuffer constructor"):ie=re=1;if(l(ie>0&&re>0&&ie<=h.maxRenderbufferSize&&re<=h.maxRenderbufferSize,"invalid renderbuffer size"),!(ie===y.width&&re===y.height&&pe===y.format))return L.width=y.width=ie,L.height=y.height=re,y.format=pe,i.bindRenderbuffer(mr,y.renderbuffer),i.renderbufferStorage(mr,pe,ie,re),l(i.getError()===0,"invalid render buffer format"),N.profile&&(y.stats.size=tr(y.format,y.width,y.height)),L.format=R[y.format],L}function H(se,I){var ie=se|0,re=I|0||ie;return ie===y.width&&re===y.height||(l(ie>0&&re>0&&ie<=h.maxRenderbufferSize&&re<=h.maxRenderbufferSize,"invalid renderbuffer size"),L.width=y.width=ie,L.height=y.height=re,i.bindRenderbuffer(mr,y.renderbuffer),i.renderbufferStorage(mr,y.format,ie,re),l(i.getError()===0,"invalid render buffer format"),N.profile&&(y.stats.size=tr(y.format,y.width,y.height))),L}return L(j,z),L.resize=H,L._reglType="renderbuffer",L._renderbuffer=y,N.profile&&(L.stats=y.stats),L.destroy=function(){y.decRef()},L}N.profile&&(T.getTotalRenderbufferSize=function(){var j=0;return Object.keys(G).forEach(function(z){j+=G[z].stats.size}),j});function Y(){kt(G).forEach(function(j){j.renderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(mr,j.renderbuffer),i.renderbufferStorage(mr,j.format,j.width,j.height)}),i.bindRenderbuffer(mr,null)}return{create:X,clear:function(){kt(G).forEach(q)},restore:Y}},rr=36160,Wi=36161,nr=3553,ai=34069,Ns=36064,Ms=36096,Fs=36128,Bs=33306,Is=36053,br=36054,Gs=36055,Jr=36057,Sl=36061,_r=36193,Tl=5121,Us=5126,js=6407,$s=6408,Pl=6402,kl=[js,$s],si=[];si[$s]=4,si[js]=3;var oi=[];oi[Tl]=1,oi[Us]=4,oi[_r]=2;var Hs=32854,Ll=32855,zs=36194,Rl=33189,Ol=36168,Nr=34041,Ks=35907,Dl=34836,Vl=34842,Yi=34843,Nl=[Hs,Ll,zs,Ks,Vl,Yi,Dl],gr={};gr[Is]="complete",gr[br]="incomplete attachment",gr[Jr]="incomplete dimensions",gr[Gs]="incomplete, missing attachment",gr[Sl]="unsupported";function Ml(i,o,h,T,N,S){var R={cur:null,next:null,dirty:!1,setFBO:null},U=["rgba"],G=["rgba4","rgb565","rgb5 a1"];o.ext_srgb&&G.push("srgba"),o.ext_color_buffer_half_float&&G.push("rgba16f","rgb16f"),o.webgl_color_buffer_float&&G.push("rgba32f");var K=["uint8"];o.oes_texture_half_float&&K.push("half float","float16"),o.oes_texture_float&&K.push("float","float32");function q($,Z,ee){this.target=$,this.texture=Z,this.renderbuffer=ee;var ye=0,ge=0;Z?(ye=Z.width,ge=Z.height):ee&&(ye=ee.width,ge=ee.height),this.width=ye,this.height=ge}function X($){$&&($.texture&&$.texture._texture.decRef(),$.renderbuffer&&$.renderbuffer._renderbuffer.decRef())}function Y($,Z,ee){if(!!$)if($.texture){var ye=$.texture._texture,ge=Math.max(1,ye.width),ne=Math.max(1,ye.height);l(ge===Z&&ne===ee,"inconsistent width/height for supplied texture"),ye.refCount+=1}else{var ae=$.renderbuffer._renderbuffer;l(ae.width===Z&&ae.height===ee,"inconsistent width/height for renderbuffer"),ae.refCount+=1}}function j($,Z){Z&&(Z.texture?i.framebufferTexture2D(rr,$,Z.target,Z.texture._texture.texture,0):i.framebufferRenderbuffer(rr,$,Wi,Z.renderbuffer._renderbuffer.renderbuffer))}function z($){var Z=nr,ee=null,ye=null,ge=$;typeof $=="object"&&(ge=$.data,"target"in $&&(Z=$.target|0)),l.type(ge,"function","invalid attachment data");var ne=ge._reglType;return ne==="texture2d"?(ee=ge,l(Z===nr)):ne==="textureCube"?(ee=ge,l(Z>=ai&&Z<ai+6,"invalid cube map target")):ne==="renderbuffer"?(ye=ge,Z=Wi):l.raise("invalid regl object for attachment"),new q(Z,ee,ye)}function y($,Z,ee,ye,ge){if(ee){var ne=T.create2D({width:$,height:Z,format:ye,type:ge});return ne._texture.refCount=0,new q(nr,ne,null)}else{var ae=N.create({width:$,height:Z,format:ye});return ae._renderbuffer.refCount=0,new q(Wi,null,ae)}}function L($){return $&&($.texture||$.renderbuffer)}function H($,Z,ee){$&&($.texture?$.texture.resize(Z,ee):$.renderbuffer&&$.renderbuffer.resize(Z,ee),$.width=Z,$.height=ee)}var se=0,I={};function ie(){this.id=se++,I[this.id]=this,this.framebuffer=i.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function re($){$.colorAttachments.forEach(X),X($.depthAttachment),X($.stencilAttachment),X($.depthStencilAttachment)}function pe($){var Z=$.framebuffer;l(Z,"must not double destroy framebuffer"),i.deleteFramebuffer(Z),$.framebuffer=null,S.framebufferCount--,delete I[$.id]}function M($){var Z;i.bindFramebuffer(rr,$.framebuffer);var ee=$.colorAttachments;for(Z=0;Z<ee.length;++Z)j(Ns+Z,ee[Z]);for(Z=ee.length;Z<h.maxColorAttachments;++Z)i.framebufferTexture2D(rr,Ns+Z,nr,null,0);i.framebufferTexture2D(rr,Bs,nr,null,0),i.framebufferTexture2D(rr,Ms,nr,null,0),i.framebufferTexture2D(rr,Fs,nr,null,0),j(Ms,$.depthAttachment),j(Fs,$.stencilAttachment),j(Bs,$.depthStencilAttachment);var ye=i.checkFramebufferStatus(rr);!i.isContextLost()&&ye!==Is&&l.raise("framebuffer configuration not supported, status = "+gr[ye]),i.bindFramebuffer(rr,R.next?R.next.framebuffer:null),R.cur=R.next,i.getError()}function V($,Z){var ee=new ie;S.framebufferCount++;function ye(ne,ae){var ve;l(R.next!==ee,"can not update framebuffer which is currently in use");var xe=0,Le=0,Qe=!0,Ze=!0,Oe=null,it=!0,qe="rgba",nt="uint8",at=1,st=null,dt=null,vt=null,Je=!1;if(typeof ne=="number")xe=ne|0,Le=ae|0||xe;else if(!ne)xe=Le=1;else{l.type(ne,"object","invalid arguments for framebuffer");var Se=ne;if("shape"in Se){var mt=Se.shape;l(Array.isArray(mt)&&mt.length>=2,"invalid shape for framebuffer"),xe=mt[0],Le=mt[1]}else"radius"in Se&&(xe=Le=Se.radius),"width"in Se&&(xe=Se.width),"height"in Se&&(Le=Se.height);("color"in Se||"colors"in Se)&&(Oe=Se.color||Se.colors,Array.isArray(Oe)&&l(Oe.length===1||o.webgl_draw_buffers,"multiple render targets not supported")),Oe||("colorCount"in Se&&(at=Se.colorCount|0,l(at>0,"invalid color buffer count")),"colorTexture"in Se&&(it=!!Se.colorTexture,qe="rgba4"),"colorType"in Se&&(nt=Se.colorType,it?(l(o.oes_texture_float||!(nt==="float"||nt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),l(o.oes_texture_half_float||!(nt==="half float"||nt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):nt==="half float"||nt==="float16"?(l(o.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),qe="rgba16f"):(nt==="float"||nt==="float32")&&(l(o.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),qe="rgba32f"),l.oneOf(nt,K,"invalid color type")),"colorFormat"in Se&&(qe=Se.colorFormat,U.indexOf(qe)>=0?it=!0:G.indexOf(qe)>=0?it=!1:l.optional(function(){it?l.oneOf(Se.colorFormat,U,"invalid color format for texture"):l.oneOf(Se.colorFormat,G,"invalid color format for renderbuffer")}))),("depthTexture"in Se||"depthStencilTexture"in Se)&&(Je=!!(Se.depthTexture||Se.depthStencilTexture),l(!Je||o.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Se&&(typeof Se.depth=="boolean"?Qe=Se.depth:(st=Se.depth,Ze=!1)),"stencil"in Se&&(typeof Se.stencil=="boolean"?Ze=Se.stencil:(dt=Se.stencil,Qe=!1)),"depthStencil"in Se&&(typeof Se.depthStencil=="boolean"?Qe=Ze=Se.depthStencil:(vt=Se.depthStencil,Qe=!1,Ze=!1))}var Ue=null,he=null,Re=null,Ne=null;if(Array.isArray(Oe))Ue=Oe.map(z);else if(Oe)Ue=[z(Oe)];else for(Ue=new Array(at),ve=0;ve<at;++ve)Ue[ve]=y(xe,Le,it,qe,nt);l(o.webgl_draw_buffers||Ue.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),l(Ue.length<=h.maxColorAttachments,"too many color attachments, not supported"),xe=xe||Ue[0].width,Le=Le||Ue[0].height,st?he=z(st):Qe&&!Ze&&(he=y(xe,Le,Je,"depth","uint32")),dt?Re=z(dt):Ze&&!Qe&&(Re=y(xe,Le,!1,"stencil","uint8")),vt?Ne=z(vt):!st&&!dt&&Ze&&Qe&&(Ne=y(xe,Le,Je,"depth stencil","depth stencil")),l(!!st+!!dt+!!vt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var et=null;for(ve=0;ve<Ue.length;++ve)if(Y(Ue[ve],xe,Le),l(!Ue[ve]||Ue[ve].texture&&kl.indexOf(Ue[ve].texture._texture.format)>=0||Ue[ve].renderbuffer&&Nl.indexOf(Ue[ve].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ve+" is invalid"),Ue[ve]&&Ue[ve].texture){var xr=si[Ue[ve].texture._texture.format]*oi[Ue[ve].texture._texture.type];et===null?et=xr:l(et===xr,"all color attachments much have the same number of bits per pixel.")}return Y(he,xe,Le),l(!he||he.texture&&he.texture._texture.format===Pl||he.renderbuffer&&he.renderbuffer._renderbuffer.format===Rl,"invalid depth attachment for framebuffer object"),Y(Re,xe,Le),l(!Re||Re.renderbuffer&&Re.renderbuffer._renderbuffer.format===Ol,"invalid stencil attachment for framebuffer object"),Y(Ne,xe,Le),l(!Ne||Ne.texture&&Ne.texture._texture.format===Nr||Ne.renderbuffer&&Ne.renderbuffer._renderbuffer.format===Nr,"invalid depth-stencil attachment for framebuffer object"),re(ee),ee.width=xe,ee.height=Le,ee.colorAttachments=Ue,ee.depthAttachment=he,ee.stencilAttachment=Re,ee.depthStencilAttachment=Ne,ye.color=Ue.map(L),ye.depth=L(he),ye.stencil=L(Re),ye.depthStencil=L(Ne),ye.width=ee.width,ye.height=ee.height,M(ee),ye}function ge(ne,ae){l(R.next!==ee,"can not resize a framebuffer which is currently in use");var ve=Math.max(ne|0,1),xe=Math.max(ae|0||ve,1);if(ve===ee.width&&xe===ee.height)return ye;for(var Le=ee.colorAttachments,Qe=0;Qe<Le.length;++Qe)H(Le[Qe],ve,xe);return H(ee.depthAttachment,ve,xe),H(ee.stencilAttachment,ve,xe),H(ee.depthStencilAttachment,ve,xe),ee.width=ye.width=ve,ee.height=ye.height=xe,M(ee),ye}return ye($,Z),Te(ye,{resize:ge,_reglType:"framebuffer",_framebuffer:ee,destroy:function(){pe(ee),re(ee)},use:function(ne){R.setFBO({framebuffer:ye},ne)}})}function ue($){var Z=Array(6);function ee(ge){var ne;l(Z.indexOf(R.next)<0,"can not update framebuffer which is currently in use");var ae={color:null},ve=0,xe=null,Le="rgba",Qe="uint8",Ze=1;if(typeof ge=="number")ve=ge|0;else if(!ge)ve=1;else{l.type(ge,"object","invalid arguments for framebuffer");var Oe=ge;if("shape"in Oe){var it=Oe.shape;l(Array.isArray(it)&&it.length>=2,"invalid shape for framebuffer"),l(it[0]===it[1],"cube framebuffer must be square"),ve=it[0]}else"radius"in Oe&&(ve=Oe.radius|0),"width"in Oe?(ve=Oe.width|0,"height"in Oe&&l(Oe.height===ve,"must be square")):"height"in Oe&&(ve=Oe.height|0);("color"in Oe||"colors"in Oe)&&(xe=Oe.color||Oe.colors,Array.isArray(xe)&&l(xe.length===1||o.webgl_draw_buffers,"multiple render targets not supported")),xe||("colorCount"in Oe&&(Ze=Oe.colorCount|0,l(Ze>0,"invalid color buffer count")),"colorType"in Oe&&(l.oneOf(Oe.colorType,K,"invalid color type"),Qe=Oe.colorType),"colorFormat"in Oe&&(Le=Oe.colorFormat,l.oneOf(Oe.colorFormat,U,"invalid color format for texture"))),"depth"in Oe&&(ae.depth=Oe.depth),"stencil"in Oe&&(ae.stencil=Oe.stencil),"depthStencil"in Oe&&(ae.depthStencil=Oe.depthStencil)}var qe;if(xe)if(Array.isArray(xe))for(qe=[],ne=0;ne<xe.length;++ne)qe[ne]=xe[ne];else qe=[xe];else{qe=Array(Ze);var nt={radius:ve,format:Le,type:Qe};for(ne=0;ne<Ze;++ne)qe[ne]=T.createCube(nt)}for(ae.color=Array(qe.length),ne=0;ne<qe.length;++ne){var at=qe[ne];l(typeof at=="function"&&at._reglType==="textureCube","invalid cube map"),ve=ve||at.width,l(at.width===ve&&at.height===ve,"invalid cube map shape"),ae.color[ne]={target:ai,data:qe[ne]}}for(ne=0;ne<6;++ne){for(var st=0;st<qe.length;++st)ae.color[st].target=ai+ne;ne>0&&(ae.depth=Z[0].depth,ae.stencil=Z[0].stencil,ae.depthStencil=Z[0].depthStencil),Z[ne]?Z[ne](ae):Z[ne]=V(ae)}return Te(ee,{width:ve,height:ve,color:qe})}function ye(ge){var ne,ae=ge|0;if(l(ae>0&&ae<=h.maxCubeMapSize,"invalid radius for cube fbo"),ae===ee.width)return ee;var ve=ee.color;for(ne=0;ne<ve.length;++ne)ve[ne].resize(ae);for(ne=0;ne<6;++ne)Z[ne].resize(ae);return ee.width=ee.height=ae,ee}return ee($),Te(ee,{faces:Z,resize:ye,_reglType:"framebufferCube",destroy:function(){Z.forEach(function(ge){ge.destroy()})}})}function Q(){R.cur=null,R.next=null,R.dirty=!0,kt(I).forEach(function($){$.framebuffer=i.createFramebuffer(),M($)})}return Te(R,{getFramebuffer:function($){if(typeof $=="function"&&$._reglType==="framebuffer"){var Z=$._framebuffer;if(Z instanceof ie)return Z}return null},create:V,createCube:ue,clear:function(){kt(I).forEach(pe)},restore:Q})}var en=5126,Qi=34962,li=34963,Xs=["attributes","elements","offset","count","primitive","instances"];function tn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=en,this.offset=0,this.stride=0,this.divisor=0}function Fl(i,o,h,T,N,S,R){for(var U=h.maxAttributes,G=new Array(U),K=0;K<U;++K)G[K]=new tn;var q=0,X={},Y={Record:tn,scope:{},state:G,currentVAO:null,targetVAO:null,restore:z()?re:function(){},createVAO:pe,getVAO:L,destroyBuffer:j,setVAO:z()?H:se,clear:z()?I:function(){}};function j(M){for(var V=0;V<G.length;++V){var ue=G[V];ue.buffer===M&&(i.disableVertexAttribArray(V),ue.buffer=null)}}function z(){return o.oes_vertex_array_object}function y(){return o.angle_instanced_arrays}function L(M){return typeof M=="function"&&M._vao?M._vao:null}function H(M){if(M!==Y.currentVAO){var V=z();M?V.bindVertexArrayOES(M.vao):V.bindVertexArrayOES(null),Y.currentVAO=M}}function se(M){if(M!==Y.currentVAO){if(M)M.bindAttrs();else{for(var V=y(),ue=0;ue<G.length;++ue){var Q=G[ue];Q.buffer?(i.enableVertexAttribArray(ue),Q.buffer.bind(),i.vertexAttribPointer(ue,Q.size,Q.type,Q.normalized,Q.stride,Q.offfset),V&&Q.divisor&&V.vertexAttribDivisorANGLE(ue,Q.divisor)):(i.disableVertexAttribArray(ue),i.vertexAttrib4f(ue,Q.x,Q.y,Q.z,Q.w))}R.elements?i.bindBuffer(li,R.elements.buffer.buffer):i.bindBuffer(li,null)}Y.currentVAO=M}}function I(){kt(X).forEach(function(M){M.destroy()})}function ie(){this.id=++q,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var M=z();M?this.vao=M.createVertexArrayOES():this.vao=null,X[this.id]=this,this.buffers=[]}ie.prototype.bindAttrs=function(){for(var M=y(),V=this.attributes,ue=0;ue<V.length;++ue){var Q=V[ue];Q.buffer?(i.enableVertexAttribArray(ue),i.bindBuffer(Qi,Q.buffer.buffer),i.vertexAttribPointer(ue,Q.size,Q.type,Q.normalized,Q.stride,Q.offset),M&&Q.divisor&&M.vertexAttribDivisorANGLE(ue,Q.divisor)):(i.disableVertexAttribArray(ue),i.vertexAttrib4f(ue,Q.x,Q.y,Q.z,Q.w))}for(var $=V.length;$<U;++$)i.disableVertexAttribArray($);var Z=S.getElements(this.elements);Z?i.bindBuffer(li,Z.buffer.buffer):i.bindBuffer(li,null)},ie.prototype.refresh=function(){var M=z();M&&(M.bindVertexArrayOES(this.vao),this.bindAttrs(),Y.currentVAO=null,M.bindVertexArrayOES(null))},ie.prototype.destroy=function(){if(this.vao){var M=z();this===Y.currentVAO&&(Y.currentVAO=null,M.bindVertexArrayOES(null)),M.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),X[this.id]&&(delete X[this.id],T.vaoCount-=1)};function re(){var M=z();M&&kt(X).forEach(function(V){V.refresh()})}function pe(M){var V=new ie;T.vaoCount+=1;function ue(Q){var $;if(Array.isArray(Q))$=Q,V.elements&&V.ownsElements&&V.elements.destroy(),V.elements=null,V.ownsElements=!1,V.offset=0,V.count=0,V.instances=-1,V.primitive=4;else{if(l(typeof Q=="object","invalid arguments for create vao"),l("attributes"in Q,"must specify attributes for vao"),Q.elements){var Z=Q.elements;V.ownsElements?typeof Z=="function"&&Z._reglType==="elements"?(V.elements.destroy(),V.ownsElements=!1):(V.elements(Z),V.ownsElements=!1):S.getElements(Q.elements)?(V.elements=Q.elements,V.ownsElements=!1):(V.elements=S.create(Q.elements),V.ownsElements=!0)}else V.elements=null,V.ownsElements=!1;$=Q.attributes,V.offset=0,V.count=-1,V.instances=-1,V.primitive=4,V.elements&&(V.count=V.elements._elements.vertCount,V.primitive=V.elements._elements.primType),"offset"in Q&&(V.offset=Q.offset|0),"count"in Q&&(V.count=Q.count|0),"instances"in Q&&(V.instances=Q.instances|0),"primitive"in Q&&(l(Q.primitive in or,"bad primitive type: "+Q.primitive),V.primitive=or[Q.primitive]),l.optional(()=>{for(var Qe=Object.keys(Q),Ze=0;Ze<Qe.length;++Ze)l(Xs.indexOf(Qe[Ze])>=0,'invalid option for vao: "'+Qe[Ze]+'" valid options are '+Xs)}),l(Array.isArray($),"attributes must be an array")}l($.length<U,"too many attributes"),l($.length>0,"must specify at least one attribute");var ee={},ye=V.attributes;ye.length=$.length;for(var ge=0;ge<$.length;++ge){var ne=$[ge],ae=ye[ge]=new tn,ve=ne.data||ne;if(Array.isArray(ve)||_e(ve)||xt(ve)){var xe;V.buffers[ge]&&(xe=V.buffers[ge],_e(ve)&&xe._buffer.byteLength>=ve.byteLength?xe.subdata(ve):(xe.destroy(),V.buffers[ge]=null)),V.buffers[ge]||(xe=V.buffers[ge]=N.create(ne,Qi,!1,!0)),ae.buffer=N.getBuffer(xe),ae.size=ae.buffer.dimension|0,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1,ee[ge]=1}else N.getBuffer(ne)?(ae.buffer=N.getBuffer(ne),ae.size=ae.buffer.dimension|0,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1):N.getBuffer(ne.buffer)?(ae.buffer=N.getBuffer(ne.buffer),ae.size=(+ne.size||ae.buffer.dimension)|0,ae.normalized=!!ne.normalized||!1,"type"in ne?(l.parameter(ne.type,kr,"invalid buffer type"),ae.type=kr[ne.type]):ae.type=ae.buffer.dtype,ae.offset=(ne.offset||0)|0,ae.stride=(ne.stride||0)|0,ae.divisor=(ne.divisor||0)|0,ae.state=1,l(ae.size>=1&&ae.size<=4,"size must be between 1 and 4"),l(ae.offset>=0,"invalid offset"),l(ae.stride>=0&&ae.stride<=255,"stride must be between 0 and 255"),l(ae.divisor>=0,"divisor must be positive"),l(!ae.divisor||!!o.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ne?(l(ge>0,"first attribute must not be a constant"),ae.x=+ne.x||0,ae.y=+ne.y||0,ae.z=+ne.z||0,ae.w=+ne.w||0,ae.state=2):l(!1,"invalid attribute spec for location "+ge)}for(var Le=0;Le<V.buffers.length;++Le)!ee[Le]&&V.buffers[Le]&&(V.buffers[Le].destroy(),V.buffers[Le]=null);return V.refresh(),ue}return ue.destroy=function(){for(var Q=0;Q<V.buffers.length;++Q)V.buffers[Q]&&V.buffers[Q].destroy();V.buffers.length=0,V.ownsElements&&(V.elements.destroy(),V.elements=null,V.ownsElements=!1),V.destroy()},ue._vao=V,ue._reglType="vao",ue(M)}return Y}var qs=35632,Bl=35633,Il=35718,Gl=35721;function kn(i,o,h,T){var N={},S={};function R(y,L,H,se){this.name=y,this.id=L,this.location=H,this.info=se}function U(y,L){for(var H=0;H<y.length;++H)if(y[H].id===L.id){y[H].location=L.location;return}y.push(L)}function G(y,L,H){var se=y===qs?N:S,I=se[L];if(!I){var ie=o.str(L);I=i.createShader(y),i.shaderSource(I,ie),i.compileShader(I),l.shaderError(i,I,ie,y,H),se[L]=I}return I}var K={},q=[],X=0;function Y(y,L){this.id=X++,this.fragId=y,this.vertId=L,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,T.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function j(y,L,H){var se,I,ie=G(qs,y.fragId),re=G(Bl,y.vertId),pe=y.program=i.createProgram();if(i.attachShader(pe,ie),i.attachShader(pe,re),H)for(se=0;se<H.length;++se){var M=H[se];i.bindAttribLocation(pe,M[0],M[1])}i.linkProgram(pe),l.linkError(i,pe,o.str(y.fragId),o.str(y.vertId),L);var V=i.getProgramParameter(pe,Il);T.profile&&(y.stats.uniformsCount=V);var ue=y.uniforms;for(se=0;se<V;++se)if(I=i.getActiveUniform(pe,se),I){if(I.size>1)for(var Q=0;Q<I.size;++Q){var $=I.name.replace("[0]","["+Q+"]");U(ue,new R($,o.id($),i.getUniformLocation(pe,$),I))}var Z=I.name;I.size>1&&(Z=Z.replace("[0]","")),U(ue,new R(Z,o.id(Z),i.getUniformLocation(pe,Z),I))}var ee=i.getProgramParameter(pe,Gl);T.profile&&(y.stats.attributesCount=ee);var ye=y.attributes;for(se=0;se<ee;++se)I=i.getActiveAttrib(pe,se),I&&U(ye,new R(I.name,o.id(I.name),i.getAttribLocation(pe,I.name),I))}T.profile&&(h.getMaxUniformsCount=function(){var y=0;return q.forEach(function(L){L.stats.uniformsCount>y&&(y=L.stats.uniformsCount)}),y},h.getMaxAttributesCount=function(){var y=0;return q.forEach(function(L){L.stats.attributesCount>y&&(y=L.stats.attributesCount)}),y});function z(){N={},S={};for(var y=0;y<q.length;++y)j(q[y],null,q[y].attributes.map(function(L){return[L.location,L.name]}))}return{clear:function(){var y=i.deleteShader.bind(i);kt(N).forEach(y),N={},kt(S).forEach(y),S={},q.forEach(function(L){i.deleteProgram(L.program)}),q.length=0,K={},h.shaderCount=0},program:function(y,L,H,se){l.command(y>=0,"missing vertex shader",H),l.command(L>=0,"missing fragment shader",H);var I=K[L];I||(I=K[L]={});var ie=I[y];if(ie&&(ie.refCount++,!se))return ie;var re=new Y(L,y);return h.shaderCount++,j(re,H,se),ie||(I[y]=re),q.push(re),Te(re,{destroy:function(){if(re.refCount--,re.refCount<=0){i.deleteProgram(re.program);var pe=q.indexOf(re);q.splice(pe,1),h.shaderCount--}I[re.vertId].refCount<=0&&(i.deleteShader(S[re.vertId]),delete S[re.vertId],delete K[re.fragId][re.vertId]),Object.keys(K[re.fragId]).length||(i.deleteShader(N[re.fragId]),delete N[re.fragId],delete K[re.fragId])}})},restore:z,shader:G,frag:-1,vert:-1}}var Ws=6408,Ln=5121,Zi=3333,Rn=5126;function Ul(i,o,h,T,N,S,R){function U(q){var X;o.next===null?(l(N.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),X=Ln):(l(o.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),X=o.next.colorAttachments[0].texture._texture.type,l.optional(function(){S.oes_texture_float?(l(X===Ln||X===Rn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),X===Rn&&l(R.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):l(X===Ln,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Y=0,j=0,z=T.framebufferWidth,y=T.framebufferHeight,L=null;_e(q)?L=q:q&&(l.type(q,"object","invalid arguments to regl.read()"),Y=q.x|0,j=q.y|0,l(Y>=0&&Y<T.framebufferWidth,"invalid x offset for regl.read"),l(j>=0&&j<T.framebufferHeight,"invalid y offset for regl.read"),z=(q.width||T.framebufferWidth-Y)|0,y=(q.height||T.framebufferHeight-j)|0,L=q.data||null),L&&(X===Ln?l(L instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):X===Rn&&l(L instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),l(z>0&&z+Y<=T.framebufferWidth,"invalid width for read pixels"),l(y>0&&y+j<=T.framebufferHeight,"invalid height for read pixels"),h();var H=z*y*4;return L||(X===Ln?L=new Uint8Array(H):X===Rn&&(L=L||new Float32Array(H))),l.isTypedArray(L,"data buffer for regl.read() must be a typedarray"),l(L.byteLength>=H,"data buffer for regl.read() too small"),i.pixelStorei(Zi,4),i.readPixels(Y,j,z,y,Ws,X,L),L}function G(q){var X;return o.setFBO({framebuffer:q.framebuffer},function(){X=U(q)}),X}function K(q){return!q||!("framebuffer"in q)?U(q):G(q)}return K}function wr(i){return Array.prototype.slice.call(i)}function rn(i){return wr(i).join("")}function jl(){var i=0,o=[],h=[];function T(X){for(var Y=0;Y<h.length;++Y)if(h[Y]===X)return o[Y];var j="g"+i++;return o.push(j),h.push(X),j}function N(){var X=[];function Y(){X.push.apply(X,wr(arguments))}var j=[];function z(){var y="v"+i++;return j.push(y),arguments.length>0&&(X.push(y,"="),X.push.apply(X,wr(arguments)),X.push(";")),y}return Te(Y,{def:z,toString:function(){return rn([j.length>0?"var "+j.join(",")+";":"",rn(X)])}})}function S(){var X=N(),Y=N(),j=X.toString,z=Y.toString;function y(L,H){Y(L,H,"=",X.def(L,H),";")}return Te(function(){X.apply(X,wr(arguments))},{def:X.def,entry:X,exit:Y,save:y,set:function(L,H,se){y(L,H),X(L,H,"=",se,";")},toString:function(){return j()+z()}})}function R(){var X=rn(arguments),Y=S(),j=S(),z=Y.toString,y=j.toString;return Te(Y,{then:function(){return Y.apply(Y,wr(arguments)),this},else:function(){return j.apply(j,wr(arguments)),this},toString:function(){var L=y();return L&&(L="else{"+L+"}"),rn(["if(",X,"){",z(),"}",L])}})}var U=N(),G={};function K(X,Y){var j=[];function z(){var I="a"+j.length;return j.push(I),I}Y=Y||0;for(var y=0;y<Y;++y)z();var L=S(),H=L.toString,se=G[X]=Te(L,{arg:z,toString:function(){return rn(["function(",j.join(),"){",H(),"}"])}});return se}function q(){var X=['"use strict";',U,"return {"];Object.keys(G).forEach(function(z){X.push('"',z,'":',G[z].toString(),",")}),X.push("}");var Y=rn(X).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),j=Function.apply(null,o.concat(Y));return j.apply(null,h)}return{global:U,link:T,block:N,proc:K,scope:S,cond:R,compile:q}}var Lt="xyzw".split(""),Ys=5121,nn=1,On=2,Ji=0,ea=1,ui=2,ta=3,ci=4,Qs=5,Zs=6,Js="dither",eo="blend.enable",to="blend.color",ra="blend.equation",na="blend.func",ia="depth.enable",aa="depth.func",sa="depth.range",ro="depth.mask",oa="colorMask",no="cull.enable",io="cull.face",la="frontFace",ua="lineWidth",ao="polygonOffset.enable",ca="polygonOffset.offset",da="sample.alpha",so="sample.enable",fa="sample.coverage",r="stencil.enable",e="stencil.mask",t="stencil.func",n="stencil.opFront",a="stencil.opBack",_="scissor.enable",k="scissor.box",te="viewport",we="profile",Ee="framebuffer",Be="vert",Ie="frag",Rt="elements",jt="primitive",$t="count",ir="offset",oo="instances",pa="vao",$l="Width",Hl="Height",di=Ee+$l,fi=Ee+Hl,Eu=te+$l,Cu=te+Hl,Jl="drawingBuffer",eu=Jl+$l,tu=Jl+Hl,Au=[na,ra,t,n,a,fa,te,k,ca],pi=34962,zl=34963,Su=35632,Tu=35633,ru=3553,Pu=34067,ku=2884,Lu=3042,Ru=3024,Ou=2960,Du=2929,Vu=3089,Nu=32823,Mu=32926,Fu=32928,Kl=5126,lo=35664,uo=35665,co=35666,Xl=5124,fo=35667,po=35668,ho=35669,ql=35670,vo=35671,mo=35672,bo=35673,ha=35674,va=35675,ma=35676,ba=35678,_a=35680,Wl=4,ga=1028,Dn=1029,nu=2304,Yl=2305,Bu=32775,Iu=32776,Gu=519,an=7680,iu=0,au=1,su=32774,Uu=513,ou=36160,ju=36064,yr={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},lu=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],hi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},sn={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},uu={frag:Su,vert:Tu},Ql={cw:nu,ccw:Yl};function _o(i){return Array.isArray(i)||_e(i)||xt(i)}function cu(i){return i.sort(function(o,h){return o===te?-1:h===te?1:o<h?-1:1})}function ut(i,o,h,T){this.thisDep=i,this.contextDep=o,this.propDep=h,this.append=T}function on(i){return i&&!(i.thisDep||i.contextDep||i.propDep)}function rt(i){return new ut(!1,!1,!1,i)}function Mt(i,o){var h=i.type;if(h===Ji){var T=i.data.length;return new ut(!0,T>=1,T>=2,o)}else if(h===ci){var N=i.data;return new ut(N.thisDep,N.contextDep,N.propDep,o)}else{if(h===Qs)return new ut(!1,!1,!1,o);if(h===Zs){for(var S=!1,R=!1,U=!1,G=0;G<i.data.length;++G){var K=i.data[G];if(K.type===ea)U=!0;else if(K.type===ui)R=!0;else if(K.type===ta)S=!0;else if(K.type===Ji){S=!0;var q=K.data;q>=1&&(R=!0),q>=2&&(U=!0)}else K.type===ci&&(S=S||K.data.thisDep,R=R||K.data.contextDep,U=U||K.data.propDep)}return new ut(S,R,U,o)}else return new ut(h===ta,h===ui,h===ea,o)}}var du=new ut(!1,!1,!1,function(){});function $u(i,o,h,T,N,S,R,U,G,K,q,X,Y,j,z){var y=K.Record,L={add:32774,subtract:32778,"reverse subtract":32779};h.ext_blend_minmax&&(L.min=Bu,L.max=Iu);var H=h.angle_instanced_arrays,se=h.webgl_draw_buffers,I=h.oes_vertex_array_object,ie={dirty:!0,profile:z.profile},re={},pe=[],M={},V={};function ue(u){return u.replace(".","_")}function Q(u,s,v){var w=ue(u);pe.push(u),re[w]=ie[w]=!!v,M[w]=s}function $(u,s,v){var w=ue(u);pe.push(u),Array.isArray(v)?(ie[w]=v.slice(),re[w]=v.slice()):ie[w]=re[w]=v,V[w]=s}Q(Js,Ru),Q(eo,Lu),$(to,"blendColor",[0,0,0,0]),$(ra,"blendEquationSeparate",[su,su]),$(na,"blendFuncSeparate",[au,iu,au,iu]),Q(ia,Du,!0),$(aa,"depthFunc",Uu),$(sa,"depthRange",[0,1]),$(ro,"depthMask",!0),$(oa,oa,[!0,!0,!0,!0]),Q(no,ku),$(io,"cullFace",Dn),$(la,la,Yl),$(ua,ua,1),Q(ao,Nu),$(ca,"polygonOffset",[0,0]),Q(da,Mu),Q(so,Fu),$(fa,"sampleCoverage",[1,!1]),Q(r,Ou),$(e,"stencilMask",-1),$(t,"stencilFunc",[Gu,0,-1]),$(n,"stencilOpSeparate",[ga,an,an,an]),$(a,"stencilOpSeparate",[Dn,an,an,an]),Q(_,Vu),$(k,"scissor",[0,0,i.drawingBufferWidth,i.drawingBufferHeight]),$(te,te,[0,0,i.drawingBufferWidth,i.drawingBufferHeight]);var Z={gl:i,context:Y,strings:o,next:re,current:ie,draw:X,elements:S,buffer:N,shader:q,attributes:K.state,vao:K,uniforms:G,framebuffer:U,extensions:h,timer:j,isBufferArgs:_o},ee={primTypes:or,compareFuncs:hi,blendFuncs:yr,blendEquations:L,stencilOps:sn,glTypes:kr,orientationType:Ql};l.optional(function(){Z.isArrayLike=Ae}),se&&(ee.backBuffer=[Dn],ee.drawBuffer=yt(T.maxDrawbuffers,function(u){return u===0?[0]:yt(u,function(s){return ju+s})}));var ye=0;function ge(){var u=jl(),s=u.link,v=u.global;u.id=ye++,u.batchId="0";var w=s(Z),x=u.shared={props:"a0"};Object.keys(Z).forEach(function(p){x[p]=v.def(w,".",p)}),l.optional(function(){u.CHECK=s(l),u.commandStr=l.guessCommand(),u.command=s(u.commandStr),u.assert=function(p,d,C){p("if(!(",d,"))",this.CHECK,".commandRaise(",s(C),",",this.command,");")},ee.invalidBlendCombinations=lu});var b=u.next={},m=u.current={};Object.keys(V).forEach(function(p){Array.isArray(ie[p])&&(b[p]=v.def(x.next,".",p),m[p]=v.def(x.current,".",p))});var g=u.constants={};Object.keys(ee).forEach(function(p){g[p]=v.def(JSON.stringify(ee[p]))}),u.invoke=function(p,d){switch(d.type){case Ji:var C=["this",x.context,x.props,u.batchId];return p.def(s(d.data),".call(",C.slice(0,Math.max(d.data.length+1,4)),")");case ea:return p.def(x.props,d.data);case ui:return p.def(x.context,d.data);case ta:return p.def("this",d.data);case ci:return d.data.append(u,p),d.data.ref;case Qs:return d.data.toString();case Zs:return d.data.map(function(E){return u.invoke(p,E)})}},u.attribCache={};var c={};return u.scopeAttrib=function(p){var d=o.id(p);if(d in c)return c[d];var C=K.scope[d];C||(C=K.scope[d]=new y);var E=c[d]=s(C);return E},u}function ne(u){var s=u.static,v=u.dynamic,w;if(we in s){var x=!!s[we];w=rt(function(m,g){return x}),w.enable=x}else if(we in v){var b=v[we];w=Mt(b,function(m,g){return m.invoke(g,b)})}return w}function ae(u,s){var v=u.static,w=u.dynamic;if(Ee in v){var x=v[Ee];return x?(x=U.getFramebuffer(x),l.command(x,"invalid framebuffer object"),rt(function(m,g){var c=m.link(x),p=m.shared;g.set(p.framebuffer,".next",c);var d=p.context;return g.set(d,"."+di,c+".width"),g.set(d,"."+fi,c+".height"),c})):rt(function(m,g){var c=m.shared;g.set(c.framebuffer,".next","null");var p=c.context;return g.set(p,"."+di,p+"."+eu),g.set(p,"."+fi,p+"."+tu),"null"})}else if(Ee in w){var b=w[Ee];return Mt(b,function(m,g){var c=m.invoke(g,b),p=m.shared,d=p.framebuffer,C=g.def(d,".getFramebuffer(",c,")");l.optional(function(){m.assert(g,"!"+c+"||"+C,"invalid framebuffer object")}),g.set(d,".next",C);var E=p.context;return g.set(E,"."+di,C+"?"+C+".width:"+E+"."+eu),g.set(E,"."+fi,C+"?"+C+".height:"+E+"."+tu),C})}else return null}function ve(u,s,v){var w=u.static,x=u.dynamic;function b(c){if(c in w){var p=w[c];l.commandType(p,"object","invalid "+c,v.commandStr);var d=!0,C=p.x|0,E=p.y|0,D,F;return"width"in p?(D=p.width|0,l.command(D>=0,"invalid "+c,v.commandStr)):d=!1,"height"in p?(F=p.height|0,l.command(F>=0,"invalid "+c,v.commandStr)):d=!1,new ut(!d&&s&&s.thisDep,!d&&s&&s.contextDep,!d&&s&&s.propDep,function(fe,oe){var B=fe.shared.context,O=D;"width"in p||(O=oe.def(B,".",di,"-",C));var de=F;return"height"in p||(de=oe.def(B,".",fi,"-",E)),[C,E,O,de]})}else if(c in x){var W=x[c],be=Mt(W,function(fe,oe){var B=fe.invoke(oe,W);l.optional(function(){fe.assert(oe,B+"&&typeof "+B+'==="object"',"invalid "+c)});var O=fe.shared.context,de=oe.def(B,".x|0"),ce=oe.def(B,".y|0"),me=oe.def('"width" in ',B,"?",B,".width|0:","(",O,".",di,"-",de,")"),je=oe.def('"height" in ',B,"?",B,".height|0:","(",O,".",fi,"-",ce,")");return l.optional(function(){fe.assert(oe,me+">=0&&"+je+">=0","invalid "+c)}),[de,ce,me,je]});return s&&(be.thisDep=be.thisDep||s.thisDep,be.contextDep=be.contextDep||s.contextDep,be.propDep=be.propDep||s.propDep),be}else return s?new ut(s.thisDep,s.contextDep,s.propDep,function(fe,oe){var B=fe.shared.context;return[0,0,oe.def(B,".",di),oe.def(B,".",fi)]}):null}var m=b(te);if(m){var g=m;m=new ut(m.thisDep,m.contextDep,m.propDep,function(c,p){var d=g.append(c,p),C=c.shared.context;return p.set(C,"."+Eu,d[2]),p.set(C,"."+Cu,d[3]),d})}return{viewport:m,scissor_box:b(k)}}function xe(u,s){var v=u.static,w=typeof v[Ie]=="string"&&typeof v[Be]=="string";if(w){if(Object.keys(s.dynamic).length>0)return null;var x=s.static,b=Object.keys(x);if(b.length>0&&typeof x[b[0]]=="number"){for(var m=[],g=0;g<b.length;++g)l(typeof x[b[g]]=="number","must specify all vertex attribute locations when using vaos"),m.push([x[b[g]]|0,b[g]]);return m}}return null}function Le(u,s,v){var w=u.static,x=u.dynamic;function b(d){if(d in w){var C=o.id(w[d]);l.optional(function(){q.shader(uu[d],C,l.guessCommand())});var E=rt(function(){return C});return E.id=C,E}else if(d in x){var D=x[d];return Mt(D,function(F,W){var be=F.invoke(W,D),fe=W.def(F.shared.strings,".id(",be,")");return l.optional(function(){W(F.shared.shader,".shader(",uu[d],",",fe,",",F.command,");")}),fe})}return null}var m=b(Ie),g=b(Be),c=null,p;return on(m)&&on(g)?(c=q.program(g.id,m.id,null,v),p=rt(function(d,C){return d.link(c)})):p=new ut(m&&m.thisDep||g&&g.thisDep,m&&m.contextDep||g&&g.contextDep,m&&m.propDep||g&&g.propDep,function(d,C){var E=d.shared.shader,D;m?D=m.append(d,C):D=C.def(E,".",Ie);var F;g?F=g.append(d,C):F=C.def(E,".",Be);var W=E+".program("+F+","+D;return l.optional(function(){W+=","+d.command}),C.def(W+")")}),{frag:m,vert:g,progVar:p,program:c}}function Qe(u,s){var v=u.static,w=u.dynamic,x={},b=!1;function m(){if(pa in v){var oe=v[pa];return oe!==null&&K.getVAO(oe)===null&&(oe=K.createVAO(oe)),b=!0,x.vao=oe,rt(function(O){var de=K.getVAO(oe);return de?O.link(de):"null"})}else if(pa in w){b=!0;var B=w[pa];return Mt(B,function(O,de){var ce=O.invoke(de,B);return de.def(O.shared.vao+".getVAO("+ce+")")})}return null}var g=m(),c=!1;function p(){if(Rt in v){var oe=v[Rt];if(x.elements=oe,_o(oe)){var B=x.elements=S.create(oe,!0);oe=S.getElements(B),c=!0}else oe&&(oe=S.getElements(oe),c=!0,l.command(oe,"invalid elements",s.commandStr));var O=rt(function(ce,me){if(oe){var je=ce.link(oe);return ce.ELEMENTS=je,je}return ce.ELEMENTS=null,null});return O.value=oe,O}else if(Rt in w){c=!0;var de=w[Rt];return Mt(de,function(ce,me){var je=ce.shared,bt=je.isBufferArgs,Nn=je.elements,Mr=ce.invoke(me,de),Er=me.def("null"),ln=me.def(bt,"(",Mr,")"),Mn=ce.cond(ln).then(Er,"=",Nn,".createStream(",Mr,");").else(Er,"=",Nn,".getElements(",Mr,");");return l.optional(function(){ce.assert(Mn.else,"!"+Mr+"||"+Er,"invalid elements")}),me.entry(Mn),me.exit(ce.cond(ln).then(Nn,".destroyStream(",Er,");")),ce.ELEMENTS=Er,Er})}else if(b)return new ut(g.thisDep,g.contextDep,g.propDep,function(ce,me){return me.def(ce.shared.vao+".currentVAO?"+ce.shared.elements+".getElements("+ce.shared.vao+".currentVAO.elements):null")});return null}var d=p();function C(){if(jt in v){var oe=v[jt];return x.primitive=oe,l.commandParameter(oe,or,"invalid primitve",s.commandStr),rt(function(O,de){return or[oe]})}else if(jt in w){var B=w[jt];return Mt(B,function(O,de){var ce=O.constants.primTypes,me=O.invoke(de,B);return l.optional(function(){O.assert(de,me+" in "+ce,"invalid primitive, must be one of "+Object.keys(or))}),de.def(ce,"[",me,"]")})}else{if(c)return on(d)?d.value?rt(function(O,de){return de.def(O.ELEMENTS,".primType")}):rt(function(){return Wl}):new ut(d.thisDep,d.contextDep,d.propDep,function(O,de){var ce=O.ELEMENTS;return de.def(ce,"?",ce,".primType:",Wl)});if(b)return new ut(g.thisDep,g.contextDep,g.propDep,function(O,de){return de.def(O.shared.vao+".currentVAO?"+O.shared.vao+".currentVAO.primitive:"+Wl)})}return null}function E(oe,B){if(oe in v){var O=v[oe]|0;return B?x.offset=O:x.instances=O,l.command(!B||O>=0,"invalid "+oe,s.commandStr),rt(function(ce,me){return B&&(ce.OFFSET=O),O})}else if(oe in w){var de=w[oe];return Mt(de,function(ce,me){var je=ce.invoke(me,de);return B&&(ce.OFFSET=je,l.optional(function(){ce.assert(me,je+">=0","invalid "+oe)})),je})}else if(B){if(c)return rt(function(ce,me){return ce.OFFSET=0,0});if(b)return new ut(g.thisDep,g.contextDep,g.propDep,function(ce,me){return me.def(ce.shared.vao+".currentVAO?"+ce.shared.vao+".currentVAO.offset:0")})}else if(b)return new ut(g.thisDep,g.contextDep,g.propDep,function(ce,me){return me.def(ce.shared.vao+".currentVAO?"+ce.shared.vao+".currentVAO.instances:-1")});return null}var D=E(ir,!0);function F(){if($t in v){var oe=v[$t]|0;return x.count=oe,l.command(typeof oe=="number"&&oe>=0,"invalid vertex count",s.commandStr),rt(function(){return oe})}else if($t in w){var B=w[$t];return Mt(B,function(me,je){var bt=me.invoke(je,B);return l.optional(function(){me.assert(je,"typeof "+bt+'==="number"&&'+bt+">=0&&"+bt+"===("+bt+"|0)","invalid vertex count")}),bt})}else if(c)if(on(d)){if(d)return D?new ut(D.thisDep,D.contextDep,D.propDep,function(me,je){var bt=je.def(me.ELEMENTS,".vertCount-",me.OFFSET);return l.optional(function(){me.assert(je,bt+">=0","invalid vertex offset/element buffer too small")}),bt}):rt(function(me,je){return je.def(me.ELEMENTS,".vertCount")});var O=rt(function(){return-1});return l.optional(function(){O.MISSING=!0}),O}else{var de=new ut(d.thisDep||D.thisDep,d.contextDep||D.contextDep,d.propDep||D.propDep,function(me,je){var bt=me.ELEMENTS;return me.OFFSET?je.def(bt,"?",bt,".vertCount-",me.OFFSET,":-1"):je.def(bt,"?",bt,".vertCount:-1")});return l.optional(function(){de.DYNAMIC=!0}),de}else if(b){var ce=new ut(g.thisDep,g.contextDep,g.propDep,function(me,je){return je.def(me.shared.vao,".currentVAO?",me.shared.vao,".currentVAO.count:-1")});return ce}return null}var W=C(),be=F(),fe=E(oo,!1);return{elements:d,primitive:W,count:be,instances:fe,offset:D,vao:g,vaoActive:b,elementsActive:c,static:x}}function Ze(u,s){var v=u.static,w=u.dynamic,x={};return pe.forEach(function(b){var m=ue(b);function g(c,p){if(b in v){var d=c(v[b]);x[m]=rt(function(){return d})}else if(b in w){var C=w[b];x[m]=Mt(C,function(E,D){return p(E,D,E.invoke(D,C))})}}switch(b){case no:case eo:case Js:case r:case ia:case _:case ao:case da:case so:case ro:return g(function(c){return l.commandType(c,"boolean",b,s.commandStr),c},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="boolean"',"invalid flag "+b,c.commandStr)}),d});case aa:return g(function(c){return l.commandParameter(c,hi,"invalid "+b,s.commandStr),hi[c]},function(c,p,d){var C=c.constants.compareFuncs;return l.optional(function(){c.assert(p,d+" in "+C,"invalid "+b+", must be one of "+Object.keys(hi))}),p.def(C,"[",d,"]")});case sa:return g(function(c){return l.command(Ae(c)&&c.length===2&&typeof c[0]=="number"&&typeof c[1]=="number"&&c[0]<=c[1],"depth range is 2d array",s.commandStr),c},function(c,p,d){l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var C=p.def("+",d,"[0]"),E=p.def("+",d,"[1]");return[C,E]});case na:return g(function(c){l.commandType(c,"object","blend.func",s.commandStr);var p="srcRGB"in c?c.srcRGB:c.src,d="srcAlpha"in c?c.srcAlpha:c.src,C="dstRGB"in c?c.dstRGB:c.dst,E="dstAlpha"in c?c.dstAlpha:c.dst;return l.commandParameter(p,yr,m+".srcRGB",s.commandStr),l.commandParameter(d,yr,m+".srcAlpha",s.commandStr),l.commandParameter(C,yr,m+".dstRGB",s.commandStr),l.commandParameter(E,yr,m+".dstAlpha",s.commandStr),l.command(lu.indexOf(p+", "+C)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+p+", "+C+")",s.commandStr),[yr[p],yr[C],yr[d],yr[E]]},function(c,p,d){var C=c.constants.blendFuncs;l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});function E(B,O){var de=p.def('"',B,O,'" in ',d,"?",d,".",B,O,":",d,".",B);return l.optional(function(){c.assert(p,de+" in "+C,"invalid "+b+"."+B+O+", must be one of "+Object.keys(yr))}),de}var D=E("src","RGB"),F=E("dst","RGB");l.optional(function(){var B=c.constants.invalidBlendCombinations;c.assert(p,B+".indexOf("+D+'+", "+'+F+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var W=p.def(C,"[",D,"]"),be=p.def(C,"[",E("src","Alpha"),"]"),fe=p.def(C,"[",F,"]"),oe=p.def(C,"[",E("dst","Alpha"),"]");return[W,fe,be,oe]});case ra:return g(function(c){if(typeof c=="string")return l.commandParameter(c,L,"invalid "+b,s.commandStr),[L[c],L[c]];if(typeof c=="object")return l.commandParameter(c.rgb,L,b+".rgb",s.commandStr),l.commandParameter(c.alpha,L,b+".alpha",s.commandStr),[L[c.rgb],L[c.alpha]];l.commandRaise("invalid blend.equation",s.commandStr)},function(c,p,d){var C=c.constants.blendEquations,E=p.def(),D=p.def(),F=c.cond("typeof ",d,'==="string"');return l.optional(function(){function W(be,fe,oe){c.assert(be,oe+" in "+C,"invalid "+fe+", must be one of "+Object.keys(L))}W(F.then,b,d),c.assert(F.else,d+"&&typeof "+d+'==="object"',"invalid "+b),W(F.else,b+".rgb",d+".rgb"),W(F.else,b+".alpha",d+".alpha")}),F.then(E,"=",D,"=",C,"[",d,"];"),F.else(E,"=",C,"[",d,".rgb];",D,"=",C,"[",d,".alpha];"),p(F),[E,D]});case to:return g(function(c){return l.command(Ae(c)&&c.length===4,"blend.color must be a 4d array",s.commandStr),yt(4,function(p){return+c[p]})},function(c,p,d){return l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===4","blend.color must be a 4d array")}),yt(4,function(C){return p.def("+",d,"[",C,"]")})});case e:return g(function(c){return l.commandType(c,"number",m,s.commandStr),c|0},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="number"',"invalid stencil.mask")}),p.def(d,"|0")});case t:return g(function(c){l.commandType(c,"object",m,s.commandStr);var p=c.cmp||"keep",d=c.ref||0,C="mask"in c?c.mask:-1;return l.commandParameter(p,hi,b+".cmp",s.commandStr),l.commandType(d,"number",b+".ref",s.commandStr),l.commandType(C,"number",b+".mask",s.commandStr),[hi[p],d,C]},function(c,p,d){var C=c.constants.compareFuncs;l.optional(function(){function W(){c.assert(p,Array.prototype.join.call(arguments,""),"invalid stencil.func")}W(d+"&&typeof ",d,'==="object"'),W('!("cmp" in ',d,")||(",d,".cmp in ",C,")")});var E=p.def('"cmp" in ',d,"?",C,"[",d,".cmp]",":",an),D=p.def(d,".ref|0"),F=p.def('"mask" in ',d,"?",d,".mask|0:-1");return[E,D,F]});case n:case a:return g(function(c){l.commandType(c,"object",m,s.commandStr);var p=c.fail||"keep",d=c.zfail||"keep",C=c.zpass||"keep";return l.commandParameter(p,sn,b+".fail",s.commandStr),l.commandParameter(d,sn,b+".zfail",s.commandStr),l.commandParameter(C,sn,b+".zpass",s.commandStr),[b===a?Dn:ga,sn[p],sn[d],sn[C]]},function(c,p,d){var C=c.constants.stencilOps;l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid "+b)});function E(D){return l.optional(function(){c.assert(p,'!("'+D+'" in '+d+")||("+d+"."+D+" in "+C+")","invalid "+b+"."+D+", must be one of "+Object.keys(sn))}),p.def('"',D,'" in ',d,"?",C,"[",d,".",D,"]:",an)}return[b===a?Dn:ga,E("fail"),E("zfail"),E("zpass")]});case ca:return g(function(c){l.commandType(c,"object",m,s.commandStr);var p=c.factor|0,d=c.units|0;return l.commandType(p,"number",m+".factor",s.commandStr),l.commandType(d,"number",m+".units",s.commandStr),[p,d]},function(c,p,d){l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid "+b)});var C=p.def(d,".factor|0"),E=p.def(d,".units|0");return[C,E]});case io:return g(function(c){var p=0;return c==="front"?p=ga:c==="back"&&(p=Dn),l.command(!!p,m,s.commandStr),p},function(c,p,d){return l.optional(function(){c.assert(p,d+'==="front"||'+d+'==="back"',"invalid cull.face")}),p.def(d,'==="front"?',ga,":",Dn)});case ua:return g(function(c){return l.command(typeof c=="number"&&c>=T.lineWidthDims[0]&&c<=T.lineWidthDims[1],"invalid line width, must be a positive number between "+T.lineWidthDims[0]+" and "+T.lineWidthDims[1],s.commandStr),c},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="number"&&'+d+">="+T.lineWidthDims[0]+"&&"+d+"<="+T.lineWidthDims[1],"invalid line width")}),d});case la:return g(function(c){return l.commandParameter(c,Ql,m,s.commandStr),Ql[c]},function(c,p,d){return l.optional(function(){c.assert(p,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),p.def(d+'==="cw"?'+nu+":"+Yl)});case oa:return g(function(c){return l.command(Ae(c)&&c.length===4,"color.mask must be length 4 array",s.commandStr),c.map(function(p){return!!p})},function(c,p,d){return l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")}),yt(4,function(C){return"!!"+d+"["+C+"]"})});case fa:return g(function(c){l.command(typeof c=="object"&&c,m,s.commandStr);var p="value"in c?c.value:1,d=!!c.invert;return l.command(typeof p=="number"&&p>=0&&p<=1,"sample.coverage.value must be a number between 0 and 1",s.commandStr),[p,d]},function(c,p,d){l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var C=p.def('"value" in ',d,"?+",d,".value:1"),E=p.def("!!",d,".invert");return[C,E]})}}),x}function Oe(u,s){var v=u.static,w=u.dynamic,x={};return Object.keys(v).forEach(function(b){var m=v[b],g;if(typeof m=="number"||typeof m=="boolean")g=rt(function(){return m});else if(typeof m=="function"){var c=m._reglType;c==="texture2d"||c==="textureCube"?g=rt(function(p){return p.link(m)}):c==="framebuffer"||c==="framebufferCube"?(l.command(m.color.length>0,'missing color attachment for framebuffer sent to uniform "'+b+'"',s.commandStr),g=rt(function(p){return p.link(m.color[0])})):l.commandRaise('invalid data for uniform "'+b+'"',s.commandStr)}else Ae(m)?g=rt(function(p){var d=p.global.def("[",yt(m.length,function(C){return l.command(typeof m[C]=="number"||typeof m[C]=="boolean","invalid uniform "+b,p.commandStr),m[C]}),"]");return d}):l.commandRaise('invalid or missing data for uniform "'+b+'"',s.commandStr);g.value=m,x[b]=g}),Object.keys(w).forEach(function(b){var m=w[b];x[b]=Mt(m,function(g,c){return g.invoke(c,m)})}),x}function it(u,s){var v=u.static,w=u.dynamic,x={};return Object.keys(v).forEach(function(b){var m=v[b],g=o.id(b),c=new y;if(_o(m))c.state=nn,c.buffer=N.getBuffer(N.create(m,pi,!1,!0)),c.type=0;else{var p=N.getBuffer(m);if(p)c.state=nn,c.buffer=p,c.type=0;else if(l.command(typeof m=="object"&&m,"invalid data for attribute "+b,s.commandStr),"constant"in m){var d=m.constant;c.buffer="null",c.state=On,typeof d=="number"?c.x=d:(l.command(Ae(d)&&d.length>0&&d.length<=4,"invalid constant for attribute "+b,s.commandStr),Lt.forEach(function(fe,oe){oe<d.length&&(c[fe]=d[oe])}))}else{_o(m.buffer)?p=N.getBuffer(N.create(m.buffer,pi,!1,!0)):p=N.getBuffer(m.buffer),l.command(!!p,'missing buffer for attribute "'+b+'"',s.commandStr);var C=m.offset|0;l.command(C>=0,'invalid offset for attribute "'+b+'"',s.commandStr);var E=m.stride|0;l.command(E>=0&&E<256,'invalid stride for attribute "'+b+'", must be integer betweeen [0, 255]',s.commandStr);var D=m.size|0;l.command(!("size"in m)||D>0&&D<=4,'invalid size for attribute "'+b+'", must be 1,2,3,4',s.commandStr);var F=!!m.normalized,W=0;"type"in m&&(l.commandParameter(m.type,kr,"invalid type for attribute "+b,s.commandStr),W=kr[m.type]);var be=m.divisor|0;l.optional(function(){"divisor"in m&&(l.command(be===0||H,'cannot specify divisor for attribute "'+b+'", instancing not supported',s.commandStr),l.command(be>=0,'invalid divisor for attribute "'+b+'"',s.commandStr));var fe=s.commandStr,oe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(m).forEach(function(B){l.command(oe.indexOf(B)>=0,'unknown parameter "'+B+'" for attribute pointer "'+b+'" (valid parameters are '+oe+")",fe)})}),c.buffer=p,c.state=nn,c.size=D,c.normalized=F,c.type=W||p.dtype,c.offset=C,c.stride=E,c.divisor=be}}x[b]=rt(function(fe,oe){var B=fe.attribCache;if(g in B)return B[g];var O={isStream:!1};return Object.keys(c).forEach(function(de){O[de]=c[de]}),c.buffer&&(O.buffer=fe.link(c.buffer),O.type=O.type||O.buffer+".dtype"),B[g]=O,O})}),Object.keys(w).forEach(function(b){var m=w[b];function g(c,p){var d=c.invoke(p,m),C=c.shared,E=c.constants,D=C.isBufferArgs,F=C.buffer;l.optional(function(){c.assert(p,d+"&&(typeof "+d+'==="object"||typeof '+d+'==="function")&&('+D+"("+d+")||"+F+".getBuffer("+d+")||"+F+".getBuffer("+d+".buffer)||"+D+"("+d+'.buffer)||("constant" in '+d+"&&(typeof "+d+'.constant==="number"||'+C.isArrayLike+"("+d+".constant))))",'invalid dynamic attribute "'+b+'"')});var W={isStream:p.def(!1)},be=new y;be.state=nn,Object.keys(be).forEach(function(O){W[O]=p.def(""+be[O])});var fe=W.buffer,oe=W.type;p("if(",D,"(",d,")){",W.isStream,"=true;",fe,"=",F,".createStream(",pi,",",d,");",oe,"=",fe,".dtype;","}else{",fe,"=",F,".getBuffer(",d,");","if(",fe,"){",oe,"=",fe,".dtype;",'}else if("constant" in ',d,"){",W.state,"=",On,";","if(typeof "+d+'.constant === "number"){',W[Lt[0]],"=",d,".constant;",Lt.slice(1).map(function(O){return W[O]}).join("="),"=0;","}else{",Lt.map(function(O,de){return W[O]+"="+d+".constant.length>"+de+"?"+d+".constant["+de+"]:0;"}).join(""),"}}else{","if(",D,"(",d,".buffer)){",fe,"=",F,".createStream(",pi,",",d,".buffer);","}else{",fe,"=",F,".getBuffer(",d,".buffer);","}",oe,'="type" in ',d,"?",E.glTypes,"[",d,".type]:",fe,".dtype;",W.normalized,"=!!",d,".normalized;");function B(O){p(W[O],"=",d,".",O,"|0;")}return B("size"),B("offset"),B("stride"),B("divisor"),p("}}"),p.exit("if(",W.isStream,"){",F,".destroyStream(",fe,");","}"),W}x[b]=Mt(m,g)}),x}function qe(u){var s=u.static,v=u.dynamic,w={};return Object.keys(s).forEach(function(x){var b=s[x];w[x]=rt(function(m,g){return typeof b=="number"||typeof b=="boolean"?""+b:m.link(b)})}),Object.keys(v).forEach(function(x){var b=v[x];w[x]=Mt(b,function(m,g){return m.invoke(g,b)})}),w}function nt(u,s,v,w,x){var b=u.static,m=u.dynamic;l.optional(function(){var B=[Ee,Be,Ie,Rt,jt,ir,$t,oo,we,pa].concat(pe);function O(de){Object.keys(de).forEach(function(ce){l.command(B.indexOf(ce)>=0,'unknown parameter "'+ce+'"',x.commandStr)})}O(b),O(m)});var g=xe(u,s),c=ae(u),p=ve(u,c,x),d=Qe(u,x),C=Ze(u,x),E=Le(u,x,g);function D(B){var O=p[B];O&&(C[B]=O)}D(te),D(ue(k));var F=Object.keys(C).length>0,W={framebuffer:c,draw:d,shader:E,state:C,dirty:F,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(W.profile=ne(u),W.uniforms=Oe(v,x),W.drawVAO=W.scopeVAO=d.vao,!W.drawVAO&&E.program&&!g&&h.angle_instanced_arrays&&d.static.elements){var be=!0,fe=E.program.attributes.map(function(B){var O=s.static[B];return be=be&&!!O,O});if(be&&fe.length>0){var oe=K.getVAO(K.createVAO({attributes:fe,elements:d.static.elements}));W.drawVAO=new ut(null,null,null,function(B,O){return B.link(oe)}),W.useVAO=!0}}return g?W.useVAO=!0:W.attributes=it(s,x),W.context=qe(w),W}function at(u,s,v){var w=u.shared,x=w.context,b=u.scope();Object.keys(v).forEach(function(m){s.save(x,"."+m);var g=v[m],c=g.append(u,s);Array.isArray(c)?b(x,".",m,"=[",c.join(),"];"):b(x,".",m,"=",c,";")}),s(b)}function st(u,s,v,w){var x=u.shared,b=x.gl,m=x.framebuffer,g;se&&(g=s.def(x.extensions,".webgl_draw_buffers"));var c=u.constants,p=c.drawBuffer,d=c.backBuffer,C;v?C=v.append(u,s):C=s.def(m,".next"),w||s("if(",C,"!==",m,".cur){"),s("if(",C,"){",b,".bindFramebuffer(",ou,",",C,".framebuffer);"),se&&s(g,".drawBuffersWEBGL(",p,"[",C,".colorAttachments.length]);"),s("}else{",b,".bindFramebuffer(",ou,",null);"),se&&s(g,".drawBuffersWEBGL(",d,");"),s("}",m,".cur=",C,";"),w||s("}")}function dt(u,s,v){var w=u.shared,x=w.gl,b=u.current,m=u.next,g=w.current,c=w.next,p=u.cond(g,".dirty");pe.forEach(function(d){var C=ue(d);if(!(C in v.state)){var E,D;if(C in m){E=m[C],D=b[C];var F=yt(ie[C].length,function(be){return p.def(E,"[",be,"]")});p(u.cond(F.map(function(be,fe){return be+"!=="+D+"["+fe+"]"}).join("||")).then(x,".",V[C],"(",F,");",F.map(function(be,fe){return D+"["+fe+"]="+be}).join(";"),";"))}else{E=p.def(c,".",C);var W=u.cond(E,"!==",g,".",C);p(W),C in M?W(u.cond(E).then(x,".enable(",M[C],");").else(x,".disable(",M[C],");"),g,".",C,"=",E,";"):W(x,".",V[C],"(",E,");",g,".",C,"=",E,";")}}}),Object.keys(v.state).length===0&&p(g,".dirty=false;"),s(p)}function vt(u,s,v,w){var x=u.shared,b=u.current,m=x.current,g=x.gl;cu(Object.keys(v)).forEach(function(c){var p=v[c];if(!(w&&!w(p))){var d=p.append(u,s);if(M[c]){var C=M[c];on(p)?d?s(g,".enable(",C,");"):s(g,".disable(",C,");"):s(u.cond(d).then(g,".enable(",C,");").else(g,".disable(",C,");")),s(m,".",c,"=",d,";")}else if(Ae(d)){var E=b[c];s(g,".",V[c],"(",d,");",d.map(function(D,F){return E+"["+F+"]="+D}).join(";"),";")}else s(g,".",V[c],"(",d,");",m,".",c,"=",d,";")}})}function Je(u,s){H&&(u.instancing=s.def(u.shared.extensions,".angle_instanced_arrays"))}function Se(u,s,v,w,x){var b=u.shared,m=u.stats,g=b.current,c=b.timer,p=v.profile;function d(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var C,E;function D(B){C=s.def(),B(C,"=",d(),";"),typeof x=="string"?B(m,".count+=",x,";"):B(m,".count++;"),j&&(w?(E=s.def(),B(E,"=",c,".getNumPendingQueries();")):B(c,".beginQuery(",m,");"))}function F(B){B(m,".cpuTime+=",d(),"-",C,";"),j&&(w?B(c,".pushScopeStats(",E,",",c,".getNumPendingQueries(),",m,");"):B(c,".endQuery();"))}function W(B){var O=s.def(g,".profile");s(g,".profile=",B,";"),s.exit(g,".profile=",O,";")}var be;if(p){if(on(p)){p.enable?(D(s),F(s.exit),W("true")):W("false");return}be=p.append(u,s),W(be)}else be=s.def(g,".profile");var fe=u.block();D(fe),s("if(",be,"){",fe,"}");var oe=u.block();F(oe),s.exit("if(",be,"){",oe,"}")}function mt(u,s,v,w,x){var b=u.shared;function m(c){switch(c){case lo:case fo:case vo:return 2;case uo:case po:case mo:return 3;case co:case ho:case bo:return 4;default:return 1}}function g(c,p,d){var C=b.gl,E=s.def(c,".location"),D=s.def(b.attributes,"[",E,"]"),F=d.state,W=d.buffer,be=[d.x,d.y,d.z,d.w],fe=["buffer","normalized","offset","stride"];function oe(){s("if(!",D,".buffer){",C,".enableVertexAttribArray(",E,");}");var O=d.type,de;if(d.size?de=s.def(d.size,"||",p):de=p,s("if(",D,".type!==",O,"||",D,".size!==",de,"||",fe.map(function(me){return D+"."+me+"!=="+d[me]}).join("||"),"){",C,".bindBuffer(",pi,",",W,".buffer);",C,".vertexAttribPointer(",[E,de,O,d.normalized,d.stride,d.offset],");",D,".type=",O,";",D,".size=",de,";",fe.map(function(me){return D+"."+me+"="+d[me]+";"}).join(""),"}"),H){var ce=d.divisor;s("if(",D,".divisor!==",ce,"){",u.instancing,".vertexAttribDivisorANGLE(",[E,ce],");",D,".divisor=",ce,";}")}}function B(){s("if(",D,".buffer){",C,".disableVertexAttribArray(",E,");",D,".buffer=null;","}if(",Lt.map(function(O,de){return D+"."+O+"!=="+be[de]}).join("||"),"){",C,".vertexAttrib4f(",E,",",be,");",Lt.map(function(O,de){return D+"."+O+"="+be[de]+";"}).join(""),"}")}F===nn?oe():F===On?B():(s("if(",F,"===",nn,"){"),oe(),s("}else{"),B(),s("}"))}w.forEach(function(c){var p=c.name,d=v.attributes[p],C;if(d){if(!x(d))return;C=d.append(u,s)}else{if(!x(du))return;var E=u.scopeAttrib(p);l.optional(function(){u.assert(s,E+".state","missing attribute "+p)}),C={},Object.keys(new y).forEach(function(D){C[D]=s.def(E,".",D)})}g(u.link(c),m(c.info.type),C)})}function Ue(u,s,v,w,x,b){for(var m=u.shared,g=m.gl,c={},p,d=0;d<w.length;++d){var C=w[d],E=C.name,D=C.info.type,F=C.info.size,W=v.uniforms[E];if(F>1){if(!W)continue;var be=E.replace("[0]","");if(c[be])continue;c[be]=1}var fe=u.link(C),oe=fe+".location",B;if(W){if(!x(W))continue;if(on(W)){var O=W.value;if(l.command(O!==null&&typeof O!="undefined",'missing uniform "'+E+'"',u.commandStr),D===ba||D===_a){l.command(typeof O=="function"&&(D===ba&&(O._reglType==="texture2d"||O._reglType==="framebuffer")||D===_a&&(O._reglType==="textureCube"||O._reglType==="framebufferCube")),"invalid texture for uniform "+E,u.commandStr);var de=u.link(O._texture||O.color[0]._texture);s(g,".uniform1i(",oe,",",de+".bind());"),s.exit(de,".unbind();")}else if(D===ha||D===va||D===ma){l.optional(function(){l.command(Ae(O),"invalid matrix for uniform "+E,u.commandStr),l.command(D===ha&&O.length===4||D===va&&O.length===9||D===ma&&O.length===16,"invalid length for matrix uniform "+E,u.commandStr)});var ce=u.global.def("new Float32Array(["+Array.prototype.slice.call(O)+"])"),me=2;D===va?me=3:D===ma&&(me=4),s(g,".uniformMatrix",me,"fv(",oe,",false,",ce,");")}else{switch(D){case Kl:F===1?l.commandType(O,"number","uniform "+E,u.commandStr):l.command(Ae(O)&&O.length===F,"uniform "+E,u.commandStr),p="1f";break;case lo:l.command(Ae(O)&&O.length&&O.length%2==0&&O.length<=F*2,"uniform "+E,u.commandStr),p="2f";break;case uo:l.command(Ae(O)&&O.length&&O.length%3==0&&O.length<=F*3,"uniform "+E,u.commandStr),p="3f";break;case co:l.command(Ae(O)&&O.length&&O.length%4==0&&O.length<=F*4,"uniform "+E,u.commandStr),p="4f";break;case ql:F===1?l.commandType(O,"boolean","uniform "+E,u.commandStr):l.command(Ae(O)&&O.length===F,"uniform "+E,u.commandStr),p="1i";break;case Xl:F===1?l.commandType(O,"number","uniform "+E,u.commandStr):l.command(Ae(O)&&O.length===F,"uniform "+E,u.commandStr),p="1i";break;case vo:l.command(Ae(O)&&O.length&&O.length%2==0&&O.length<=F*2,"uniform "+E,u.commandStr),p="2i";break;case fo:l.command(Ae(O)&&O.length&&O.length%2==0&&O.length<=F*2,"uniform "+E,u.commandStr),p="2i";break;case mo:l.command(Ae(O)&&O.length&&O.length%3==0&&O.length<=F*3,"uniform "+E,u.commandStr),p="3i";break;case po:l.command(Ae(O)&&O.length&&O.length%3==0&&O.length<=F*3,"uniform "+E,u.commandStr),p="3i";break;case bo:l.command(Ae(O)&&O.length&&O.length%4==0&&O.length<=F*4,"uniform "+E,u.commandStr),p="4i";break;case ho:l.command(Ae(O)&&O.length&&O.length%4==0&&O.length<=F*4,"uniform "+E,u.commandStr),p="4i";break}F>1?(p+="v",O=u.global.def("["+Array.prototype.slice.call(O)+"]")):O=Ae(O)?Array.prototype.slice.call(O):O,s(g,".uniform",p,"(",oe,",",O,");")}continue}else B=W.append(u,s)}else{if(!x(du))continue;B=s.def(m.uniforms,"[",o.id(E),"]")}D===ba?(l(!Array.isArray(B),"must specify a scalar prop for textures"),s("if(",B,"&&",B,'._reglType==="framebuffer"){',B,"=",B,".color[0];","}")):D===_a&&(l(!Array.isArray(B),"must specify a scalar prop for cube maps"),s("if(",B,"&&",B,'._reglType==="framebufferCube"){',B,"=",B,".color[0];","}")),l.optional(function(){function Ht(Ft,go){u.assert(s,Ft,'bad data or missing for uniform "'+E+'".  '+go)}function Fn(Ft,go){go===1&&l(!Array.isArray(B),"must not specify an array type for uniform"),Ht("Array.isArray("+B+") && typeof "+B+'[0]===" '+Ft+'" || typeof '+B+'==="'+Ft+'"',"invalid type, expected "+Ft)}function Xt(Ft,go,wo){Array.isArray(B)?l(B.length&&B.length%Ft==0&&B.length<=Ft*wo,"must have length of "+(wo===1?"":"n * ")+Ft):Ht(m.isArrayLike+"("+B+")&&"+B+".length && "+B+".length % "+Ft+" === 0 && "+B+".length<="+Ft*wo,"invalid vector, should have length of "+(wo===1?"":"n * ")+Ft,u.commandStr)}function _u(Ft){l(!Array.isArray(B),"must not specify a value type"),Ht("typeof "+B+'==="function"&&'+B+'._reglType==="texture'+(Ft===ru?"2d":"Cube")+'"',"invalid texture type",u.commandStr)}switch(D){case Xl:Fn("number",F);break;case fo:Xt(2,"number",F);break;case po:Xt(3,"number",F);break;case ho:Xt(4,"number",F);break;case Kl:Fn("number",F);break;case lo:Xt(2,"number",F);break;case uo:Xt(3,"number",F);break;case co:Xt(4,"number",F);break;case ql:Fn("boolean",F);break;case vo:Xt(2,"boolean",F);break;case mo:Xt(3,"boolean",F);break;case bo:Xt(4,"boolean",F);break;case ha:Xt(4,"number",F);break;case va:Xt(9,"number",F);break;case ma:Xt(16,"number",F);break;case ba:_u(ru);break;case _a:_u(Pu);break}});var je=1;switch(D){case ba:case _a:var bt=s.def(B,"._texture");s(g,".uniform1i(",oe,",",bt,".bind());"),s.exit(bt,".unbind();");continue;case Xl:case ql:p="1i";break;case fo:case vo:p="2i",je=2;break;case po:case mo:p="3i",je=3;break;case ho:case bo:p="4i",je=4;break;case Kl:p="1f";break;case lo:p="2f",je=2;break;case uo:p="3f",je=3;break;case co:p="4f",je=4;break;case ha:p="Matrix2fv";break;case va:p="Matrix3fv";break;case ma:p="Matrix4fv";break}if(p.indexOf("Matrix")===-1&&F>1&&(p+="v",je=1),p.charAt(0)==="M"){s(g,".uniform",p,"(",oe,",");var Nn=Math.pow(D-ha+2,2),Mr=u.global.def("new Float32Array(",Nn,")");Array.isArray(B)?s("false,(",yt(Nn,function(Ht){return Mr+"["+Ht+"]="+B[Ht]}),",",Mr,")"):s("false,(Array.isArray(",B,")||",B," instanceof Float32Array)?",B,":(",yt(Nn,function(Ht){return Mr+"["+Ht+"]="+B+"["+Ht+"]"}),",",Mr,")"),s(");")}else if(je>1){for(var Er=[],ln=[],Mn=0;Mn<je;++Mn)Array.isArray(B)?ln.push(B[Mn]):ln.push(s.def(B+"["+Mn+"]")),b&&Er.push(s.def());b&&s("if(!",u.batchId,"||",Er.map(function(Ht,Fn){return Ht+"!=="+ln[Fn]}).join("||"),"){",Er.map(function(Ht,Fn){return Ht+"="+ln[Fn]+";"}).join("")),s(g,".uniform",p,"(",oe,",",ln.join(","),");"),b&&s("}")}else{if(l(!Array.isArray(B),"uniform value must not be an array"),b){var bu=s.def();s("if(!",u.batchId,"||",bu,"!==",B,"){",bu,"=",B,";")}s(g,".uniform",p,"(",oe,",",B,");"),b&&s("}")}}}function he(u,s,v,w){var x=u.shared,b=x.gl,m=x.draw,g=w.draw;function c(){var de=g.elements,ce,me=s;return de?((de.contextDep&&w.contextDynamic||de.propDep)&&(me=v),ce=de.append(u,me),g.elementsActive&&me("if("+ce+")"+b+".bindBuffer("+zl+","+ce+".buffer.buffer);")):(ce=me.def(),me(ce,"=",m,".",Rt,";","if(",ce,"){",b,".bindBuffer(",zl,",",ce,".buffer.buffer);}","else if(",x.vao,".currentVAO){",ce,"=",u.shared.elements+".getElements("+x.vao,".currentVAO.elements);",I?"":"if("+ce+")"+b+".bindBuffer("+zl+","+ce+".buffer.buffer);","}")),ce}function p(){var de=g.count,ce,me=s;return de?((de.contextDep&&w.contextDynamic||de.propDep)&&(me=v),ce=de.append(u,me),l.optional(function(){de.MISSING&&u.assert(s,"false","missing vertex count"),de.DYNAMIC&&u.assert(me,ce+">=0","missing vertex count")})):(ce=me.def(m,".",$t),l.optional(function(){u.assert(me,ce+">=0","missing vertex count")})),ce}var d=c();function C(de){var ce=g[de];return ce?ce.contextDep&&w.contextDynamic||ce.propDep?ce.append(u,v):ce.append(u,s):s.def(m,".",de)}var E=C(jt),D=C(ir),F=p();if(typeof F=="number"){if(F===0)return}else v("if(",F,"){"),v.exit("}");var W,be;H&&(W=C(oo),be=u.instancing);var fe=d+".type",oe=g.elements&&on(g.elements)&&!g.vaoActive;function B(){function de(){v(be,".drawElementsInstancedANGLE(",[E,F,fe,D+"<<(("+fe+"-"+Ys+")>>1)",W],");")}function ce(){v(be,".drawArraysInstancedANGLE(",[E,D,F,W],");")}d&&d!=="null"?oe?de():(v("if(",d,"){"),de(),v("}else{"),ce(),v("}")):ce()}function O(){function de(){v(b+".drawElements("+[E,F,fe,D+"<<(("+fe+"-"+Ys+")>>1)"]+");")}function ce(){v(b+".drawArrays("+[E,D,F]+");")}d&&d!=="null"?oe?de():(v("if(",d,"){"),de(),v("}else{"),ce(),v("}")):ce()}H&&(typeof W!="number"||W>=0)?typeof W=="string"?(v("if(",W,">0){"),B(),v("}else if(",W,"<0){"),O(),v("}")):B():O()}function Re(u,s,v,w,x){var b=ge(),m=b.proc("body",x);return l.optional(function(){b.commandStr=s.commandStr,b.command=b.link(s.commandStr)}),H&&(b.instancing=m.def(b.shared.extensions,".angle_instanced_arrays")),u(b,m,v,w),b.compile().body}function Ne(u,s,v,w){Je(u,s),v.useVAO?v.drawVAO?s(u.shared.vao,".setVAO(",v.drawVAO.append(u,s),");"):s(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(s(u.shared.vao,".setVAO(null);"),mt(u,s,v,w.attributes,function(){return!0})),Ue(u,s,v,w.uniforms,function(){return!0},!1),he(u,s,s,v)}function et(u,s){var v=u.proc("draw",1);Je(u,v),at(u,v,s.context),st(u,v,s.framebuffer),dt(u,v,s),vt(u,v,s.state),Se(u,v,s,!1,!0);var w=s.shader.progVar.append(u,v);if(v(u.shared.gl,".useProgram(",w,".program);"),s.shader.program)Ne(u,v,s,s.shader.program);else{v(u.shared.vao,".setVAO(null);");var x=u.global.def("{}"),b=v.def(w,".id"),m=v.def(x,"[",b,"]");v(u.cond(m).then(m,".call(this,a0);").else(m,"=",x,"[",b,"]=",u.link(function(g){return Re(Ne,u,s,g,1)}),"(",w,");",m,".call(this,a0);"))}Object.keys(s.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function xr(u,s,v,w){u.batchId="a1",Je(u,s);function x(){return!0}mt(u,s,v,w.attributes,x),Ue(u,s,v,w.uniforms,x,!1),he(u,s,s,v)}function Vn(u,s,v,w){Je(u,s);var x=v.contextDep,b=s.def(),m="a0",g="a1",c=s.def();u.shared.props=c,u.batchId=b;var p=u.scope(),d=u.scope();s(p.entry,"for(",b,"=0;",b,"<",g,";++",b,"){",c,"=",m,"[",b,"];",d,"}",p.exit);function C(fe){return fe.contextDep&&x||fe.propDep}function E(fe){return!C(fe)}if(v.needsContext&&at(u,d,v.context),v.needsFramebuffer&&st(u,d,v.framebuffer),vt(u,d,v.state,C),v.profile&&C(v.profile)&&Se(u,d,v,!1,!0),w)v.useVAO?v.drawVAO?C(v.drawVAO)?d(u.shared.vao,".setVAO(",v.drawVAO.append(u,d),");"):p(u.shared.vao,".setVAO(",v.drawVAO.append(u,p),");"):p(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(p(u.shared.vao,".setVAO(null);"),mt(u,p,v,w.attributes,E),mt(u,d,v,w.attributes,C)),Ue(u,p,v,w.uniforms,E,!1),Ue(u,d,v,w.uniforms,C,!0),he(u,p,d,v);else{var D=u.global.def("{}"),F=v.shader.progVar.append(u,d),W=d.def(F,".id"),be=d.def(D,"[",W,"]");d(u.shared.gl,".useProgram(",F,".program);","if(!",be,"){",be,"=",D,"[",W,"]=",u.link(function(fe){return Re(xr,u,v,fe,2)}),"(",F,");}",be,".call(this,a0[",b,"],",b,");")}}function f(u,s){var v=u.proc("batch",2);u.batchId="0",Je(u,v);var w=!1,x=!0;Object.keys(s.context).forEach(function(D){w=w||s.context[D].propDep}),w||(at(u,v,s.context),x=!1);var b=s.framebuffer,m=!1;b?(b.propDep?w=m=!0:b.contextDep&&w&&(m=!0),m||st(u,v,b)):st(u,v,null),s.state.viewport&&s.state.viewport.propDep&&(w=!0);function g(D){return D.contextDep&&w||D.propDep}dt(u,v,s),vt(u,v,s.state,function(D){return!g(D)}),(!s.profile||!g(s.profile))&&Se(u,v,s,!1,"a1"),s.contextDep=w,s.needsContext=x,s.needsFramebuffer=m;var c=s.shader.progVar;if(c.contextDep&&w||c.propDep)Vn(u,v,s,null);else{var p=c.append(u,v);if(v(u.shared.gl,".useProgram(",p,".program);"),s.shader.program)Vn(u,v,s,s.shader.program);else{v(u.shared.vao,".setVAO(null);");var d=u.global.def("{}"),C=v.def(p,".id"),E=v.def(d,"[",C,"]");v(u.cond(E).then(E,".call(this,a0,a1);").else(E,"=",d,"[",C,"]=",u.link(function(D){return Re(Vn,u,s,D,2)}),"(",p,");",E,".call(this,a0,a1);"))}}Object.keys(s.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function P(u,s){var v=u.proc("scope",3);u.batchId="a2";var w=u.shared,x=w.current;at(u,v,s.context),s.framebuffer&&s.framebuffer.append(u,v),cu(Object.keys(s.state)).forEach(function(m){var g=s.state[m],c=g.append(u,v);Ae(c)?c.forEach(function(p,d){v.set(u.next[m],"["+d+"]",p)}):v.set(w.next,"."+m,c)}),Se(u,v,s,!0,!0),[Rt,ir,$t,oo,jt].forEach(function(m){var g=s.draw[m];!g||v.set(w.draw,"."+m,""+g.append(u,v))}),Object.keys(s.uniforms).forEach(function(m){var g=s.uniforms[m].append(u,v);Array.isArray(g)&&(g="["+g.join()+"]"),v.set(w.uniforms,"["+o.id(m)+"]",g)}),Object.keys(s.attributes).forEach(function(m){var g=s.attributes[m].append(u,v),c=u.scopeAttrib(m);Object.keys(new y).forEach(function(p){v.set(c,"."+p,g[p])})}),s.scopeVAO&&v.set(w.vao,".targetVAO",s.scopeVAO.append(u,v));function b(m){var g=s.shader[m];g&&v.set(w.shader,"."+m,g.append(u,v))}b(Be),b(Ie),Object.keys(s.state).length>0&&(v(x,".dirty=true;"),v.exit(x,".dirty=true;")),v("a1(",u.shared.context,",a0,",u.batchId,");")}function A(u){if(!(typeof u!="object"||Ae(u))){for(var s=Object.keys(u),v=0;v<s.length;++v)if(gt.isDynamic(u[s[v]]))return!0;return!1}}function le(u,s,v){var w=s.static[v];if(!w||!A(w))return;var x=u.global,b=Object.keys(w),m=!1,g=!1,c=!1,p=u.global.def("{}");b.forEach(function(C){var E=w[C];if(gt.isDynamic(E)){typeof E=="function"&&(E=w[C]=gt.unbox(E));var D=Mt(E,null);m=m||D.thisDep,c=c||D.propDep,g=g||D.contextDep}else{switch(x(p,".",C,"="),typeof E){case"number":x(E);break;case"string":x('"',E,'"');break;case"object":Array.isArray(E)&&x("[",E.join(),"]");break;default:x(u.link(E));break}x(";")}});function d(C,E){b.forEach(function(D){var F=w[D];if(!!gt.isDynamic(F)){var W=C.invoke(E,F);E(p,".",D,"=",W,";")}})}s.dynamic[v]=new gt.DynamicVariable(ci,{thisDep:m,contextDep:g,propDep:c,ref:p,append:d}),delete s.static[v]}function ke(u,s,v,w,x){var b=ge();b.stats=b.link(x),Object.keys(s.static).forEach(function(g){le(b,s,g)}),Au.forEach(function(g){le(b,u,g)});var m=nt(u,s,v,w,b);return et(b,m),P(b,m),f(b,m),Te(b.compile(),{destroy:function(){m.shader.program.destroy()}})}return{next:re,current:ie,procs:function(){var u=ge(),s=u.proc("poll"),v=u.proc("refresh"),w=u.block();s(w),v(w);var x=u.shared,b=x.gl,m=x.next,g=x.current;w(g,".dirty=false;"),st(u,s),st(u,v,null,!0);var c;H&&(c=u.link(H)),h.oes_vertex_array_object&&v(u.link(h.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<T.maxAttributes;++p){var d=v.def(x.attributes,"[",p,"]"),C=u.cond(d,".buffer");C.then(b,".enableVertexAttribArray(",p,");",b,".bindBuffer(",pi,",",d,".buffer.buffer);",b,".vertexAttribPointer(",p,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(b,".disableVertexAttribArray(",p,");",b,".vertexAttrib4f(",p,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),v(C),H&&v(c,".vertexAttribDivisorANGLE(",p,",",d,".divisor);")}return v(u.shared.vao,".currentVAO=null;",u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"),Object.keys(M).forEach(function(E){var D=M[E],F=w.def(m,".",E),W=u.block();W("if(",F,"){",b,".enable(",D,")}else{",b,".disable(",D,")}",g,".",E,"=",F,";"),v(W),s("if(",F,"!==",g,".",E,"){",W,"}")}),Object.keys(V).forEach(function(E){var D=V[E],F=ie[E],W,be,fe=u.block();if(fe(b,".",D,"("),Ae(F)){var oe=F.length;W=u.global.def(m,".",E),be=u.global.def(g,".",E),fe(yt(oe,function(B){return W+"["+B+"]"}),");",yt(oe,function(B){return be+"["+B+"]="+W+"["+B+"];"}).join("")),s("if(",yt(oe,function(B){return W+"["+B+"]!=="+be+"["+B+"]"}).join("||"),"){",fe,"}")}else W=w.def(m,".",E),be=w.def(g,".",E),fe(W,");",g,".",E,"=",W,";"),s("if(",W,"!==",be,"){",fe,"}");v(fe)}),u.compile()}(),compile:ke}}function Hu(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var zu=34918,Ku=34919,fu=35007,Xu=function(i,o){if(!o.ext_disjoint_timer_query)return null;var h=[];function T(){return h.pop()||o.ext_disjoint_timer_query.createQueryEXT()}function N(H){h.push(H)}var S=[];function R(H){var se=T();o.ext_disjoint_timer_query.beginQueryEXT(fu,se),S.push(se),j(S.length-1,S.length,H)}function U(){o.ext_disjoint_timer_query.endQueryEXT(fu)}function G(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var K=[];function q(){return K.pop()||new G}function X(H){K.push(H)}var Y=[];function j(H,se,I){var ie=q();ie.startQueryIndex=H,ie.endQueryIndex=se,ie.sum=0,ie.stats=I,Y.push(ie)}var z=[],y=[];function L(){var H,se,I=S.length;if(I!==0){y.length=Math.max(y.length,I+1),z.length=Math.max(z.length,I+1),z[0]=0,y[0]=0;var ie=0;for(H=0,se=0;se<S.length;++se){var re=S[se];o.ext_disjoint_timer_query.getQueryObjectEXT(re,Ku)?(ie+=o.ext_disjoint_timer_query.getQueryObjectEXT(re,zu),N(re)):S[H++]=re,z[se+1]=ie,y[se+1]=H}for(S.length=H,H=0,se=0;se<Y.length;++se){var pe=Y[se],M=pe.startQueryIndex,V=pe.endQueryIndex;pe.sum+=z[V]-z[M];var ue=y[M],Q=y[V];Q===ue?(pe.stats.gpuTime+=pe.sum/1e6,X(pe)):(pe.startQueryIndex=ue,pe.endQueryIndex=Q,Y[H++]=pe)}Y.length=H}}return{beginQuery:R,endQuery:U,pushScopeStats:j,update:L,getNumPendingQueries:function(){return S.length},clear:function(){h.push.apply(h,S);for(var H=0;H<h.length;H++)o.ext_disjoint_timer_query.deleteQueryEXT(h[H]);S.length=0,h.length=0},restore:function(){S.length=0,h.length=0}}},qu=16384,Wu=256,Yu=1024,Qu=34962,pu="webglcontextlost",hu="webglcontextrestored",vu=1,Zu=2,Ju=3;function mu(i,o){for(var h=0;h<i.length;++h)if(i[h]===o)return h;return-1}function ec(i){var o=Vo(i);if(!o)return null;var h=o.gl,T=h.getContextAttributes(),N=h.isContextLost(),S=hn(h,o);if(!S)return null;var R=Oo(),U=Hu(),G=S.extensions,K=Xu(h,G),q=ka(),X=h.drawingBufferWidth,Y=h.drawingBufferHeight,j={tick:0,time:0,viewportWidth:X,viewportHeight:Y,framebufferWidth:X,framebufferHeight:Y,drawingBufferWidth:X,drawingBufferHeight:Y,pixelRatio:o.pixelRatio},z={},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},L=Qo(h,G),H=ll(h,U,o,ie),se=Jt(h,G,H,U),I=Fl(h,G,L,U,H,se,y);function ie(he){return I.destroyBuffer(he)}var re=kn(h,R,U,o),pe=Al(h,G,L,function(){ue.procs.poll()},j,U,o),M=Vs(h,G,L,U,o),V=Ml(h,G,L,pe,M,U),ue=$u(h,R,G,L,H,se,pe,V,z,I,re,y,j,K,o),Q=Ul(h,V,ue.procs.poll,j,T,G,L),$=ue.next,Z=h.canvas,ee=[],ye=[],ge=[],ne=[o.onDestroy],ae=null;function ve(){if(ee.length===0){K&&K.update(),ae=null;return}ae=xi.next(ve),vt();for(var he=ee.length-1;he>=0;--he){var Re=ee[he];Re&&Re(j,null,0)}h.flush(),K&&K.update()}function xe(){!ae&&ee.length>0&&(ae=xi.next(ve))}function Le(){ae&&(xi.cancel(ve),ae=null)}function Qe(he){he.preventDefault(),N=!0,Le(),ye.forEach(function(Re){Re()})}function Ze(he){h.getError(),N=!1,S.restore(),re.restore(),H.restore(),pe.restore(),M.restore(),V.restore(),I.restore(),K&&K.restore(),ue.procs.refresh(),xe(),ge.forEach(function(Re){Re()})}Z&&(Z.addEventListener(pu,Qe,!1),Z.addEventListener(hu,Ze,!1));function Oe(){ee.length=0,Le(),Z&&(Z.removeEventListener(pu,Qe),Z.removeEventListener(hu,Ze)),re.clear(),V.clear(),M.clear(),I.clear(),pe.clear(),se.clear(),H.clear(),K&&K.clear(),ne.forEach(function(he){he()})}function it(he){l(!!he,"invalid args to regl({...})"),l.type(he,"object","invalid args to regl({...})");function Re(x){var b=Te({},x);delete b.uniforms,delete b.attributes,delete b.context,delete b.vao,"stencil"in b&&b.stencil.op&&(b.stencil.opBack=b.stencil.opFront=b.stencil.op,delete b.stencil.op);function m(g){if(g in b){var c=b[g];delete b[g],Object.keys(c).forEach(function(p){b[g+"."+p]=c[p]})}}return m("blend"),m("depth"),m("cull"),m("stencil"),m("polygonOffset"),m("scissor"),m("sample"),"vao"in x&&(b.vao=x.vao),b}function Ne(x,b){var m={},g={};return Object.keys(x).forEach(function(c){var p=x[c];if(gt.isDynamic(p)){g[c]=gt.unbox(p,c);return}else if(b&&Array.isArray(p)){for(var d=0;d<p.length;++d)if(gt.isDynamic(p[d])){g[c]=gt.unbox(p,c);return}}m[c]=p}),{dynamic:g,static:m}}var et=Ne(he.context||{},!0),xr=Ne(he.uniforms||{},!0),Vn=Ne(he.attributes||{},!1),f=Ne(Re(he),!1),P={gpuTime:0,cpuTime:0,count:0},A=ue.compile(f,Vn,xr,et,P),le=A.draw,ke=A.batch,u=A.scope,s=[];function v(x){for(;s.length<x;)s.push(null);return s}function w(x,b){var m;if(N&&l.raise("context lost"),typeof x=="function")return u.call(this,null,x,0);if(typeof b=="function")if(typeof x=="number")for(m=0;m<x;++m)u.call(this,null,b,m);else if(Array.isArray(x))for(m=0;m<x.length;++m)u.call(this,x[m],b,m);else return u.call(this,x,b,0);else if(typeof x=="number"){if(x>0)return ke.call(this,v(x|0),x|0)}else if(Array.isArray(x)){if(x.length)return ke.call(this,x,x.length)}else return le.call(this,x)}return Te(w,{stats:P,destroy:function(){A.destroy()}})}var qe=V.setFBO=it({framebuffer:gt.define.call(null,vu,"framebuffer")});function nt(he,Re){var Ne=0;ue.procs.poll();var et=Re.color;et&&(h.clearColor(+et[0]||0,+et[1]||0,+et[2]||0,+et[3]||0),Ne|=qu),"depth"in Re&&(h.clearDepth(+Re.depth),Ne|=Wu),"stencil"in Re&&(h.clearStencil(Re.stencil|0),Ne|=Yu),l(!!Ne,"called regl.clear with no buffer specified"),h.clear(Ne)}function at(he){if(l(typeof he=="object"&&he,"regl.clear() takes an object as input"),"framebuffer"in he)if(he.framebuffer&&he.framebuffer_reglType==="framebufferCube")for(var Re=0;Re<6;++Re)qe(Te({framebuffer:he.framebuffer.faces[Re]},he),nt);else qe(he,nt);else nt(null,he)}function st(he){l.type(he,"function","regl.frame() callback must be a function"),ee.push(he);function Re(){var Ne=mu(ee,he);l(Ne>=0,"cannot cancel a frame twice");function et(){var xr=mu(ee,et);ee[xr]=ee[ee.length-1],ee.length-=1,ee.length<=0&&Le()}ee[Ne]=et}return xe(),{cancel:Re}}function dt(){var he=$.viewport,Re=$.scissor_box;he[0]=he[1]=Re[0]=Re[1]=0,j.viewportWidth=j.framebufferWidth=j.drawingBufferWidth=he[2]=Re[2]=h.drawingBufferWidth,j.viewportHeight=j.framebufferHeight=j.drawingBufferHeight=he[3]=Re[3]=h.drawingBufferHeight}function vt(){j.tick+=1,j.time=Se(),dt(),ue.procs.poll()}function Je(){pe.refresh(),dt(),ue.procs.refresh(),K&&K.update()}function Se(){return(ka()-q)/1e3}Je();function mt(he,Re){l.type(Re,"function","listener callback must be a function");var Ne;switch(he){case"frame":return st(Re);case"lost":Ne=ye;break;case"restore":Ne=ge;break;case"destroy":Ne=ne;break;default:l.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ne.push(Re),{cancel:function(){for(var et=0;et<Ne.length;++et)if(Ne[et]===Re){Ne[et]=Ne[Ne.length-1],Ne.pop();return}}}}var Ue=Te(it,{clear:at,prop:gt.define.bind(null,vu),context:gt.define.bind(null,Zu),this:gt.define.bind(null,Ju),draw:it({}),buffer:function(he){return H.create(he,Qu,!1,!1)},elements:function(he){return se.create(he,!1)},texture:pe.create2D,cube:pe.createCube,renderbuffer:M.create,framebuffer:V.create,framebufferCube:V.createCube,vao:I.createVAO,attributes:T,frame:st,on:mt,limits:L,hasExtension:function(he){return L.extensions.indexOf(he.toLowerCase())>=0},read:Q,destroy:Oe,_gl:h,_refresh:Je,poll:function(){vt(),K&&K.update()},now:Se,stats:U});return o.onDone(null,Ue),Ue}return ec})})(wu);var sc=wu.exports,yu={exports:{}};/*! Tweakpane 3.0.5 (c) 2016 cocopon, licensed under the MIT license. */(function(J,$e){(function(_e,Te){Te($e)})(gu,function(_e){class Te{constructor(e){const[t,n]=e.split("-"),a=t.split(".");this.major=parseInt(a[0],10),this.minor=parseInt(a[1],10),this.patch=parseInt(a[2],10),this.prerelease=n!=null?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}class Ge{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class ot{constructor(e){this.target=e}}class He extends ot{constructor(e,t,n,a){super(e);this.value=t,this.presetKey=n,this.last=a!=null?a:!0}}class Pe extends ot{constructor(e,t,n){super(e);this.value=t,this.presetKey=n}}class lt extends ot{constructor(e,t){super(e);this.expanded=t}}function Ke(r){return r}function De(r){return r==null}function Ot(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}const Bt={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Ce{constructor(e){var t;this.message=(t=Bt[e.type](Ke(e.context)))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new Ce({type:"alreadydisposed"})}static notBindable(){return new Ce({type:"notbindable"})}static propertyNotFound(e){return new Ce({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Ce({type:"shouldneverhappen"})}}class Dt{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=n!=null?n:t}static isBindable(e){return!(e===null||typeof e!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!Dt.isBindable(n))throw Ce.notBindable();if(!(e in n))throw Ce.propertyNotFound(e);n[e]=t}}class qt extends Ge{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return(e=this.controller_.valueController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller_.valueController.emitter.on(e,()=>{n(new ot(this))}),this}}class ze{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(a=>a.handler!==t)),this}emit(e,t){const n=this.observers_[e];!n||n.forEach(a=>{a.handler(t)})}}const Wt="tp";function Ve(r){return(t,n)=>[Wt,"-",r,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function un(r,e){return t=>e(r(t))}function cn(r){return r.rawValue}function _t(r,e){r.emitter.on("change",un(cn,e)),e(r.rawValue)}function ft(r,e,t){_t(r.value(e),t)}function vi(r,e,t){t?r.classList.add(e):r.classList.remove(e)}function Fr(r,e){return t=>{vi(r,e,t)}}function mi(r,e){_t(r,t=>{e.textContent=t!=null?t:""})}const bi=Ve("btn");class yo{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(bi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(bi("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(bi("t")),mi(t.props.value("title"),a),this.buttonElement.appendChild(a)}}class _i{constructor(e,t){this.emitter=new ze,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new yo(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class xo{constructor(e,t){var n;this.constraint_=t==null?void 0:t.constraint,this.equals_=(n=t==null?void 0:t.equals)!==null&&n!==void 0?n:(a,_)=>a===_,this.emitter=new ze,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0},a=this.constraint_?this.constraint_.constrain(e):e;!!this.equals_(this.rawValue_,a)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=a,this.emitter.emit("change",{options:n,rawValue:a,sender:this}))}}class Bn{constructor(e){this.emitter=new ze,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0};this.value_===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function wt(r,e){const t=e==null?void 0:e.constraint,n=e==null?void 0:e.equals;return!t&&!n?new Bn(r):new xo(r,e)}class Me{constructor(e){this.emitter=new ze,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,a)=>Object.assign(n,{[a]:wt(e[a])}),{})}static fromObject(e){const t=this.createCore(e);return new Me(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function wa(r,e){const n=Object.keys(e).reduce((a,_)=>{if(a===void 0)return;const te=e[_](r[_]);return te.succeeded?Object.assign(Object.assign({},a),{[_]:te.value}):void 0},{});return Ke(n)}function Eo(r,e){return r.reduce((t,n)=>{if(t===void 0)return;const a=e(n);if(!(!a.succeeded||a.value===void 0))return[...t,a.value]},[])}function Co(r){return r===null?!1:typeof r=="object"}function Vt(r){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=r(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function gi(r){return{custom:e=>Vt(e)(r),boolean:Vt(e=>typeof e=="boolean"?e:void 0)(r),number:Vt(e=>typeof e=="number"?e:void 0)(r),string:Vt(e=>typeof e=="string"?e:void 0)(r),function:Vt(e=>typeof e=="function"?e:void 0)(r),constant:e=>Vt(t=>t===e?e:void 0)(r),raw:Vt(e=>e)(r),object:e=>Vt(t=>{if(!!Co(t))return wa(t,e)})(r),array:e=>Vt(t=>{if(!!Array.isArray(t))return Eo(t,e)})(r)}}const We={optional:gi(!0),required:gi(!1)};function ct(r,e){const t=We.required.object(e)(r);return t.succeeded?t.value:void 0}function Ao(r){return r&&r.parentElement&&r.parentElement.removeChild(r),null}function So(){return["veryfirst","first","last","verylast"]}const ya=Ve(""),xa={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class dn{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{So().forEach(n=>{t.classList.remove(ya(void 0,xa[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(ya(void 0,xa[n]))})}),this.viewProps.handleDispose(()=>{Ao(t)})}get parent(){return this.parent_}}const zt="http://www.w3.org/2000/svg";function In(r){r.offsetHeight}function To(r,e){const t=r.style.transition;r.style.transition="none",e(),r.style.transition=t}function Gn(r){return r.ontouchstart!==void 0}function wi(){return new Function("return this")()}function Ea(){return Ke(wi()).document}function Ca(){return"document"in wi()}function Aa(r){return Ca()?r.getContext("2d"):null}const Po={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function pt(r,e){const t=r.createElementNS(zt,"svg");return t.innerHTML=Po[e],t}function yi(r,e,t){r.insertBefore(e,r.children[t])}function fn(r){r.parentElement&&r.parentElement.removeChild(r)}function Sa(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function ko(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function l(r){return r.relatedTarget?Ke(r.relatedTarget):"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}const pn=Ve("lbl");function Lo(r,e){const t=r.createDocumentFragment();return e.split(`
`).map(a=>r.createTextNode(a)).forEach((a,_)=>{_>0&&t.appendChild(r.createElement("br")),t.appendChild(a)}),t}class Ta{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(pn("l")),ft(t.props,"label",_=>{De(_)?this.element.classList.add(pn(void 0,"nol")):(this.element.classList.remove(pn(void 0,"nol")),ko(n),n.appendChild(Lo(e,_)))}),this.element.appendChild(n),this.labelElement=n;const a=e.createElement("div");a.classList.add(pn("v")),this.element.appendChild(a),this.valueElement=a}}class Un extends dn{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new Ta(e,{props:t.props,viewProps:n}),viewProps:n}));this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Cr={id:"button",type:"blade",accept(r){const e=We,t=ct(r,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return t?{params:t}:null},controller(r){return new Un(r.document,{blade:r.blade,props:Me.fromObject({label:r.params.label}),valueController:new _i(r.document,{props:Me.fromObject({title:r.params.title}),viewProps:r.viewProps})})},api(r){return!(r.controller instanceof Un)||!(r.controller.valueController instanceof _i)?null:new qt(r.controller)}};class Ar extends dn{constructor(e){super(e);this.value=e.value}}function Yt(){return new Me({positions:wt([],{equals:Ot})})}class Br extends Me{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=Me.createCore(t);return new Br(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!De(e)?`${e}px`:"auto"}bindExpandedClass(e,t){ft(this,"expanded",()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)})}}function Ro(r,e){let t=0;return To(e,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),In(e),t=e.clientHeight,r.set("temporaryExpanded",null),In(e)}),t}function Pa(r,e){e.style.height=r.styleHeight}function jn(r,e){r.value("expanded").emitter.on("beforechange",()=>{r.set("completed",!1),De(r.get("expandedHeight"))&&r.set("expandedHeight",Ro(r,e)),r.set("shouldFixHeight",!0),In(e)}),r.emitter.on("change",()=>{Pa(r,e)}),Pa(r,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&(r.set("shouldFixHeight",!1),r.set("expandedHeight",null),r.set("completed",!0))})}class gt extends Ge{constructor(e,t){super(e);this.rackApi_=t}}function xi(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function ka(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function Oo(r,e){const t=e||{};return r.addBlade(Object.assign(Object.assign({},t),{view:"separator"}))}function Do(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class Ei{constructor(e){this.emitter=new ze,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Ce.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const a=this.extract_(e);a&&(a.emitter.on("add",this.onSubListAdd_),a.emitter.on("remove",this.onSubListRemove_),a.allItems().forEach(_=>{this.cache_.add(_)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class Ci extends Ge{constructor(e){super(e);this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new ze,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new He(this,Ke(t),this.controller_.binding.target.presetKey,e.options.last)})}}class Kt extends Un{constructor(e,t){super(e,t);this.binding=t.binding}}class $n extends Ge{constructor(e){super(e);this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new ze,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new Pe(this,Ke(t),this.controller_.binding.target.presetKey)})}}class Qt extends Un{constructor(e,t){super(e,t);this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Vo(r){return r instanceof Hn?r.apiSet_:r instanceof gt?r.rackApi_.apiSet_:null}function hn(r,e){const t=r.find(n=>n.controller_===e);if(!t)throw Ce.shouldNeverHappen();return t}function yt(r,e,t){if(!Dt.isBindable(r))throw Ce.notBindable();return new Dt(r,e,t)}class Hn extends Ge{constructor(e,t){super(e);this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new ze,this.apiSet_=new Ei(Vo),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach(a=>{this.setUpApi_(a)})}get children(){return this.controller_.rack.children.map(e=>hn(this.apiSet_,e))}addInput(e,t,n){const a=n||{},_=this.controller_.view.element.ownerDocument,k=this.pool_.createInput(_,yt(e,t,a.presetKey),a),te=new Ci(k);return this.add(te,a.index)}addMonitor(e,t,n){const a=n||{},_=this.controller_.view.element.ownerDocument,k=this.pool_.createMonitor(_,yt(e,t),a),te=new $n(k);return Ke(this.add(te,a.index))}addFolder(e){return ka(this,e)}addButton(e){return xi(this,e)}addSeparator(e){return Oo(this,e)}addTab(e){return Do(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find(a=>a.controller_===e.controller_);return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),a=this.pool_.createBladeApi(n);return this.add(a,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}setUpApi_(e){this.apiSet_.find(n=>n.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=hn(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof Kt){const n=hn(this.apiSet_,t),a=t.binding;this.emitter_.emit("change",{event:new He(n,Ke(a.target.read()),a.target.presetKey,e.options.last)})}else if(t instanceof Ar){const n=hn(this.apiSet_,t);this.emitter_.emit("change",{event:new He(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Qt))throw Ce.shouldNeverHappen();const t=hn(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new Pe(t,Ke(n.target.read()),n.target.presetKey)})}}class Ai extends gt{constructor(e,t){super(e,new Hn(e.rackController,t));this.emitter_=new ze,this.controller_.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",{event:new lt(this,n.sender.rawValue)})}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class Si extends dn{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps});this.rackController=e.rackController}}class No{constructor(e,t){const n=Ve(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function Mo(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Kt&&n.binding===e)return n}return null}function Fo(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Qt&&n.binding===e)return n}return null}function Bo(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Ar&&n.value===e)return n}return null}function Ti(r){return r instanceof Xe?r.rack:r instanceof Si?r.rackController.rack:null}function La(r){const e=Ti(r);return e?e.bcSet_:null}class Ra{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new ze,this.blade_=e!=null?e:null,(t=this.blade_)===null||t===void 0||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Ei(La),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return Ke(this.bcSet_.allItems().filter(t=>t instanceof e))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof Kt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Qt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof Ar)n.value.emitter.on("change",this.onChildValueChange_);else{const a=Ti(n);if(a){const _=a.emitter;_.on("layout",this.onDescendantLayout_),_.on("inputchange",this.onDescendantInputChange_),_.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof Kt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Qt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof Ar)n.value.emitter.off("change",this.onChildValueChange_);else{const a=Ti(n);if(a){const _=a.emitter;_.off("layout",this.onDescendantLayout_),_.off("inputchange",this.onDescendantInputChange_),_.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(a=>!a.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(a=>{const _=[];a===t&&(_.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&_.push("veryfirst")),a===n&&(_.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&_.push("verylast")),a.blade.set("positions",_)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(e){const t=Mo(this.find(Kt),e.sender);if(!t)throw Ce.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=Fo(this.find(Qt),e.sender);if(!t)throw Ce.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=Bo(this.find(Ar),e.sender);if(!t)throw Ce.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Xe extends dn{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new No(e,{viewName:"brk",viewProps:t.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new Ra(t.root?void 0:t.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose(()=>{for(let a=this.rack.children.length-1;a>=0;a--)this.rack.children[a].viewProps.set("disposed",!0)})}onRackAdd_(e){!e.isRoot||yi(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){!e.isRoot||fn(e.bladeController.view.element)}}const Oa=Ve("cnt");class Io{constructor(e,t){this.className_=Ve(t.viewName||"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Oa()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ft(this.foldable_,"completed",Fr(this.element,this.className_(void 0,"cpl")));const n=e.createElement("button");n.classList.add(this.className_("b")),ft(t.props,"title",te=>{De(te)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(this.className_("t")),mi(t.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a;const _=e.createElement("div");_.classList.add(this.className_("m")),this.buttonElement.appendChild(_);const k=t.containerElement;k.classList.add(this.className_("c")),this.element.appendChild(k),this.containerElement=k}}class Pi extends Si{constructor(e,t){var n;const a=Br.create((n=t.expanded)!==null&&n!==void 0?n:!0),_=new Xe(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:_,view:new Io(e,{containerElement:_.view.element,foldable:a,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=a,jn(this.foldable,this.view.containerElement),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Go={id:"folder",type:"blade",accept(r){const e=We,t=ct(r,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return t?{params:t}:null},controller(r){return new Pi(r.document,{blade:r.blade,expanded:r.params.expanded,props:Me.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof Pi?new Ai(r.controller,r.pool):null}};class Ir extends Ar{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new Ta(e,{props:t.props,viewProps:n}),viewProps:n}));this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Da extends Ge{}const Va=Ve("spr");class Uo{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Va()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(Va("r")),this.element.appendChild(n)}}class Na extends dn{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Uo(e,{viewProps:t.viewProps})}))}}const jo={id:"separator",type:"blade",accept(r){const t=ct(r,{view:We.required.constant("separator")});return t?{params:t}:null},controller(r){return new Na(r.document,{blade:r.blade,viewProps:r.viewProps})},api(r){return r.controller instanceof Na?new Da(r.controller):null}},$o=Ve("");function Ma(r,e){return Fr(r,$o(void 0,e))}class ar extends Me{constructor(e){super(e)}static create(e){var t,n;const a=e!=null?e:{},_={disabled:(t=a.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=a.hidden)!==null&&n!==void 0?n:!1},k=Me.createCore(_);return new ar(k)}bindClassModifiers(e){ft(this,"disabled",Ma(e,"disabled")),ft(this,"hidden",Ma(e,"hidden"))}bindDisabled(e){ft(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){ft(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}}const vn=Ve("tbi");class Ho{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vn()),t.viewProps.bindClassModifiers(this.element),ft(t.props,"selected",_=>{_?this.element.classList.add(vn(void 0,"sel")):this.element.classList.remove(vn(void 0,"sel"))});const n=e.createElement("button");n.classList.add(vn("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(vn("t")),mi(t.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a}}class zo{constructor(e,t){this.emitter=new ze,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ho(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Fa{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new zo(e,{props:t.itemProps,viewProps:ar.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Xe(e,{blade:Yt(),viewProps:ar.create()}),this.props=t.props,ft(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.contentController.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ba{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return(e=this.controller_.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class Ia extends gt{constructor(e,t){super(e,new Hn(e.rackController,t));this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new ze,this.pageApiMap_=new Map,this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(n=>{this.setUpPageApi_(n)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw Ce.shouldNeverHappen();return t})}addPage(e){const t=this.controller_.view.element.ownerDocument,n=new Fa(t,{itemProps:Me.fromObject({selected:!1,title:e.title}),props:Me.fromObject({selected:!1})});this.controller_.add(n,e.index);const a=this.pageApiMap_.get(n);if(!a)throw Ce.shouldNeverHappen();return a}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find(a=>a.controller_===e.contentController);if(!t)throw Ce.shouldNeverHappen();const n=new Ba(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw Ce.shouldNeverHappen();this.pageApiMap_.delete(e.item)}}const zn=Ve("tab");class Ko{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zn(),Oa()),t.viewProps.bindClassModifiers(this.element),_t(t.empty,Fr(this.element,zn(void 0,"nop")));const n=e.createElement("div");n.classList.add(zn("i")),this.element.appendChild(n),this.itemsElement=n;const a=t.contentsElement;a.classList.add(zn("c")),this.element.appendChild(a),this.contentsElement=a}}class Ga extends Si{constructor(e,t){const n=new Xe(e,{blade:t.blade,viewProps:t.viewProps}),a=wt(!0);super({blade:t.blade,rackController:n,view:new Ko(e,{contentsElement:n.view.element,empty:a,viewProps:t.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Ei(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=a,this.applyPages_()}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t!=null?t:this.pageSet_.items.length)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(e){const t=e.item;yi(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),t.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(e){const t=e.item;fn(t.itemController.view.element),this.rackController.rack.remove(t.contentController),t.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const e=this.pageSet_.items.findIndex(t=>t.props.get("selected"));e<0?this.pageSet_.items.forEach((t,n)=>{t.props.set("selected",n===0)}):this.pageSet_.items.forEach((t,n)=>{t.props.set("selected",n===e)})}onPageSelectedChange_(e){if(e.rawValue){const t=this.pageSet_.items.findIndex(n=>n.props.value("selected")===e.sender);this.pageSet_.items.forEach((n,a)=>{n.props.set("selected",a===t)})}else this.keepSelection_()}}const Ua={id:"tab",type:"blade",accept(r){const e=We,t=ct(r,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return!t||t.pages.length===0?null:{params:t}},controller(r){const e=new Ga(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(t=>{const n=new Fa(r.document,{itemProps:Me.fromObject({selected:!1,title:t.title}),props:Me.fromObject({selected:!1})});e.add(n)}),e},api(r){return r.controller instanceof Ga?new Ia(r.controller,r.pool):null}};function Xo(r,e){const t=r.accept(e.params);if(!t)return null;const n=We.optional.boolean(e.params.disabled).value,a=We.optional.boolean(e.params.hidden).value;return r.controller({blade:Yt(),document:e.document,params:Ke(Object.assign(Object.assign({},t.params),{disabled:n,hidden:a})),viewProps:ar.create({disabled:n,hidden:a})})}class qo{constructor(){this.disabled=!1,this.emitter=new ze}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Wo{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new ze,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Sr{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}}function Tt(r,e){if(r instanceof e)return r;if(r instanceof Sr){const t=r.constraints.reduce((n,a)=>n||(a instanceof e?a:null),null);if(t)return t}return null}class Gr{constructor(e){this.options=e}constrain(e){const t=this.options;return t.length===0||t.filter(a=>a.value===e).length>0?e:t[0].value}}class Pt{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return De(this.minValue)||(t=Math.max(t,this.minValue)),De(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class Tr{constructor(e){this.step=e}constrain(e){return(e<0?-Math.round(-e/this.step):Math.round(e/this.step))*this.step}}const Pr=Ve("lst");class ki{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Pr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(Pr("s")),ft(this.props_,"options",_=>{Sa(n),_.forEach((k,te)=>{const we=e.createElement("option");we.dataset.index=String(te),we.textContent=k.text,we.value=String(k.value),n.appendChild(we)})}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const a=e.createElement("div");a.classList.add(Pr("m")),a.appendChild(pt(e,"dropdown")),this.element.appendChild(a),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ur{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ki(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const n=Ke(e.currentTarget).selectedOptions.item(0);if(!n)return;const a=Number(n.dataset.index);this.value.rawValue=this.props.get("options")[a].value}}const Kn=Ve("pop");class Yo{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kn()),t.viewProps.bindClassModifiers(this.element),_t(t.shows,Fr(this.element,Kn(void 0,"v")))}}class ja{constructor(e,t){this.shows=wt(!1),this.viewProps=t.viewProps,this.view=new Yo(e,{shows:this.shows,viewProps:this.viewProps})}}const $a=Ve("txt");class Qo{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add($a()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add($a("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class xt{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Qo(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=Ke(e.currentTarget).value,a=this.parser_(n);De(a)||(this.value.rawValue=a),this.view.refresh()}}function kt(r){return String(r)}function mn(r){return r==="false"?!1:!!r}function Ha(r){return kt(r)}class Zo{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const za={"**":(r,e)=>Math.pow(r,e),"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"&":(r,e)=>r&e,"^":(r,e)=>r^e,"|":(r,e)=>r|e};class Ka{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=za[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Jo={"+":r=>r,"-":r=>-r,"~":r=>~r};class el{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Jo[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function bn(r){return(e,t)=>{for(let n=0;n<r.length;n++){const a=r[n](e,t);if(a!=="")return a}return""}}function _n(r,e){var t;const n=r.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function tl(r,e){const t=r.substr(e,1);return t.match(/^[1-9]$/)?t:""}function gn(r,e){var t;const n=r.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function rl(r,e){const t=gn(r,e);if(t!=="")return t;const n=r.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const a=gn(r,e);return a===""?"":n+a}function Li(r,e){const t=r.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=rl(r,e);return n===""?"":t+n}function Xa(r,e){const t=r.substr(e,1);if(t==="0")return t;const n=tl(r,e);return e+=n.length,n===""?"":n+gn(r,e)}function nl(r,e){const t=Xa(r,e);if(e+=t.length,t==="")return"";const n=r.substr(e,1);if(e+=n.length,n!==".")return"";const a=gn(r,e);return e+=a.length,t+n+a+Li(r,e)}function il(r,e){const t=r.substr(e,1);if(e+=t.length,t!==".")return"";const n=gn(r,e);return e+=n.length,n===""?"":t+n+Li(r,e)}function kr(r,e){const t=Xa(r,e);return e+=t.length,t===""?"":t+Li(r,e)}const al=bn([nl,il,kr]);function sl(r,e){var t;const n=r.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Xn(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=sl(r,e);return n===""?"":t+n}function Ri(r,e){var t;const n=r.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function qa(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=Ri(r,e);return n===""?"":t+n}function Wa(r,e){var t;const n=r.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function ol(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=Wa(r,e);return n===""?"":t+n}const Oi=bn([Xn,qa,ol]),Di=bn([Oi,al]);function sr(r,e){const t=Di(r,e);return e+=t.length,t===""?null:{evaluable:new Zo(t),cursor:e}}function qn(r,e){const t=r.substr(e,1);if(e+=t.length,t!=="(")return null;const n=Qa(r,e);if(!n)return null;e=n.cursor,e+=_n(r,e).length;const a=r.substr(e,1);return e+=a.length,a!==")"?null:{evaluable:n.evaluable,cursor:e}}function Ya(r,e){return sr(r,e)||qn(r,e)}function Vi(r,e){const t=Ya(r,e);if(t)return t;const n=r.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const a=Vi(r,e);return a?(e=a.cursor,{cursor:e,evaluable:new el(n,a.evaluable)}):null}function ll(r,e,t){t+=_n(e,t).length;const n=r.filter(a=>e.startsWith(a,t))[0];return n?(t+=n.length,t+=_n(e,t).length,{cursor:t,operator:n}):null}function ul(r,e){return(t,n)=>{const a=r(t,n);if(!a)return null;n=a.cursor;let _=a.evaluable;for(;;){const k=ll(e,t,n);if(!k)break;n=k.cursor;const te=r(t,n);if(!te)return null;n=te.cursor,_=new Ka(k.operator,_,te.evaluable)}return _?{cursor:n,evaluable:_}:null}}const cl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,e)=>ul(r,e),Vi);function Qa(r,e){return e+=_n(r,e).length,cl(r,e)}function dl(r){const e=Qa(r,0);return!e||e.cursor+_n(r,e.cursor).length!==r.length?null:e.evaluable}function Zt(r){var e;const t=dl(r);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function Za(r){if(typeof r=="number")return r;if(typeof r=="string"){const e=Zt(r);if(!De(e))return e}return 0}function or(r){return String(r)}function Et(r){return e=>e.toFixed(Math.max(Math.min(r,20),0))}const fl=Et(0);function lr(r){return fl(r)+"%"}function Ja(r){return String(r)}function ur(r){return r}function Ni(r,e){for(;r.length<e;)r.push(void 0)}function jr(r){const e=[];return Ni(e,r),wt(e)}function es(r){const e=r.indexOf(void 0);return Ke(e<0?r:r.slice(0,e))}function Lr(r,e){const t=[...es(r),e];return t.length>r.length?t.splice(0,t.length-r.length):Ni(t,r.length),t}function Rr({primary:r,secondary:e,forward:t,backward:n}){let a=!1;function _(k){a||(a=!0,k(),a=!1)}r.emitter.on("change",k=>{_(()=>{e.setRawValue(t(r,e),k.options)})}),e.emitter.on("change",k=>{_(()=>{r.setRawValue(n(r,e),k.options)}),_(()=>{e.setRawValue(t(r,e),k.options)})}),_(()=>{e.setRawValue(t(r,e),{forceEmit:!1,last:!0})})}function Ct(r,e){const t=r*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function wn(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function Jt(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function ts(r){return r==="ArrowUp"||r==="ArrowDown"}function rs(r){return ts(r)||r==="ArrowLeft"||r==="ArrowRight"}function Mi(r,e){const t=e.ownerDocument.defaultView,n=e.getBoundingClientRect();return{x:r.pageX-((t&&t.scrollX||0)+n.left),y:r.pageY-((t&&t.scrollY||0)+n.top)}}class cr{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new ze,e.addEventListener("touchstart",this.onTouchStart_),e.addEventListener("touchmove",this.onTouchMove_),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Mi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Mi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Mi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,a=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-a.left,y:n.clientY-a.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Ae(r,e,t,n,a){const _=(r-e)/(t-e);return n+_*(a-n)}function Fi(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ye(r,e,t){return Math.min(Math.max(r,e),t)}function Nt(r,e){return(r%e+e)%e}const At=Ve("txt");class Wn{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(At(),At(void 0,"num")),t.arrayPosition&&this.element.classList.add(At(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(At("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(At()),this.inputElement.classList.add(At("i"));const a=e.createElement("div");a.classList.add(At("k")),this.element.appendChild(a),this.knobElement=a;const _=e.createElementNS(zt,"svg");_.classList.add(At("g")),this.knobElement.appendChild(_);const k=e.createElementNS(zt,"path");k.classList.add(At("gb")),_.appendChild(k),this.guideBodyElem_=k;const te=e.createElementNS(zt,"path");te.classList.add(At("gh")),_.appendChild(te),this.guideHeadElem_=te;const we=e.createElement("div");we.classList.add(Ve("tt")()),this.knobElement.appendChild(we),this.tooltipElem_=we,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(At(void 0,"drg"));return}this.element.classList.add(At(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),a=Ye(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+a},0 L${n},4 L${n+a},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const _=this.props_.get("formatter");this.tooltipElem_.textContent=_(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class It{constructor(e,t){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=wt(null),this.view=new Wn(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new cr(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}onInputChange_(e){const n=Ke(e.currentTarget).value,a=this.parser_(n);De(a)||(this.value.rawValue=a),this.view.refresh()}onInputKeyDown_(e){const t=Ct(this.baseStep_,wn(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onInputKeyUp_(e){Ct(this.baseStep_,wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.originRawValue_+t*this.props.get("draggingScale")}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const yn=Ve("sld");class Yn{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(yn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(yn("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const a=e.createElement("div");a.classList.add(yn("k")),this.trackElement.appendChild(a),this.knobElement=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ye(Ae(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class xn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Yn(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new cr(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){!e.point||this.value.setRawValue(Ae(Ye(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ct(this.baseStep_,Jt(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Ct(this.baseStep_,Jt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $r=Ve("sldtxt");class ns{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($r());const n=e.createElement("div");n.classList.add($r("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const a=e.createElement("div");a.classList.add($r("t")),this.textView_=t.textView,a.appendChild(this.textView_.element),this.element.appendChild(a)}}class En{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new xn(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new It(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,value:t.value,viewProps:t.viewProps}),this.view=new ns(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Hr(r,e){r.write(e)}function Qn(r){const e=We;if(Array.isArray(r))return e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(r).value;if(typeof r=="object")return e.required.raw(r).value}function is(r){if(r==="inline"||r==="popup")return r}function dr(r){const e=We;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(r).value}function as(r){if(Array.isArray(r))return r;const e=[];return Object.keys(r).forEach(t=>{e.push({text:t,value:r[t]})}),e}function Cn(r){return De(r)?null:new Gr(as(Ke(r)))}function zr(r){const e=r?Tt(r,Gr):null;return e?e.options:null}function Bi(r){const e=r?Tt(r,Tr):null;return e?e.step:null}function Kr(r,e){const t=r&&Tt(r,Tr);return t?Fi(t.step):Math.max(Fi(e),2)}function Gt(r){const e=Bi(r);return e!=null?e:1}function fr(r,e){var t;const n=r&&Tt(r,Tr),a=Math.abs((t=n==null?void 0:n.step)!==null&&t!==void 0?t:e);return a===0?.1:Math.pow(10,Math.floor(Math.log10(a))-1)}const Xr=Ve("ckb");class Ii{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Xr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(Xr("l")),this.element.appendChild(n);const a=e.createElement("input");a.classList.add(Xr("i")),a.type="checkbox",n.appendChild(a),this.inputElement=a,t.viewProps.bindDisabled(this.inputElement);const _=e.createElement("div");_.classList.add(Xr("w")),n.appendChild(_);const k=pt(e,"check");_.appendChild(k),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Gi{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ii(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=Ke(e.currentTarget);this.value.rawValue=t.checked}}function ss(r){const e=[],t=Cn(r.options);return t&&e.push(t),new Sr(e)}const os={id:"input-bool",type:"input",accept:(r,e)=>{if(typeof r!="boolean")return null;const n=ct(e,{options:We.optional.custom(Qn)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>mn,constraint:r=>ss(r.params),writer:r=>Hr},controller:r=>{var e;const t=r.document,n=r.value,a=r.constraint;return a&&Tt(a,Gr)?new Ur(t,{props:Me.fromObject({options:(e=zr(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps}):new Gi(t,{value:n,viewProps:r.viewProps})}},pr=Ve("col");class ls{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pr()),t.foldable.bindExpandedClass(this.element,pr(void 0,"expanded")),ft(t.foldable,"completed",Fr(this.element,pr(void 0,"cpl")));const n=e.createElement("div");n.classList.add(pr("h")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(pr("s")),n.appendChild(a),this.swatchElement=a;const _=e.createElement("div");if(_.classList.add(pr("t")),n.appendChild(_),this.textElement=_,t.pickerLayout==="inline"){const k=e.createElement("div");k.classList.add(pr("p")),this.element.appendChild(k),this.pickerElement=k}else this.pickerElement=null}}function us(r,e,t){const n=Ye(r/255,0,1),a=Ye(e/255,0,1),_=Ye(t/255,0,1),k=Math.max(n,a,_),te=Math.min(n,a,_),we=k-te;let Ee=0,Be=0;const Ie=(te+k)/2;return we!==0&&(Be=we/(1-Math.abs(k+te-1)),n===k?Ee=(a-_)/we:a===k?Ee=2+(_-n)/we:Ee=4+(n-a)/we,Ee=Ee/6+(Ee<0?1:0)),[Ee*360,Be*100,Ie*100]}function cs(r,e,t){const n=(r%360+360)%360,a=Ye(e/100,0,1),_=Ye(t/100,0,1),k=(1-Math.abs(2*_-1))*a,te=k*(1-Math.abs(n/60%2-1)),we=_-k/2;let Ee,Be,Ie;return n>=0&&n<60?[Ee,Be,Ie]=[k,te,0]:n>=60&&n<120?[Ee,Be,Ie]=[te,k,0]:n>=120&&n<180?[Ee,Be,Ie]=[0,k,te]:n>=180&&n<240?[Ee,Be,Ie]=[0,te,k]:n>=240&&n<300?[Ee,Be,Ie]=[te,0,k]:[Ee,Be,Ie]=[k,0,te],[(Ee+we)*255,(Be+we)*255,(Ie+we)*255]}function ds(r,e,t){const n=Ye(r/255,0,1),a=Ye(e/255,0,1),_=Ye(t/255,0,1),k=Math.max(n,a,_),te=Math.min(n,a,_),we=k-te;let Ee;we===0?Ee=0:k===n?Ee=60*(((a-_)/we%6+6)%6):k===a?Ee=60*((_-n)/we+2):Ee=60*((n-a)/we+4);const Be=k===0?0:we/k,Ie=k;return[Ee,Be*100,Ie*100]}function Ui(r,e,t){const n=Nt(r,360),a=Ye(e/100,0,1),_=Ye(t/100,0,1),k=_*a,te=k*(1-Math.abs(n/60%2-1)),we=_-k;let Ee,Be,Ie;return n>=0&&n<60?[Ee,Be,Ie]=[k,te,0]:n>=60&&n<120?[Ee,Be,Ie]=[te,k,0]:n>=120&&n<180?[Ee,Be,Ie]=[0,k,te]:n>=180&&n<240?[Ee,Be,Ie]=[0,te,k]:n>=240&&n<300?[Ee,Be,Ie]=[te,0,k]:[Ee,Be,Ie]=[k,0,te],[(Ee+we)*255,(Be+we)*255,(Ie+we)*255]}function qr(r,e,t){const n=t+e*(100-Math.abs(2*t-100))/(2*100);return[r,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function ji(r,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[r,n!==0?e*t/n:0,t*(200-e)/(2*100)]}function hr(r){return[r[0],r[1],r[2]]}function Wr(r,e){return[r[0],r[1],r[2],e]}const pl={hsl:{hsl:(r,e,t)=>[r,e,t],hsv:qr,rgb:cs},hsv:{hsl:ji,hsv:(r,e,t)=>[r,e,t],rgb:Ui},rgb:{hsl:us,hsv:ds,rgb:(r,e,t)=>[r,e,t]}};function hl(r,e,t){return pl[e][t](...r)}const vl={hsl:r=>{var e;return[Nt(r[0],360),Ye(r[1],0,100),Ye(r[2],0,100),Ye((e=r[3])!==null&&e!==void 0?e:1,0,1)]},hsv:r=>{var e;return[Nt(r[0],360),Ye(r[1],0,100),Ye(r[2],0,100),Ye((e=r[3])!==null&&e!==void 0?e:1,0,1)]},rgb:r=>{var e;return[Ye(r[0],0,255),Ye(r[1],0,255),Ye(r[2],0,255),Ye((e=r[3])!==null&&e!==void 0?e:1,0,1)]}};function Yr(r,e){return typeof r!="object"||De(r)?!1:e in r&&typeof r[e]=="number"}class Fe{constructor(e,t){this.mode_=t,this.comps_=vl[t](e)}static black(){return new Fe([0,0,0],"rgb")}static fromObject(e){const t="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new Fe(t,"rgb")}static toRgbaObject(e){return e.toRgbaObject()}static isRgbColorObject(e){return Yr(e,"r")&&Yr(e,"g")&&Yr(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&Yr(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode_!==t.mode_)return!1;const n=e.comps_,a=t.comps_;for(let _=0;_<n.length;_++)if(n[_]!==a[_])return!1;return!0}get mode(){return this.mode_}getComponents(e){return Wr(hl(hr(this.comps_),this.mode_,e||this.mode_),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const vr=Ve("colp");class ml{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(vr());const n=e.createElement("div");n.classList.add(vr("hsv"));const a=e.createElement("div");a.classList.add(vr("sv")),this.svPaletteView_=t.svPaletteView,a.appendChild(this.svPaletteView_.element),n.appendChild(a);const _=e.createElement("div");_.classList.add(vr("h")),this.hPaletteView_=t.hPaletteView,_.appendChild(this.hPaletteView_.element),n.appendChild(_),this.element.appendChild(n);const k=e.createElement("div");if(k.classList.add(vr("rgb")),this.textView_=t.textView,k.appendChild(this.textView_.element),this.element.appendChild(k),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const te=e.createElement("div");te.classList.add(vr("a"));const we=e.createElement("div");we.classList.add(vr("ap")),we.appendChild(this.alphaViews_.palette.element),te.appendChild(we);const Ee=e.createElement("div");Ee.classList.add(vr("at")),Ee.appendChild(this.alphaViews_.text.element),te.appendChild(Ee),this.element.appendChild(te)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function An(r){const e=We;return ct(r,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(is)})}function Or(r){return r?.1:1}function St(r,e){const t=r.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(r),e)}const fs={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function $i(r){const e=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(r);const t=parseFloat(e[1]),n=e[2];return fs[n](t)}const Sn={"func.rgb":r=>{const e=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[St(e[1],255),St(e[2],255),St(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:new Fe(t,"rgb")},"func.rgba":r=>{const e=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[St(e[1],255),St(e[2],255),St(e[3],255),St(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:new Fe(t,"rgb")},"func.hsl":r=>{const e=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[$i(e[1]),St(e[2],100),St(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:new Fe(t,"hsl")},"func.hsla":r=>{const e=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[$i(e[1]),St(e[2],100),St(e[3],100),St(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:new Fe(t,"hsl")},"hex.rgb":r=>{const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new Fe([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");const t=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?new Fe([parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)],"rgb"):null},"hex.rgba":r=>{const e=r.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new Fe([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Ae(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");const t=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?new Fe([parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Ae(parseInt(t[4],16),0,255,0,1)],"rgb"):null}};function Zn(r){return Object.keys(Sn).reduce((t,n)=>t||(Sn[n](r)?n:null),null)}const Dr=r=>{const e=Zn(r);return e?Sn[e](r):null};function bl(r){return r==="func.hsla"||r==="func.rgba"||r==="hex.rgba"}function _l(r){if(typeof r=="string"){const e=Dr(r);if(e)return e}return Fe.black()}function ps(r){const e=Ye(Math.floor(r),0,255).toString(16);return e.length===1?`0${e}`:e}function Hi(r,e="#"){const t=hr(r.getComponents("rgb")).map(ps).join("");return`${e}${t}`}function Jn(r,e="#"){const t=r.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(ps).join("");return`${e}${n}`}function hs(r){const e=Et(0);return`rgb(${hr(r.getComponents("rgb")).map(n=>e(n)).join(", ")})`}function ei(r){const e=Et(2),t=Et(0);return`rgba(${r.getComponents("rgb").map((a,_)=>(_===3?e:t)(a)).join(", ")})`}function vs(r){const e=[Et(0),lr,lr];return`hsl(${hr(r.getComponents("hsl")).map((n,a)=>e[a](n)).join(", ")})`}function Tn(r){const e=[Et(0),lr,lr,Et(2)];return`hsla(${r.getComponents("hsl").map((n,a)=>e[a](n)).join(", ")})`}const gl={"func.hsl":vs,"func.hsla":Tn,"func.rgb":hs,"func.rgba":ei,"hex.rgb":Hi,"hex.rgba":Jn};function Pn(r){return gl[r]}const ht=Ve("apl");class Qr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ht()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(ht("b")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(ht("c")),n.appendChild(a),this.colorElem_=a;const _=e.createElement("div");_.classList.add(ht("m")),this.element.appendChild(_),this.markerElem_=_;const k=e.createElement("div");k.classList.add(ht("p")),this.markerElem_.appendChild(k),this.previewElem_=k,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Fe([t[0],t[1],t[2],0],"rgb"),a=new Fe([t[0],t[1],t[2],255],"rgb"),_=["to right",ei(n),ei(a)];this.colorElem_.style.background=`linear-gradient(${_.join(",")})`,this.previewElem_.style.backgroundColor=ei(e);const k=Ae(t[3],0,1,0,100);this.markerElem_.style.left=`${k}%`}onValueChange_(){this.update_()}}class ms{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Qr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new cr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,a=this.value.rawValue,[_,k,te]=a.getComponents("hsv");this.value.setRawValue(new Fe([_,k,te,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ct(Or(!0),Jt(e));if(t===0)return;const n=this.value.rawValue,[a,_,k,te]=n.getComponents("hsv");this.value.setRawValue(new Fe([a,_,k,te+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Ct(Or(!0),Jt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Vr=Ve("coltxt");function bs(r){const e=r.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(t.reduce((n,a)=>{const _=r.createElement("option");return _.textContent=a.text,_.value=a.value,n.appendChild(_),n},r.createDocumentFragment())),e}class _s{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Vr());const n=e.createElement("div");n.classList.add(Vr("m")),this.modeElem_=bs(e),this.modeElem_.classList.add(Vr("ms")),n.appendChild(this.modeSelectElement);const a=e.createElement("div");a.classList.add(Vr("mm")),a.appendChild(pt(e,"dropdown")),n.appendChild(a),this.element.appendChild(n);const _=e.createElement("div");_.classList.add(Vr("w")),this.element.appendChild(_),this.textsElem_=_,this.textViews_=t.textViews,this.applyTextViews_(),_t(t.colorMode,k=>{this.modeElem_.value=k})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){Sa(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(Vr("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)})}}const gs=Et(0),ws={rgb:()=>new Pt({min:0,max:255}),hsl:r=>r===0?new Pt({min:0,max:360}):new Pt({min:0,max:100}),hsv:r=>r===0?new Pt({min:0,max:360}):new Pt({min:0,max:100})};function zi(r,e,t){return new It(r,{arrayPosition:t===0?"fst":t===3-1?"lst":"mid",baseStep:Or(!1),parser:e.parser,props:Me.fromObject({draggingScale:1,formatter:gs}),value:wt(0,{constraint:ws[e.colorMode](t)}),viewProps:e.viewProps})}class Zr{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=wt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new _s(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},n=[zi(e,t,0),zi(e,t,1),zi(e,t,2)];return n.forEach((a,_)=>{Rr({primary:this.value,secondary:a.value,forward:k=>k.rawValue.getComponents(this.colorMode.rawValue)[_],backward:(k,te)=>{const we=this.colorMode.rawValue,Ee=k.rawValue.getComponents(we);return Ee[_]=te.rawValue,new Fe(Wr(hr(Ee),Ee[3]),we)}})}),n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const tt=Ve("hpl");class ys{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(tt()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(tt("c")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(tt("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=hs(new Fe([t,100,100],"hsv"));const n=Ae(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class xs{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new ys(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new cr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ae(e.point.x,0,e.bounds.width,0,360),a=this.value.rawValue,[,_,k,te]=a.getComponents("hsv");this.value.setRawValue(new Fe([n,_,k,te],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ct(Or(!1),Jt(e));if(t===0)return;const n=this.value.rawValue,[a,_,k,te]=n.getComponents("hsv");this.value.setRawValue(new Fe([a+t,_,k,te],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Ct(Or(!1),Jt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const er=Ve("svp"),Ki=64;class Es{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=Ki,n.width=Ki,n.classList.add(er("c")),this.element.appendChild(n),this.canvasElement=n;const a=e.createElement("div");a.classList.add(er("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}update_(){const e=Aa(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),a=this.canvasElement.width,_=this.canvasElement.height,k=e.getImageData(0,0,a,_),te=k.data;for(let Be=0;Be<_;Be++)for(let Ie=0;Ie<a;Ie++){const Rt=Ae(Ie,0,a,0,100),jt=Ae(Be,0,_,100,0),$t=Ui(n[0],Rt,jt),ir=(Be*a+Ie)*4;te[ir]=$t[0],te[ir+1]=$t[1],te[ir+2]=$t[2],te[ir+3]=255}e.putImageData(k,0,0);const we=Ae(n[1],0,100,0,100);this.markerElem_.style.left=`${we}%`;const Ee=Ae(n[2],0,100,100,0);this.markerElem_.style.top=`${Ee}%`}onValueChange_(){this.update_()}}class wl{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Es(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new cr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ae(e.point.x,0,e.bounds.width,0,100),a=Ae(e.point.y,0,e.bounds.height,100,0),[_,,,k]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Fe([_,n,a,k],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){rs(e.key)&&e.preventDefault();const[t,n,a,_]=this.value.rawValue.getComponents("hsv"),k=Or(!1),te=Ct(k,Jt(e)),we=Ct(k,wn(e));te===0&&we===0||this.value.setRawValue(new Fe([t,n+te,a+we,_],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Or(!1),n=Ct(t,Jt(e)),a=Ct(t,wn(e));n===0&&a===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class yl{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new xs(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new wl(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new ms(e,{value:this.value,viewProps:this.viewProps}),text:new It(e,{parser:Zt,baseStep:.1,props:Me.fromObject({draggingScale:.01,formatter:Et(2)}),value:wt(0,{constraint:new Pt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Rr({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.rawValue.getComponents()[3],backward:(n,a)=>{const _=n.rawValue.getComponents();return _[3]=a.rawValue,new Fe(_,n.rawValue.mode)}}),this.textC_=new Zr(e,{parser:Zt,value:this.value,viewProps:this.viewProps}),this.view=new ml(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Xi=Ve("colsw");class xl{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Xi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Xi("sw")),this.element.appendChild(n),this.swatchElem_=n;const a=e.createElement("button");a.classList.add(Xi("b")),t.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Jn(e)}onValueChange_(){this.update_()}}class qi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new xl(e,{value:this.value,viewProps:this.viewProps})}}class ti{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Br.create(t.expanded),this.swatchC_=new qi(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new xt(e,{parser:t.parser,props:Me.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ls(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new ja(e,{viewProps:this.viewProps}):null;const a=new yl(e,{supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});a.view.allFocusableElements.forEach(_=>{_.addEventListener("blur",this.onPopupChildBlur_),_.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=a,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(a.view.element),Rr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:_=>_.rawValue,backward:(_,k)=>k.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),jn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=Ke(e.relatedTarget);(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=l(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!Gn(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function El(r){return Fe.isColorObject(r)?Fe.fromObject(r):Fe.black()}function Cs(r){return hr(r.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function As(r){return r.getComponents("rgb").reduce((e,t,n)=>{const a=Math.floor(n===3?t*255:t)&255;return e<<8|a},0)>>>0}function Cl(r){return new Fe([r>>16&255,r>>8&255,r&255],"rgb")}function ri(r){return new Fe([r>>24&255,r>>16&255,r>>8&255,Ae(r&255,0,255,0,1)],"rgb")}function Al(r){return typeof r!="number"?Fe.black():Cl(r)}function mr(r){return typeof r!="number"?Fe.black():ri(r)}function ni(r){const e=Pn(r);return(t,n)=>{Hr(t,e(n))}}function Ss(r){const e=r?As:Cs;return(t,n)=>{Hr(t,e(n))}}function Ts(r,e){const t=e.toRgbaObject();r.writeProperty("r",t.r),r.writeProperty("g",t.g),r.writeProperty("b",t.b),r.writeProperty("a",t.a)}function Ps(r,e){const t=e.toRgbaObject();r.writeProperty("r",t.r),r.writeProperty("g",t.g),r.writeProperty("b",t.b)}function ks(r){return r?Ts:Ps}function ii(r){return"alpha"in r&&r.alpha===!0}function Ls(r){return r?e=>Jn(e,"0x"):e=>Hi(e,"0x")}const Rs={id:"input-color-number",type:"input",accept:(r,e)=>{if(typeof r!="number"||!("view"in e)||e.view!=="color")return null;const t=An(e);return t?{initialValue:r,params:t}:null},binding:{reader:r=>ii(r.params)?mr:Al,equals:Fe.equals,writer:r=>Ss(ii(r.params))},controller:r=>{const e=ii(r.params),t="expanded"in r.params?r.params.expanded:void 0,n="picker"in r.params?r.params.picker:void 0;return new ti(r.document,{expanded:t!=null?t:!1,formatter:Ls(e),parser:Dr,pickerLayout:n!=null?n:"popup",supportsAlpha:e,value:r.value,viewProps:r.viewProps})}};function Os(r){return Fe.isRgbaColorObject(r)}const Ds={id:"input-color-object",type:"input",accept:(r,e)=>{if(!Fe.isColorObject(r))return null;const t=An(e);return t?{initialValue:r,params:t}:null},binding:{reader:r=>El,equals:Fe.equals,writer:r=>ks(Os(r.initialValue))},controller:r=>{const e=Fe.isRgbaColorObject(r.initialValue),t="expanded"in r.params?r.params.expanded:void 0,n="picker"in r.params?r.params.picker:void 0,a=e?Jn:Hi;return new ti(r.document,{expanded:t!=null?t:!1,formatter:a,parser:Dr,pickerLayout:n!=null?n:"popup",supportsAlpha:e,value:r.value,viewProps:r.viewProps})}},Ut={id:"input-color-string",type:"input",accept:(r,e)=>{if(typeof r!="string"||"view"in e&&e.view==="text"||!Zn(r))return null;const n=An(e);return n?{initialValue:r,params:n}:null},binding:{reader:r=>_l,equals:Fe.equals,writer:r=>{const e=Zn(r.initialValue);if(!e)throw Ce.shouldNeverHappen();return ni(e)}},controller:r=>{const e=Zn(r.initialValue);if(!e)throw Ce.shouldNeverHappen();const t=Pn(e),n="expanded"in r.params?r.params.expanded:void 0,a="picker"in r.params?r.params.picker:void 0;return new ti(r.document,{expanded:n!=null?n:!1,formatter:t,parser:Dr,pickerLayout:a!=null?a:"popup",supportsAlpha:bl(e),value:r.value,viewProps:r.viewProps})}};class tr{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,a)=>{var _,k;return(k=(_=this.components[a])===null||_===void 0?void 0:_.constrain(n))!==null&&k!==void 0?k:n});return this.asm_.fromComponents(t)}}const Vs=Ve("pndtxt");class rr{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Vs()),this.textViews.forEach(n=>{const a=e.createElement("div");a.classList.add(Vs("a")),a.appendChild(n.element),this.element.appendChild(a)})}}function Wi(r,e,t){return new It(r,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",baseStep:e.axes[t].baseStep,parser:e.parser,props:e.axes[t].textProps,value:wt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class nr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,a)=>Wi(e,t,a)),this.acs_.forEach((n,a)=>{Rr({primary:this.value,secondary:n.value,forward:_=>t.assembly.toComponents(_.rawValue)[a],backward:(_,k)=>{const te=t.assembly.toComponents(_.rawValue);return te[a]=k.rawValue,t.assembly.fromComponents(te)}})}),this.view=new rr(e,{textViews:this.acs_.map(n=>n.view)})}}function ai(r){return"step"in r&&!De(r.step)?new Tr(r.step):null}function Ns(r){return"max"in r&&!De(r.max)||"min"in r&&!De(r.min)?new Pt({max:r.max,min:r.min}):null}function Ms(r){const e=[],t=ai(r);t&&e.push(t);const n=Ns(r);n&&e.push(n);const a=Cn(r.options);return a&&e.push(a),new Sr(e)}function Fs(r){const e=r?Tt(r,Pt):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}function Bs(r){const[e,t]=Fs(r);return[e!=null?e:0,t!=null?t:100]}const Is={id:"input-number",type:"input",accept:(r,e)=>{if(typeof r!="number")return null;const t=We,n=ct(e,{format:t.optional.function,max:t.optional.number,min:t.optional.number,options:t.optional.custom(Qn),step:t.optional.number});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Za,constraint:r=>Ms(r.params),writer:r=>Hr},controller:r=>{var e,t;const n=r.value,a=r.constraint;if(a&&Tt(a,Gr))return new Ur(r.document,{props:Me.fromObject({options:(e=zr(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps});const _=(t="format"in r.params?r.params.format:void 0)!==null&&t!==void 0?t:Et(Kr(a,n.rawValue));if(a&&Tt(a,Pt)){const[k,te]=Bs(a);return new En(r.document,{baseStep:Gt(a),parser:Zt,sliderProps:Me.fromObject({maxValue:te,minValue:k}),textProps:Me.fromObject({draggingScale:fr(a,n.rawValue),formatter:_}),value:n,viewProps:r.viewProps})}return new It(r.document,{baseStep:Gt(a),parser:Zt,props:Me.fromObject({draggingScale:fr(a,n.rawValue),formatter:_}),value:n,viewProps:r.viewProps})}};class br{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(De(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const Gs={toComponents:r=>r.getComponents(),fromComponents:r=>new br(...r)},Jr=Ve("p2d");class Sl{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jr()),t.viewProps.bindClassModifiers(this.element),_t(t.expanded,Fr(this.element,Jr(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Jr("h")),this.element.appendChild(n);const a=e.createElement("button");a.classList.add(Jr("b")),a.appendChild(pt(e,"p2dpad")),t.viewProps.bindDisabled(a),n.appendChild(a),this.buttonElement=a;const _=e.createElement("div");if(_.classList.add(Jr("t")),n.appendChild(_),this.textElement=_,t.pickerLayout==="inline"){const k=e.createElement("div");k.classList.add(Jr("p")),this.element.appendChild(k),this.pickerElement=k}else this.pickerElement=null}}const _r=Ve("p2dp");class Tl{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(_r()),t.layout==="popup"&&this.element.classList.add(_r(void 0,"p"));const n=e.createElement("div");n.classList.add(_r("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const a=e.createElementNS(zt,"svg");a.classList.add(_r("g")),this.padElement.appendChild(a),this.svgElem_=a;const _=e.createElementNS(zt,"line");_.classList.add(_r("ax")),_.setAttributeNS(null,"x1","0"),_.setAttributeNS(null,"y1","50%"),_.setAttributeNS(null,"x2","100%"),_.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(_);const k=e.createElementNS(zt,"line");k.classList.add(_r("ax")),k.setAttributeNS(null,"x1","50%"),k.setAttributeNS(null,"y1","0"),k.setAttributeNS(null,"x2","50%"),k.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(k);const te=e.createElementNS(zt,"line");te.classList.add(_r("l")),te.setAttributeNS(null,"x1","50%"),te.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(te),this.lineElem_=te;const we=e.createElement("div");we.classList.add(_r("m")),this.padElement.appendChild(we),this.markerElem_=we,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,a=Ae(e,-n,+n,0,100),_=Ae(t,-n,+n,0,100),k=this.invertsY_?100-_:_;this.lineElem_.setAttributeNS(null,"x2",`${a}%`),this.lineElem_.setAttributeNS(null,"y2",`${k}%`),this.markerElem_.style.left=`${a}%`,this.markerElem_.style.top=`${k}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Us(r,e,t){return[Ct(e[0],Jt(r)),Ct(e[1],wn(r))*(t?1:-1)]}class js{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new Tl(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new cr(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,a=Ae(e.point.x,0,e.bounds.width,-n,+n),_=Ae(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new br(a,_),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){rs(e.key)&&e.preventDefault();const[t,n]=Us(e,this.baseSteps_,this.invertsY_);t===0&&n===0||this.value.setRawValue(new br(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=Us(e,this.baseSteps_,this.invertsY_);t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class $s{constructor(e,t){var n,a;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Br.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new ja(e,{viewProps:this.viewProps}):null;const _=new js(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});_.view.allFocusableElements.forEach(k=>{k.addEventListener("blur",this.onPopupChildBlur_),k.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=_,this.textC_=new nr(e,{assembly:Gs,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Sl(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(a=this.view.buttonElement)===null||a===void 0||a.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Rr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:k=>k.rawValue,backward:(k,te)=>te.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),jn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=Ke(e.relatedTarget);(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=l(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!Gn(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function Pl(r){return br.isObject(r)?new br(r.x,r.y):new br}function kl(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y)}function si(r){if(!r)return;const e=[];return De(r.step)||e.push(new Tr(r.step)),(!De(r.max)||!De(r.min))&&e.push(new Pt({max:r.max,min:r.min})),new Sr(e)}function oi(r){return new tr({assembly:Gs,components:[si("x"in r?r.x:void 0),si("y"in r?r.y:void 0)]})}function Hs(r,e){const t=r&&Tt(r,Pt);if(t)return Math.max(Math.abs(t.minValue||0),Math.abs(t.maxValue||0));const n=Gt(r);return Math.max(Math.abs(n)*10,Math.abs(e)*10)}function Ll(r,e){const t=e instanceof tr?e.components[0]:void 0,n=e instanceof tr?e.components[1]:void 0,a=Hs(t,r.x),_=Hs(n,r.y);return Math.max(a,_)}function zs(r,e){return{baseStep:Gt(e),constraint:e,textProps:Me.fromObject({draggingScale:fr(e,r),formatter:Et(Kr(e,r))})}}function Rl(r){if(!("y"in r))return!1;const e=r.y;return e&&"inverted"in e?!!e.inverted:!1}const Ol={id:"input-point2d",type:"input",accept:(r,e)=>{if(!br.isObject(r))return null;const t=We,n=ct(e,{expanded:t.optional.boolean,picker:t.optional.custom(is),x:t.optional.custom(dr),y:t.optional.object({inverted:t.optional.boolean,max:t.optional.number,min:t.optional.number,step:t.optional.number})});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Pl,constraint:r=>oi(r.params),equals:br.equals,writer:r=>kl},controller:r=>{const e=r.document,t=r.value,n=r.constraint;if(!(n instanceof tr))throw Ce.shouldNeverHappen();const a="expanded"in r.params?r.params.expanded:void 0,_="picker"in r.params?r.params.picker:void 0;return new $s(e,{axes:[zs(t.rawValue.x,n.components[0]),zs(t.rawValue.y,n.components[1])],expanded:a!=null?a:!1,invertsY:Rl(r.params),maxValue:Ll(t.rawValue,n),parser:Zt,pickerLayout:_!=null?_:"popup",value:t,viewProps:r.viewProps})}};class Nr{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(De(e))return!1;const t=e.x,n=e.y,a=e.z;return!(typeof t!="number"||typeof n!="number"||typeof a!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ks={toComponents:r=>r.getComponents(),fromComponents:r=>new Nr(...r)};function Dl(r){return Nr.isObject(r)?new Nr(r.x,r.y,r.z):new Nr}function Vl(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z)}function Yi(r){if(!r)return;const e=[];return De(r.step)||e.push(new Tr(r.step)),(!De(r.max)||!De(r.min))&&e.push(new Pt({max:r.max,min:r.min})),new Sr(e)}function Nl(r){return new tr({assembly:Ks,components:[Yi("x"in r?r.x:void 0),Yi("y"in r?r.y:void 0),Yi("z"in r?r.z:void 0)]})}function gr(r,e){return{baseStep:Gt(e),constraint:e,textProps:Me.fromObject({draggingScale:fr(e,r),formatter:Et(Kr(e,r))})}}const Ml={id:"input-point3d",type:"input",accept:(r,e)=>{if(!Nr.isObject(r))return null;const t=We,n=ct(e,{x:t.optional.custom(dr),y:t.optional.custom(dr),z:t.optional.custom(dr)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Dl,constraint:r=>Nl(r.params),equals:Nr.equals,writer:r=>Vl},controller:r=>{const e=r.value,t=r.constraint;if(!(t instanceof tr))throw Ce.shouldNeverHappen();return new nr(r.document,{assembly:Ks,axes:[gr(e.rawValue.x,t.components[0]),gr(e.rawValue.y,t.components[1]),gr(e.rawValue.z,t.components[2])],parser:Zt,value:e,viewProps:r.viewProps})}};class en{constructor(e=0,t=0,n=0,a=0){this.x=e,this.y=t,this.z=n,this.w=a}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(De(e))return!1;const t=e.x,n=e.y,a=e.z,_=e.w;return!(typeof t!="number"||typeof n!="number"||typeof a!="number"||typeof _!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Qi={toComponents:r=>r.getComponents(),fromComponents:r=>new en(...r)};function li(r){return en.isObject(r)?new en(r.x,r.y,r.z,r.w):new en}function Xs(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z),r.writeProperty("w",e.w)}function tn(r){if(!r)return;const e=[];return De(r.step)||e.push(new Tr(r.step)),(!De(r.max)||!De(r.min))&&e.push(new Pt({max:r.max,min:r.min})),new Sr(e)}function Fl(r){return new tr({assembly:Qi,components:[tn("x"in r?r.x:void 0),tn("y"in r?r.y:void 0),tn("z"in r?r.z:void 0),tn("w"in r?r.w:void 0)]})}function qs(r,e){return{baseStep:Gt(e),constraint:e,textProps:Me.fromObject({draggingScale:fr(e,r),formatter:Et(Kr(e,r))})}}const Bl={id:"input-point4d",type:"input",accept:(r,e)=>{if(!en.isObject(r))return null;const t=We,n=ct(e,{x:t.optional.custom(dr),y:t.optional.custom(dr),z:t.optional.custom(dr),w:t.optional.custom(dr)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>li,constraint:r=>Fl(r.params),equals:en.equals,writer:r=>Xs},controller:r=>{const e=r.value,t=r.constraint;if(!(t instanceof tr))throw Ce.shouldNeverHappen();return new nr(r.document,{assembly:Qi,axes:e.rawValue.getComponents().map((n,a)=>qs(n,t.components[a])),parser:Zt,value:e,viewProps:r.viewProps})}};function Il(r){const e=[],t=Cn(r.options);return t&&e.push(t),new Sr(e)}const Gl={id:"input-string",type:"input",accept:(r,e)=>{if(typeof r!="string")return null;const n=ct(e,{options:We.optional.custom(Qn)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Ja,constraint:r=>Il(r.params),writer:r=>Hr},controller:r=>{var e;const t=r.document,n=r.value,a=r.constraint;return a&&Tt(a,Gr)?new Ur(t,{props:Me.fromObject({options:(e=zr(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps}):new xt(t,{parser:_=>_,props:Me.fromObject({formatter:ur}),value:n,viewProps:r.viewProps})}},kn={monitor:{defaultInterval:200,defaultLineCount:3}},Ws=Ve("mll");class Ln{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ws()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(Ws("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(a=>{a!==void 0&&n.push(this.formatter_(a))}),e.textContent=n.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class Zi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ln(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const Rn=Ve("sgl");class Ul{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Rn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Rn("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class wr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ul(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const rn={id:"monitor-bool",type:"monitor",accept:(r,e)=>{if(typeof r!="boolean")return null;const n=ct(e,{lineCount:We.optional.number});return n?{initialValue:r,params:n}:null},binding:{reader:r=>mn},controller:r=>{var e;return r.value.rawValue.length===1?new wr(r.document,{formatter:Ha,value:r.value,viewProps:r.viewProps}):new Zi(r.document,{formatter:Ha,lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:kn.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}};class jl{constructor(){this.emitter=new ze,this.index_=-1}get index(){return this.index_}set index(e){this.index_!==e&&(this.index_=e,this.emitter.emit("change",{index:e,sender:this}))}}const Lt=Ve("grl");class Ys{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Lt()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.minValue_=t.minValue,this.maxValue_=t.maxValue,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(zt,"svg");n.classList.add(Lt("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const a=e.createElementNS(zt,"polyline");this.svgElem_.appendChild(a),this.lineElem_=a;const _=e.createElement("div");_.classList.add(Lt("t"),Ve("tt")()),this.element.appendChild(_),this.tooltipElem_=_,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.minValue_,a=this.maxValue_,_=[];this.value.rawValue.forEach((Be,Ie)=>{if(Be===void 0)return;const Rt=Ae(Ie,0,t,0,e.width),jt=Ae(Be,n,a,e.height,0);_.push([Rt,jt].join(","))}),this.lineElem_.setAttributeNS(null,"points",_.join(" "));const k=this.tooltipElem_,te=this.value.rawValue[this.cursor_.index];if(te===void 0){k.classList.remove(Lt("t","a"));return}const we=Ae(this.cursor_.index,0,t,0,e.width),Ee=Ae(te,n,a,e.height,0);k.style.left=`${we}px`,k.style.top=`${Ee}px`,k.textContent=`${this.formatter_(te)}`,k.classList.contains(Lt("t","a"))||(k.classList.add(Lt("t","a"),Lt("t","in")),In(k),k.classList.remove(Lt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class nn{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.cursor_=new jl,this.view=new Ys(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,maxValue:t.maxValue,minValue:t.minValue,value:this.value,viewProps:this.viewProps}),!Gn(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new cr(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Ae(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(Ae(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function On(r){return"format"in r&&!De(r.format)?r.format:Et(2)}function Ji(r){var e;return r.value.rawValue.length===1?new wr(r.document,{formatter:On(r.params),value:r.value,viewProps:r.viewProps}):new Zi(r.document,{formatter:On(r.params),lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:kn.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}function ea(r){var e,t,n;return new nn(r.document,{formatter:On(r.params),lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:kn.monitor.defaultLineCount,maxValue:(t="max"in r.params?r.params.max:null)!==null&&t!==void 0?t:100,minValue:(n="min"in r.params?r.params.min:null)!==null&&n!==void 0?n:0,value:r.value,viewProps:r.viewProps})}function ui(r){return"view"in r&&r.view==="graph"}const ta={id:"monitor-number",type:"monitor",accept:(r,e)=>{if(typeof r!="number")return null;const t=We,n=ct(e,{format:t.optional.function,lineCount:t.optional.number,max:t.optional.number,min:t.optional.number,view:t.optional.string});return n?{initialValue:r,params:n}:null},binding:{defaultBufferSize:r=>ui(r)?64:1,reader:r=>Za},controller:r=>ui(r.params)?ea(r):Ji(r)},ci={id:"monitor-string",type:"monitor",accept:(r,e)=>{if(typeof r!="string")return null;const t=We,n=ct(e,{lineCount:t.optional.number,multiline:t.optional.boolean});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Ja},controller:r=>{var e;const t=r.value;return t.rawValue.length>1||"multiline"in r.params&&r.params.multiline?new Zi(r.document,{formatter:ur,lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:kn.monitor.defaultLineCount,value:t,viewProps:r.viewProps}):new wr(r.document,{formatter:ur,value:t,viewProps:r.viewProps})}};class Qs{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new ze,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();e!==void 0&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function Zs(r,e){const t=r.accept(e.target.read(),e.params);if(De(t))return null;const n=We,a={target:e.target,initialValue:t.initialValue,params:t.params},_=r.binding.reader(a),k=r.binding.constraint?r.binding.constraint(a):void 0,te=wt(_(t.initialValue),{constraint:k,equals:r.binding.equals}),we=new Qs({reader:_,target:e.target,value:te,writer:r.binding.writer(a)}),Ee=n.optional.boolean(e.params.disabled).value,Be=n.optional.boolean(e.params.hidden).value,Ie=r.controller({constraint:k,document:e.document,initialValue:t.initialValue,params:t.params,value:we.value,viewProps:ar.create({disabled:Ee,hidden:Be})}),Rt=n.optional.string(e.params.label).value;return new Kt(e.document,{binding:we,blade:Yt(),props:Me.fromObject({label:Rt||e.target.key}),valueController:Ie})}class Js{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new ze,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(e===void 0)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=Lr(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}function eo(r,e){return e===0?new qo:new Wo(r,e!=null?e:kn.monitor.defaultInterval)}function to(r,e){var t,n,a;const _=We,k=r.accept(e.target.read(),e.params);if(De(k))return null;const te={target:e.target,initialValue:k.initialValue,params:k.params},we=r.binding.reader(te),Ee=(n=(t=_.optional.number(e.params.bufferSize).value)!==null&&t!==void 0?t:r.binding.defaultBufferSize&&r.binding.defaultBufferSize(k.params))!==null&&n!==void 0?n:1,Be=_.optional.number(e.params.interval).value,Ie=new Js({reader:we,target:e.target,ticker:eo(e.document,Be),value:jr(Ee)}),Rt=_.optional.boolean(e.params.disabled).value,jt=_.optional.boolean(e.params.hidden).value,$t=r.controller({document:e.document,params:k.params,value:Ie.value,viewProps:ar.create({disabled:Rt,hidden:jt})}),ir=(a=_.optional.string(e.params.label).value)!==null&&a!==void 0?a:e.target.key;return new Qt(e.document,{binding:Ie,blade:Yt(),props:Me.fromObject({label:ir}),valueController:$t})}class ra{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){const a=t.read();if(De(a))throw new Ce({context:{key:t.key},type:"nomatchingcontroller"});const _=this.pluginsMap_.inputs.reduce((k,te)=>k||Zs(te,{document:e,target:t,params:n}),null);if(_)return _;throw new Ce({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const a=this.pluginsMap_.monitors.reduce((_,k)=>_||to(k,{document:e,params:n,target:t}),null);if(a)return a;throw new Ce({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((a,_)=>a||Xo(_,{document:e,params:t}),null);if(!n)throw new Ce({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof Kt)return new Ci(e);if(e instanceof Qt)return new $n(e);if(e instanceof Xe)return new Hn(e,this);const t=this.pluginsMap_.blades.reduce((n,a)=>n||a.api({controller:e,pool:this}),null);if(!t)throw Ce.shouldNeverHappen();return t}}function na(){const r=new ra;return[Ol,Ml,Bl,Gl,Is,Ut,Ds,Rs,os,rn,ci,ta,Cr,Go,jo,Ua].forEach(e=>{r.register(e)}),r}class ia extends Ge{constructor(e){super(e);this.emitter_=new ze,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new He(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class aa extends Ge{constructor(e){super(e);this.emitter_=new ze,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new He(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class sa extends Ge{constructor(e){super(e);this.emitter_=new ze,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new He(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}const ro=function(){return{id:"list",type:"blade",accept(r){const e=We,t=ct(r,{options:e.required.custom(Qn),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return t?{params:t}:null},controller(r){const e=new Ur(r.document,{props:Me.fromObject({options:as(r.params.options)}),value:wt(r.params.value),viewProps:r.viewProps});return new Ir(r.document,{blade:r.blade,props:Me.fromObject({label:r.params.label}),valueController:e})},api(r){return!(r.controller instanceof Ir)||!(r.controller.valueController instanceof Ur)?null:new ia(r.controller)}}}();function oa(r){return r.reduce((e,t)=>Object.assign(e,{[t.presetKey]:t.read()}),{})}function no(r,e){r.forEach(t=>{const n=e[t.presetKey];n!==void 0&&t.write(n)})}class io extends Ai{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){const t=this.controller_.rackController.rack.find(Kt).map(n=>n.binding.target);no(t,e),this.refresh()}exportPreset(){const e=this.controller_.rackController.rack.find(Kt).map(t=>t.binding.target);return oa(e)}refresh(){this.controller_.rackController.rack.find(Kt).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(Qt).forEach(e=>{e.binding.read()})}}class la extends Pi{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const ua={id:"slider",type:"blade",accept(r){const e=We,t=ct(r,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return t?{params:t}:null},controller(r){var e,t;const n=(e=r.params.value)!==null&&e!==void 0?e:0,a=new En(r.document,{baseStep:1,parser:Zt,sliderProps:Me.fromObject({maxValue:r.params.max,minValue:r.params.min}),textProps:Me.fromObject({draggingScale:fr(void 0,n),formatter:(t=r.params.format)!==null&&t!==void 0?t:or}),value:wt(n),viewProps:r.viewProps});return new Ir(r.document,{blade:r.blade,props:Me.fromObject({label:r.params.label}),valueController:a})},api(r){return!(r.controller instanceof Ir)||!(r.controller.valueController instanceof En)?null:new aa(r.controller)}},ao=function(){return{id:"text",type:"blade",accept(r){const e=We,t=ct(r,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return t?{params:t}:null},controller(r){var e;const t=new xt(r.document,{parser:r.params.parse,props:Me.fromObject({formatter:(e=r.params.format)!==null&&e!==void 0?e:n=>String(n)}),value:wt(r.params.value),viewProps:r.viewProps});return new Ir(r.document,{blade:r.blade,props:Me.fromObject({label:r.params.label}),valueController:t})},api(r){return!(r.controller instanceof Ir)||!(r.controller.valueController instanceof xt)?null:new sa(r.controller)}}}();function ca(r){const e=r.createElement("div");return e.classList.add(Ve("dfw")()),r.body&&r.body.appendChild(e),e}function da(r,e,t){if(r.querySelector(`style[data-tp-style=${e}]`))return;const n=r.createElement("style");n.dataset.tpStyle=e,n.textContent=t,r.head.appendChild(n)}class so extends io{constructor(e){var t;const n=e||{},a=(t=n.document)!==null&&t!==void 0?t:Ea(),_=na(),k=new la(a,{expanded:n.expanded,blade:Yt(),props:Me.fromObject({title:n.title}),viewProps:ar.create()});super(k,_);this.pool_=_,this.containerElem_=n.container||ca(a),this.containerElem_.appendChild(this.element),this.doc_=a,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Ce.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw Ce.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(n),this.embedPluginStyle_(n)})}embedPluginStyle_(e){e.css&&da(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){da(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(0,0,0,0.2));--in-bg-a: var(--tp-input-background-color-active, rgba(0,0,0,0.35));--in-bg-f: var(--tp-input-background-color-focus, rgba(0,0,0,0.3));--in-bg-h: var(--tp-input-background-color-hover, rgba(0,0,0,0.25));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:calc(var(--cnt-h-p) + 8px);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}"),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[ua,ro,Ua,ao]})}}const fa=new Te("3.0.5");_e.BladeApi=Ge,_e.ButtonApi=qt,_e.FolderApi=Ai,_e.InputBindingApi=Ci,_e.ListApi=ia,_e.MonitorBindingApi=$n,_e.Pane=so,_e.SeparatorApi=Da,_e.SliderApi=aa,_e.TabApi=Ia,_e.TabPageApi=Ba,_e.TextApi=sa,_e.TpChangeEvent=He,_e.VERSION=fa,Object.defineProperty(_e,"__esModule",{value:!0})})})(yu,yu.exports);var Zl=1e-6,xu=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var J=0,$e=arguments.length;$e--;)J+=arguments[$e]*arguments[$e];return Math.sqrt(J)});function tc(J){return J[0]=1,J[1]=0,J[2]=0,J[3]=0,J[4]=0,J[5]=1,J[6]=0,J[7]=0,J[8]=0,J[9]=0,J[10]=1,J[11]=0,J[12]=0,J[13]=0,J[14]=0,J[15]=1,J}function rc(J,$e,_e,Te,Ge){var ot=1/Math.tan($e/2),He;return J[0]=ot/_e,J[1]=0,J[2]=0,J[3]=0,J[4]=0,J[5]=ot,J[6]=0,J[7]=0,J[8]=0,J[9]=0,J[11]=-1,J[12]=0,J[13]=0,J[15]=0,Ge!=null&&Ge!==1/0?(He=1/(Te-Ge),J[10]=(Ge+Te)*He,J[14]=2*Ge*Te*He):(J[10]=-1,J[14]=-2*Te),J}var oc=rc;function lc(J,$e,_e,Te){var Ge,ot,He,Pe,lt,Ke,De,Ot,Bt,Ce,Dt=$e[0],qt=$e[1],ze=$e[2],Wt=Te[0],Ve=Te[1],un=Te[2],cn=_e[0],_t=_e[1],ft=_e[2];return Math.abs(Dt-cn)<Zl&&Math.abs(qt-_t)<Zl&&Math.abs(ze-ft)<Zl?tc(J):(De=Dt-cn,Ot=qt-_t,Bt=ze-ft,Ce=1/Math.hypot(De,Ot,Bt),De*=Ce,Ot*=Ce,Bt*=Ce,Ge=Ve*Bt-un*Ot,ot=un*De-Wt*Bt,He=Wt*Ot-Ve*De,Ce=Math.hypot(Ge,ot,He),Ce?(Ce=1/Ce,Ge*=Ce,ot*=Ce,He*=Ce):(Ge=0,ot=0,He=0),Pe=Ot*He-Bt*ot,lt=Bt*Ge-De*He,Ke=De*ot-Ot*Ge,Ce=Math.hypot(Pe,lt,Ke),Ce?(Ce=1/Ce,Pe*=Ce,lt*=Ce,Ke*=Ce):(Pe=0,lt=0,Ke=0),J[0]=Ge,J[1]=Pe,J[2]=De,J[3]=0,J[4]=ot,J[5]=lt,J[6]=Ot,J[7]=0,J[8]=He,J[9]=Ke,J[10]=Bt,J[11]=0,J[12]=-(Ge*Dt+ot*qt+He*ze),J[13]=-(Pe*Dt+lt*qt+Ke*ze),J[14]=-(De*Dt+Ot*qt+Bt*ze),J[15]=1,J)}function nc(){var J=new xu(3);return xu!=Float32Array&&(J[0]=0,J[1]=0,J[2]=0),J}function ic(J){var $e=J[0],_e=J[1],Te=J[2];return Math.hypot($e,_e,Te)}function uc(J,$e,_e,Te){return J[0]=$e,J[1]=_e,J[2]=Te,J}function cc(J,$e,_e){return J[0]=$e[0]+_e[0],J[1]=$e[1]+_e[1],J[2]=$e[2]+_e[2],J}function ac(J,$e,_e){return J[0]=$e[0]-_e[0],J[1]=$e[1]-_e[1],J[2]=$e[2]-_e[2],J}var dc=ac,fc=ic;(function(){var J=nc();return function($e,_e,Te,Ge,ot,He){var Pe,lt;for(_e||(_e=3),Te||(Te=0),Ge?lt=Math.min(Ge*_e+Te,$e.length):lt=$e.length,Pe=Te;Pe<lt;Pe+=_e)J[0]=$e[Pe],J[1]=$e[Pe+1],J[2]=$e[Pe+2],ot(J,J,He),$e[Pe]=J[0],$e[Pe+1]=J[1],$e[Pe+2]=J[2];return $e}})();export{sc as R,uc as a,cc as b,lc as c,fc as l,oc as p,dc as s,yu as t};
